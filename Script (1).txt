///$tab Development List
/*
Date		Developer	Actions																						Grounds
----------------------------------------------------------------------------------------------------------------------------------------------------
2018-09-13	RSYSIUK		commented fields	Reg_PDT.ORIG_PDT_STATUS_DATE,											Talys's email from 2018-09-06
											Reg_PDT.ORIG_BUSINESS,										
											Reg_PDT.ORIG_FILL_VOLUMES_AND_UOM,
											Reg_PDT.ORIG_SALES_CHANNEL,
											Reg_PDT.ORIG_STRENGTHS_AND_UOM,
											Reg_PDT.ORIG_MOST_PROGRESS,
											Reg_PDT.ORIG_LEAST_PROGRESS,
											Reg_PDT.ORIG_REG_PDT_ACT_DEV_SITE,
											Reg_PDT.ORIG_ACTIVE_PJT_MFG_SITES
2018-09-18	MARJACOBS	added fields		Missing_in_full_flag,													Arne request for CLWP control report
											Missing_in_full_comments_flag
2018-09-24	RSYSIUK		added fields		_flag_changed_first_subm_date,											Tamar's email from 2018-09-20		
											_flag_changed_status										
2018-10-08	RSYSIUK		added fields		DISEASE_AREA AS [PDT.Disease Area],										Vicky's email from 2018-10-08
											SPECIALTY_INDICATION AS [PDT.Teva Specialty Indication]		
2018-10-08	RSYSIUK		added fields		B_IS_SPECIALTY_PROJECT AS [PJT.Is a Specialty Project?],				Vicky's email from 2018-10-08
											DEVELOPMENT_COUNTRIES AS [PJT.Development Countries],
											TRI_WEELY_STATUS AS [PJT.Tri-weekly Status],
											SP_PROJECT_ATTRIBUTES AS [PJT.Project Attributes],
                                            SP_PROJECT_NAME AS [PJT.Specialty Project Name],
                                            PHASE_I_SITE AS [PJT.Phase I Production Sites],
                                            PHASE_II_SITE AS [PJT.Phase II Production Sites],
                                            PHASE_III_SITE AS [PJT.Phase III Production Sites],
                                            PHASE_I_ALLOC_REASON AS [PJT.Phase I Allocation Reason],
                                            PHASE_II_ALLOC_REASON AS [PJT.Phase II Allocation Reason],
                                            PHASE_III_ALLOC_REASON AS [PJT.Phase III Allocation Reason],
                                            SUBMISSION AS [PJT.Submission]	
2018-10-08	RSYSIUK		added fields		SP_ARMS AS [WP.Arms],													Vicky's email from 2018-10-08
											CLINICAL_STUDY_PHASE AS [WP.Clinical Study Phase],
											ESTIMATED_NUMBER_OF_SITES AS [WP.Estimated Number Of Sites],
											PROTOCOL_NUMBER AS [WP.Protocol Number],
											SP_REGIONS AS [WP.Regions],
											SP_SAMPLE_SIZE AS [WP.Sample Size],
											STUDY_DESCRIPTION AS [WP.Study Description],
											STUDY_TYPE AS [WP.Study Type],
											SPECIALTY_WBS_TYPE AS [WP.Specialty Activity Type],
											TEMPLATE_UID AS [WP.Template UID],
											LABEL_FOR_MAP AS [WP.Label For Map Reports],
											ACT_NAME AS [WP.Activity Name]
2018-10-08	RSYSIUK		added fields		IS_A_OR_P as [TASK_WP.Activity A/P],									Vicky's email from 2018-10-08
											TEMPLATE_UID as [TASK_WP.Template UID],
											LABEL_FOR_MAP as [TASK_WP.Label For Map Reports],
											IDENTIFIER_OBJ as [TASK_WP.Identifier]
2018-10-08	RSYSIUK		added fields		SP_PROJECT_NAME as [PJT.PTRS Specialty Project Name],					Vicky's email from 2018-10-08
											PRECLINICAL_POC as [PJT.PTRS Preclinical/POC Stage],
											BENCH_PRECLINICAL_POC as [PJT.PTRS Benchmark Preclinical/POC Stage],
											PTRS_PH_I as [PJT.PTRS Ph1],
											BENCH_PTRS_PH_I as [PJT.PTRS Benchmark Ph1],
											PTRS_PH_II as [PJT.PTRS Ph2],
											BENCH_PTRS_PH_II as [PJT.PTRS Benchmark Ph2],
											PTRS_PH_III as [PJT.PTRS Ph3],
											BENCH_PTRS_PH_III as [PJT.PTRS Benchmark Ph3],
											PTRS_SUBMISSION as [PJT.PTRS Submission],
											BENCH_PTRS_SUBMISSION as [PJT.PTRS Benchmark Submission],
											PTRS_LOA as [PJT.PTRS LOA Based On Current Progress],
											BENCH_PTRS_LOA as [PJT.PTRS Benchmark LOA For Current Progress]
2018-10-17	RSYSIUK		added fields		GLOBAL_FINANCIAL_CODE AS [PJT.Global Financial Code],					Omer's email from 2018-10-11
											RND_ACTION_ITEMS AS [PJT.R&D Action Items]
2018-10-17	RSYSIUK		added transformations to DIM_TASK_WP 														according to 'Specialty R&D' app creation
2018-10-22	RSYSIUK		added fields		[PJT.PTRS to Next Phase]												Sela Kotzer email from 2018-10-22
2018-11-06	RSYSIUK		added fields		[PDT.Non-NCE/NME US], [PDT.Non-NCE/NME EU]								Vicky's mail from 2018-10-31
2018-12-06	RSYSIUK		added fields		LEGAL_PLMD_DATE AS [Reg_PDT.Legal PLMD Date]									Vicky's mail from 2018-12-02
											LEGAL_PLMD_DESCRIPTION AS [Reg_PDT.Legal PLMD Description]
											MISSING_PLMD_NO_VLS AS [Reg_PDT.Missing PLMD (No value)]
											MISSING_PLMD_UPLD_TBL_VL AS [Reg_PDT.Missing PLMD (Upload table value)]
											MISALIGNED_PLMD_NO_TBL_VL AS [Reg_PDT.Misaligned PLMD (PLM value/No table value)]
											MISALIGNED_PLMD_UPLD_TBL_VL AS [Reg_PDT.Misaligned PLMD (Upload table value)]
2018-12-06	RSYSIUK		added fields		SENIOR_PROJECT_LEADER AS [PJT.Senior Project Leader]					Neta's request from 2018-11-20
2018-12-06	RSYSIUK		added fields		[WP.Clinical_Flag],
											[_WP.Sub.Flag],
                                            [TASK_WP.Clinical PLM_ONB]
2018-12-14	RSYSIUK		added tables			MISTAKES
2018-12-18	RSYSIUK		added section access
2018-12-18	RSYSIUK		added bridge table
2018-12-26	RSYSIUK		added fields		MISSING_ROA_FLAG AS [PDT.Missing ROA Flag]								Vicky's email from 2018-12-25
											MISSING_FORM_FLAG AS [PDT.Missing Form Flag]
2018-12-27	RSYSIUK		added fields		MFG_PRO_EQUIPMENT_TRAIN,												Vicky's email from 2018-12-27
          									SUB_PACK_CONF_OR_PACK,
          									DAY_50,
          									DAY_50_KEY,
          									DAY_80,
         									DAY_80_KEY, 
          									DAY_90,
         									DAY_90_KEY, 
          									DAY_120,
          									DAY_120_KEY, 
          									DAY_121,
          									DAY_121_KEY,
          									DAY_150,
          									DAY_150_KEY,
          									DAY_50_AP,
          									DAY_80_AP,
          									DAY_90_AP,
          									DAY_120_AP,
          									DAY_121_AP,
          									DAY_150_AP
2018-12-27	RSYSIUK		commented fields	DAY_50,																	Vicky's email from 2019-01-22
          									DAY_50_KEY,
          									DAY_80,
         									DAY_80_KEY, 
          									DAY_90,
         									DAY_90_KEY, 
          									DAY_120,
          									DAY_120_KEY, 
          									DAY_121,
          									DAY_121_KEY,
          									DAY_150,
          									DAY_150_KEY,
          									DAY_50_AP,
          									DAY_80_AP,
          									DAY_90_AP,
          									DAY_120_AP,
          									DAY_121_AP,
          									DAY_150_AP
2019-01-31	RSYSIUK		fields calculation	[CNTRY.Market],															own iniciative
						replaced to view	[CNTRY.R&D Region Name],
                        					[PROJECTTBL_Key],
                                            [PJT.Site transfer],
                                            [PJT.TAPI Y/N],
                                            [PJT.Project Management Meeting],
                                            [PJT.SUBMISSIONS_ACTUALS_FLAG],
                                            [PJT.LAUNCHES_ACTUALS_FLAG],
                                            [PJT.Gross Selections],
                                            [PJT.Net Selections],
                                            [PJT.Active\Draft Status],
                                            [PJT.GM Business],
                                            [PJT.SubmDateNull_flag],
                                            [PJT.LaunchDateNull_flag],
                                            [PJT.SegmentNull_flag],
											[PJT.Projects Count],
                                            [Reg_PDT.GM Revised Therapeutic Area],
                                            [Reg_PDT.Selection Sub Method],
                                            [PJT.PTRS to Next Phase],
                                            [PJT.SelectionDateNum],
											[PJT.1stLaunchDateNum],
											[PJT.1stLaunchMonthNum],
											[PJT.GM Launch by Year],
											[PJT.1stSubmissionDateNum],
											[PJT.1stSubmissionMonthNum],
											[PJT.GM Submission by Year],
											[PJT.1st Approval Year],
											[PJT.EndorsementDateNum],
                                            [WP.Progress],
											[WP.FTM],
											[WP.Launch Probability],
											[WP.Livery],   
											[WP.On time launch],
                                            [WP.Launch date],
                                            [_Task_WP.flag.Critical Milestone],
											[_Task_WP.flag.GNG],
											[_Task_WP.flag.US Submissions],
											[_Task_WP.flag.EU Submissions],
											[_Task_WP.flag.US Target Approval],
											[_Task_WP.flag.EU Target Approval],
											[_Task_WP.Study Status.null],
											[_Task_WP.Date Range],
											[_Task_WP.flag.Phase 1 Date],
											[_Task_WP.flag.Phase 2 Date],
											[_Task_WP.flag.Phase 3 Date],
											[_Task_WP.flag.Protocol Approval (PSO)],
											[_Task_WP.flag.First Patient In (Enrolled - FPI)],
											[_Task_WP.flag.Last Patient In (Enrolled - LPI)],
											[_Task_WP.flag.Last Patient Last Visit (LPLV)],
											[_Task_WP.flag.Database Lock (DBLock)],
											[_Task_WP.flag.First Patient Screened (FPS)],
											[_Task_WP.flag.Start Data Retreival],
											[_Task_WP.flag.CSR Approval & Delivered (CSR)],
											[_Task_WP.flag.Human Factor Summary Report Development],
											[TASK_WP.Activity Type (Empty/Not Empty)],
											[TASK_WP.Milestone Category]
2019-01-10	RSYSIUK		added field			DOSAGE_FORM_GROUP AS [PDT.Dosage Form Group]							Vicky's email from 2019-01-31							
2019-02-04	RSYSIUK		split ERD between PLM_ERD and PLM ERD_Forecast												by my own	
2019-01-10	RSYSIUK		added fields		[_Task_WP.flag.China Submissions],										Neta's TASK0954889
											[_Task_WP.flag.China Target Approval]
2019-02-15	RSYSIUK		added fields		MISSING_INNOVATOR_CODE AS [PDT.Missing Innovator Code Flag],			Arne's email from 2019-01-24
											MISSING_INNOVATOR_COMPANY AS [PDT.Missing Innovator Company Flag],
											MISSING_INNOVATOR_BRAND_NAME AS [PDT.Missing Innovator Brand Name Flag]
											MISSING_BU_EU_ONLY AS [REG_PDT.Missing BU (EU Only) Flag],
											MISSING_INNOVATOR_COMPANY AS [REG_PDT.Missing Innovator Company Flag],
											MISSING_INNOVATOR_BRAND_NAME AS [REG_PDT.Missing Innovator Brand Name Flag]
2019-02-15	RSYSIUK		added tables		INDICATION,																Vicky's email from 2019-02-19
											IND_TASK
2019-02-25	RSYSIUK		added fields		[PDT.Indication Info US],												Vicky's email from 2019-02-19
											[PDT.Indication Progress US],
											[PDT.Phase II Start Date US],
											[PDT.Phase III Start Date US],
											[PDT.Phase III Success Start Date US],
											[PDT.Innovator Submition Start Date US],
											[PDT.Innovator Approval Start Date US],
                                            [PDT.Indication Info EU],
											[PDT.Indication Progress EU],
											[PDT.Phase II Start Date EU],
											[PDT.Phase III Start Date EU],
											[PDT.Phase III Success Start Date EU],
											[PDT.Innovator Submition Start Date EU],
											[PDT.Innovator Approval Start Date EU]
2019-02-27	RSYSIUK	dropped fields			[PDT.PLM_ID_US],														Vicky's email from 2019-02-19
											[PDT.NETWORK_US],
											[PDT.Reg. product characteristics US],
											//[PDT.Effective start date US],
											[PDT.File type US],
											[PDT.Indication US],
											[PDT.Indication progress US],
											[PDT.Main indication US],
											//[PDT.Major ATC4 US]
											[PDT.Name US],
											//[PDT.Real start US],
											[PDT.Strength fill volume UOM US],
											[PDT.Strength fill volumes US],
											[PDT.Inn. approval date US],
											[PDT.Inn. submission date US],
											[PDT.PDUFA date US],
											//[PDT.S. Inn. approval US],
											[PDT.Inn Submission A/P US],
											[PDT.PDUFA A/P US],
											[PDT.Act. start inn. approval US],
											[PDT.Fix start inn. approval US], 
											[PDT.Act. start phase 1 US],
											[PDT.Fix start phase 1 US],
											[PDT.Act. start phase 2 US],
											[PDT.Fix start phase 2 US],
											[PDT.Act. start phase 3 US],
											[PDT.Fix start phase 3 US],
											[PDT.Act. start success phase 3 US],
											[PDT.Fix start success phase 3 US],
											[PDT.Act. start Inn. Submit US],
											[PDT.Fix start Inn. Submit US],
											[PDT.Act. start Inn. Submit PH US],
											[PDT.Fix start Inn. Submit PH US],
											[PDT.PLM_ID_EU],
											[PDT.NETWORK_EU],
											[PDT.Reg. product characteristics EU],
											//[PDT.Effective start date EU],
											[PDT.File type EU],
											[PDT.Indication EU],
											[PDT.Indication progress EU],
											[PDT.Main indication EU],
											//[PDT.Major ATC4 EU],
											[PDT.Name EU],
											[PDT.Real start EU],
											[PDT.Strength fill volume UOM EU],
											[PDT.Strength fill volumes EU],
											[PDT.Inn. approval date EU],
											[PDT.Inn. submission date EU],
											//[PDT.PDUFA date EU],
											//[PDT.S. Inn. approval EU],
											[PDT.Inn Submission A/P EU],
											//[PDT.PDUFA A/P EU],
											[PDT.Act. start inn. approval EU],
											[PDT.Fix start inn. approval EU],
											[PDT.Act. start phase 1 EU],
											[PDT.Fix start phase 1 EU],
											[PDT.Act. start phase 2 EU],
											[PDT.Fix start phase 2 EU],
											[PDT.Act. start phase 3 EU],
											[PDT.Fix start phase 3 EU],
											[PDT.Act. start success phase 3 EU],
											[PDT.Fix start success phase 3 EU],
											[PDT.Act. start inn. Submit EU],
											[PDT.Fix start inn. submit EU],
											[PDT.Act. start inn. submit PH EU],
											[PDT.Fix start inn. submit PH EU]
2019-03-04	RSYSIUK		hided all 'key' fields - add '_' prefix														Vicky's e-mail from 2019-03-03
2019-03-04	RSYSIUK		added "Exit when Dev"
2019-03-05	RSYSIUK		added fields		[_Task_WP.flag.Ops Readiness],											Vicky's e-mail from 2019-02-28
											[_Task_WP.flag.Pre-Validation Start],
											[_Task_WP.flag.Launch Build Start],
											[_Task_WP.flag.Target validation Start],
											[_Task_WP.flag.API for Validation and Launch Build]
2019-03-07	RSYSIUK		commented fields	[TASK_IND.Finish No Later Than],										Vicky's e-mail from 2019-03-06
											[TASK_IND.Start No Later Than]											Fields are always empty according to PLM team
2019-03-12	RSYSIUK		changed fields		[PJT.R&D project manager] -> [PJT.R&D Project Manager],					Vicky's e-mail from 2019-03-11
											[PJT.Senior Project Leader] -> [PJT.Project Leader]
2019-03-13	RSYSIUK		added field			[IND.Missing Main Indication Flag]
2019-03-13	RSYSIUK		removed fields		[Reg_PDT.MISSING_MAIN_INDICATION_US],
											[Reg_PDT.MISSING_MAIN_INDICATION_EU]

2019-03-13	RSYSIUK		added island		ErrorTypes
2019-03-13	RSYSIUK		added mapping table	1-Y,0-null
2019-03-14	RSYSIUK		changed calculation logic of 'RegPDT.Missing...' - not missing if there is at least one value per PDT-REG4BI
2019-03-19	RSYSIUK		added field			[PJT.Missing Kick-off Date Flag],										Anastasia's e-mail from 2019-03-05
											[PJT.Expired Kick-off Date Flag]
2019-04-11	RSYSIUK		added fields		IND_PROGRESS_DATE_FOR_DISPLAY	as [IND.Progress Date For Display],		Talya's e-mail from 2019-04-11
											IND_PROGRESS_INFO_PAD_DISPLAY	as [IND.Progress Info Pad For Display]
2019-04-17	RSYSIUK		added fields	    FLAG_NON_AUDITED_DRAFT_REPORT	as [_Task_WP.flag.Non audited draft report],
											FLAG_IND_OR_CTA_SUBMISSION	as [_Task_WP.flag.IND/CTA Submission],
											FLAG_TOP_LINE_RESULTS_AVLBL	as [_Task_WP.flag.Top Line Results Available],
											FLAG_SUBMISSIONS		as [_Task_WP.flag.Submissions]
2019-04-22  ALEVI       added fiels         FLAG_AUDITED_DRAFT_REPORT	as [_Task_WP.flag.audited draft report]
2019-05-03	RSYSIUK		commented field		ROUTE_ADMIN																Talya's e-mail from 2019-04-17
2019-05-10	RSYSIUK		added fields	    TRACE_IND_COMMENTS AS [REG_PDT.Last Progress Comment],					Vicky's e-mail from 2019-05-07
											TRACE_IND_CREATION_D AS [REG_PDT.Last progress date],
											PLMD_EARLY AS [Reg_PDT.PLMD Early],
											PLFD_EARLY AS [Reg_PDT.PLFD Early],
                                            VALIDATION_NOTES AS [PJT.Validation Notes],
                                            RA_FILE_QUALITY AS [WP.RA File Quality],
                                            TASK_DESC as [TASK_WP.Description]
2019-05-16	RSYSIUK		commented field		RA_SUB_FILE_STRAT														Talya's e-mail from 2019-05-15
2019-05-24	RSYSIUK		commented field		DB_insert_date
2019-05-26	RSYSIUK		commented field		[PJT.1stLaunchDateNum]              
											[PJT.SelectionDateNum]              
											[PJT.EndorsementDateNum]              
											DB_insert_date              
											[PJT.1stLaunchMonthNum]              
											[PJT.1stSubmissionMonthNum]              
											[PJT.GM_SELECTION_METHOD] //V1 07/06/2018 LMIZRAHITO - added field        
											[PJT.GM_THERAPEUTIC_AREA_PLM] //V1 07/06/2018 LMIZRAHITO - added field        
											[PJT.Gross Selections]             
											[PJT.Net Selections]             
											[PJT.Is Origin PJT]            
											[PJT.Projects Count]             
											[PJT.Region]              
											PROJECTTBL_KEY
                                            [PJT.MISTAKES_IN_PROJECT_MS_FLAG]
2019-05-26	RSYSIUK		removed to 			[PJT.Active\Draft Status]             
	'GM Portfolio Dashboard' load script	[PJT.BUSINESS_B]              
											[PJT.BUSINESS_G]              
											[PJT.BUSINESS_R]              
											[PJT.1st Approval Year]            
											[PJT.GM Business]             
											[PJT.GM Launch by Year]           
											[PJT.GM Submission by Year]           
											[PJT.Previous Submission Date]
                                            [PJT.GM_business_flag] 
											[PJT.GM_projects_flag]
2019-05-26	RSYSIUK		removed to 			[PJT.PTRS to Next Phase]           
 			'R&D Specialty' load script
2019-07-03	RSYSIUK		Added new fields	D_MS_START_CRL as [MST.CRL Start Date],									task TASK1103648
    										D_MS_FINISH_CRL as [MST.CRL Finish Date],
    										D_MS_DRM_PRI2DOSING as [MST.Design Review Meeting (Prior to Dosing) Date],
    										D_MS_DRM_PRI2MANUFACTURE as [MST.Design Review Meeting (Prior to Manufacture) Date],
    										D_MS_DRM_PRI2SUBMISSION as [MST.Design Review Meeting (Prior to Submission) Date]
2019-08-28	RSYSIUK		Added new table		PJT/MILESTONES
2019-09-04	RSYSIUK		added field			TECHNOLOGY_GROUP as [PDT.Technology Group]								Miguel's and Tamar's request
2019-09-04	RSYSIUK		added field			[_PJT.IP Owner Username]												Talya's NPrinting request
2020-01-27	RSYSIUK		added fields		PDT.Evaluate Pharma Product ID											Oded's email from 2020-01-20
											PDT.Data Monitor Product ID
											PDT.Decision Resources Product ID
											PJT.NO OF BATCHES
                                            PJT.NPI COMMENTS
                                            PJT.Stability Zones 
                                            PJT.Planned Shelf Life On Launch
                                            PJT.Brand Package Configuration
                                            PJT.Medis Relevance
                                            REG_PDT.Orphan Status
2020-05-07 NBERMAN01	Removed field		LEGAL_PJT_MEMBER as [PJT.Legal contact person]
2020-06-01 NBERMAN01	Removed fields		IND_PROGRESS_DATE_FOR_DISPLAY	as [IND.Last Progress Date]
											IND_PROGRESS_INFO_PAD_DISPLAY	as [IND.Last Progress Comment]
2020-06-17 NBERMAN01	Added Fields		NOT_CONSOLIDATE			as [TASK_WP.Not Consolidate],
    										SP_ACTIVITY_TYPE		as [TASK_WP.Specialty Activity Type]
2020-06-22 DISAIEV		Added TGO
2020-10-02 KBODNAR		Added Fields		NDC_NUMBER	as [PACK.NDC No.]
											NDC_STATUS	as [PACK.NDC status]
2020-10-02 KBODNAR		Removed field		PRJ_GLOBAL_PDT_TECH as [PJT.Global product technology]   
2020-10-27 DISAIEV		Added a new section: "Medical Writing Monthly Milestone"
2020-11-07 KBODNAR		Removed field		LIST_NUMBER as [PACK.List no.]
2020-11-09 DISAIEV		AddedAdded a new section: "Country Milestone"
2020-11-10 KBODNAR		Added field			NON_STD_PRODUCT	as [PJT.Nonstandard product]
2020-11-24 OVOLOSHAKE   Added field         FLAG_SP_ACTIVITY_TYPE_NULL as [TASK_WP.Specialty Activity Type (Empty/Not Empty)] in TASK_WP section
2020-12-25 DISAIEV      Added section For HiH
2020-12-31 SREDIJ     
2021-02-17 OVOLOSHAKE  added fields to the Project
                                           // added by O.Voloshchuk on 17/02/2021

                                            
                                            ,TPO_COMMENTS as [PJT.Site/TPO comments]


2021-02-26 DISAIEV		QC10322				Amend the permission filtration in the  PLM _ERD app for the [SA.DEV_SITE] , [SA.MFG_SITE] - Section 'Key Table'
2021-03-02 OVOLOSHCHUK                      added    GAIN_N_N as [PJT.GAIN (n-n)] 
                                                     ,IS_IN_SOURCE_SYSTEM as [_PJT.IS_IN_SOURCE_SYSTEM]
                                                     ,PRJ_GAIN as [_PJT.PRJ_GAIN]
                                             to the Project table  

2021-03-02 Olga Voloshchuk                  Amend the permissions filtration in the  PLM _ERD app for the [_SA_PJT_GROUP] - Section 'Key Table'

2021-04-07 Olga Voloshchuk                  Added the Risk Section
2021-04-07 Olga Voloshchuk                  Added the Action item Section
2021-04-18 Olga Voloshchuk                  Added Study Hyperion Code field to the Workpackage
2021-05-18 Olga Voloshchuk                  Added columns packaging_notes, strat_filing_eu to the Project
2021-05-18 Olga Voloshchuk                  Amend by Olga Voloshchuk - dditional sites which currently are not in the IDM menu: Release +testing+ packaging on Talya req for Superna
                                            See sections Project and Key Tabley
                                            
2021-05-31 Olga Voloshchuk                  Risk comments field added to the Risk table see Risk section
2021-06-31 Olga Voloshchuk                  added PRODUCT_STRATEGY_MANAGER in Project for HiH Npi report

2021-07-15 Olga Voloshchuk                  added new columns LINE_IDENTIFIER,TARGET_START_DATE Task_WP Section
2021-07-15 Olga Voloshchuk                  added new column LINE_IDENTIFIER to Workpackage
2021-08-05 Olga Voloshchuk                  added new columns to PROJECT table :HIH_INITIATION_A_OR_P,HIH_INITIATION,HANDOVER_A_OR_P,HANDOVER     
2021-08-27 Olga Voloshchuk                  added new columns to the Project on req for Anastasia 
                                                 TARGET_VAL_MFG_START,PROCESS_DESIGN_MFG_START,API_ORDER_FOR_VALIDATION,
                                                  VALIDATION_MFG_START_A_P,PROCESS_DESIGN_MFG_AP,API_ORDER_FOR_VAL_A_P


2021-10-12 Olga Voloshchuk                  added new column on Reg.product LMD_DATE AS [Reg_PDT.LMD Date] for Tamar and Oded request.
2021-01-12 Olga Vloshchuk                    renamed on Talya request 
                                             PLMD_EARLY as [PJT.PLMD early] to [PJT.IP Earliest - early]
                                             PLMD_EARLY	AS [Reg_PDT.PLMD early] to [Reg_PDT.IP Earliest - early]
                                             LMD_DESC as [PJT.LMD description] to [PJT.IP Latest comments]
                                             [TASK_WP.LMD description] to [TASK_WP.IP Latest comments]
                                             LMD_EARLY_2 as [PJT.LMD early] to [PJT.IP Latest - early]
2021-12-04 Olga Voloshchuk                  on Nimrod req. TGO report,SITE_TPO_LAUNCH_MANAGER as [PJT.Site/TPO launch manager]
2021-12-20 Olga Voloshchuk                   added new column API_AGREEMENT_STATUS   as [API AGREEMENT STATUS] to the API_SUPPLIER_N_N_BI sec 
2021-12-20 Olga Voloshchuk                  added sections PR_PACKAGING,PR_Excipients
2022-03-23 Olga Voloshchuk                   added new columns to Risk section
                                             PROBABILITY_SP	,IMPACT_SP	,SCORE	,OWNER	,
                                             EXTENDED_DESCRIPTION	,COMMENTS	,CONTINGENCY	,RISK_OPEN_CLOSED	,
                                             RISK_CLOSED_DATE	,RISK_REALIZED	
2022-06-22 Olga Voloshchuk                  adding new fields to the Risk
2022-07-21 Olga Voloshchuk                  New Columns
                                             Task of WP : Stability Zone -removed on 20/08/2022
                                             API Supplier: FACILITY_ADDRESS
                                             PR Excipient: MANUFACTURING_FACILITY		,
                                                           MANUFACTURING_FACILITY_ADDRESS		,
                                                           RND_PRICE		,
                                                           COMMERCIAL_PRICE		,
                                                           SHELF_LIFE		,
                                                           LEAD_TIME_FOR_LAUNCH		,
                                                           NITROSAMINE_RISK_ASSESSMENT	
                                             PR_Packaging:MANUFACTURING_FACILITY
                                                          MANUFACTURING_FACILITY_ADDRESS
                                                          RND_PRICE
                                                          COMMERCIAL_PRICE
                                                          LEAD_TIME_FOR_LAUNCH
                                                          NITROSAMINE_RISK_ASSESSMENT
2022-08-20 Olga Voloshchuk                  New table Batch Manuf report added 
2022-09-08 Olga Voloshchuk                  New table added [API NPC] for Reut report
2022-12-01 Olga Voloshchuk                  Added new PLP fields 
2022-12-01 Olga Voloshchuk                  Added new table Lessons Learned for PLP 
2023-16-03 Olga voloshchuk                  new plp fields 16/03/2023


















*/
///$tab Section

///$tab Main
NullAsValue [PJT.Project type],[PJT.Status],[PJT.Development site],[PJT.Progress];
Set NullValue = 'N/A';

SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;($#,##0.00)';
SET TimeFormat='h:mm:ss TT';
SET DateFormat='DD-MMM-YYYY';
SET TimestampFormat='YYYY-MM-DD';
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale='en-US';
SET CreateSearchIndexOnReload=1;
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET LongMonthNames='January;February;March;April;May;June;July;August;September;October;November;December';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';
SET LongDayNames='Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday';

SET HidePrefix='_' ;

LET vToday=today();
LET vCurrentMonthStart=MonthStart(vToday);
LET vCurrentMonthStartNum=Date(MonthStart(vToday));

LET vServer = ComputerName();
 
///$tab Maping
MapFlags:
MAPPING 
LOAD key, dual(value,key) INLINE [key,value
1, Yes
0,
];

MapReg_PDT_Strength_Status:
MAPPING 
LOAD * INLINE [key, value
Historic, 0
Not Interested, 0
Commercial, 0
Terminated, 0
];

MapReg_PJT_Status:
MAPPING 
LOAD * INLINE [key, value
Completed, 0
Cancelled, 0
];



///////////////////////////////////////////////////////////////////////////////////////////////////

Map  [REG_PDT.Missing Main Indication]
	,[REG_PDT.Review AFP Status]
	,[REG_PDT.Missing Product Status]
	,[REG_PDT.Missing/Expired Watch Expiry Date]
	,[REG_PDT.Missing Non-NCE/NME]
	,[REG_PDT.Missing PLMD (No value)]
	,[REG_PDT.Missing PLMD (Upload table value)]
	,[REG_PDT.Misaligned PLMD (PLM value/No table value)]
	//,[somebs REG_PDT.Misaligned PLMD (Upload table value)]
	,[REG_PDT.Missing BU (EU Only)]
	,[REG_PDT.Missing Innovator Company]
	,[REG_PDT.Missing Innovator Brand Name]
    ,[WP.Missing FTM Flag]
	,[WP.Missing FTM Comments Flag]
	,[WP.Missing On-Time Launch Flag]
	,[WP.Missing Reason for Delay Flag]
	,[WP.Missing Reason for Delay Comments Flag]
	,[WP.Missing Launch Probability Flag]
	,[WP.Mising Launch Date Flag]
	,[WP.Missing Launch Date Flag]
	,[WP.Missing Livery Flag]
	,[WP.Missing Packaging Site Flag]
	,[WP.Missing MFG Site Flag]
	,[WP.Missing Day0 Flag]
	,[WP.Missing Livery Day 106 Flag]
	,[WP.Missing Approval EOP date Flag]
	,[WP.Missing Approval Flag]
	,[WP.Missing Submission Date Flag]
    ,[PJT.Missing Kick-off Date Flag]
	,[PJT.Expired Kick-off Date Flag]
Using MapFlags;
///$tab Islands
let vMaxDate = vToday*2
;
tCalendar:
LOAD RowNo() AS DateNum AUTOGENERATE ($(vMaxDate))
;
Qualify *
;
iCalendar:
Load  
	DateNum,
	Date(DateNum)																						as Date,  
	Year(DateNum)																						as Year,
	'Q' & ceil(num(Month(DateNum))/3)																	as Quarter,
	Month(DateNum)																						as Month,  
	week(DateNum)																						as Week,
	Day(DateNum)																						as Day,  
	date(monthstart(DateNum), 'MMM-YYYY')																as MonthYear,  
	Week(weekstart(DateNum)) & '-' & WeekYear(DateNum)													as WeekYear,  
	WeekDay(DateNum)																					as WeekDay,
	DateNum-'$(vToday)'																					as DateDiff,
	((Year(DateNum)-Year('$(vToday)'))*12)+(Month(DateNum)-Month('$(vToday)'))							as MonthDiff,
	((Year(DateNum)-Year('$(vToday)'))*4)+(ceil(num(Month(DateNum))/3)-ceil(num(Month('$(vToday)'))/3))	as QtrDiff,
	Year(DateNum)-Year('$(vToday)') 																	as YearDiff 
Resident tCalendar
;
Unqualify *
;
Drop Table tCalendar;
;

ErrorTypes:
LOAD * INLINE [_ErrorTypeCode, ErrorType  
1,	Missing FTM
2,	Missing FTM comments
3,	Missing Baseline date  and not on time
4,	Baseline<Launch date & on time
5,	Missing On time launch
6,	Missing Reason for delay
7,	Missing Reason for delay comments
8,	Missing In full
9,	Missing In full comments
10, Missing Actual quantity delivered
11, Missing Reason for reduced/esceeding quantities
12, Missing Launch probability
13, Missing Commercial success
14, Missing Commercial success comments

15, Missing/Expired Launch date
16, Expired Launch date
17, Missing IP Earliest
18, Missing Livery
19, Missing Country Mfg. Site
20, Missing Country packaging site
21, Missing Country test site
22, Missing Country release site
23, Missing Submissions
24, Missing Day 0
25, Missing Day 70
26, Missing Day 105
27, Missing Day 106
28, Missing Day 180
29, Missing Day 210
30, Missing Approval (EOP)
31, Missing Approval
32, Expired Submissions
33, Expired Day 0
34, Expired Day 70
35, Expired Day 105
36, Expired Day 106
37, Expired Day 180
38, Expired Day 210
39, Expired Approval (EOP)
40, Expired Approval
41, Missing MARS
42, 1st Submission later than MARS
43, Missing Project status
44, Missing Business
45, Missing Project type
46, Missing Portfolio project manager
47, Missing Project progress
48, Missing Manufacturing Sites
49, Missing Packaging Sites
50, Missing Testing Sites
51, Missing Release Sites
52, Missing Consolidated RAWPs
53, Missing Consolidated CLWPs
54, Change project status to Completed
55, Change project status to Active
56, Misalignment on RAWP/CLWP consolidated status

57, Missing Gain
58, Missing Description
59, Missing ROA/Form
59.1, Missing ROA
59.2, Missing Form
60, Missing ATC1
61, Missing Strengths/UOM
62, Missing Origin of Material

63, Missing Product status
64, Missing/Expired Watch Expiry Date
65, Review AFP status
66, Missing Non-NCE/NME

//below added by M.Jacobs 2018-Jun-19
67, Missing Main Indication
69, Mistakes in Project MS-submission batch
70, Mistakes in Project MS-bio start
71, Mistakes in Project MS-final bio report
72, Mistakes in Project MS-submission date

73, Missing IP Earliest (No value)
74, Missing IP Earliest (Upload table value)
75, Misaligned IP Earliest (PLM value/No table value)
76, Misaligned IP Earliest (Upload table value)

77, Missing Innovator Brand Name
78, Missing Innovator Company
79, Missing Innovator Code
80, Missing BU (EU Only)

81, Missing Kick-off Date Flag
82, Expired Kick-off Date Flag
83, Mistakes in Project MS- kick off date

84, Link on Summary Task
85, Late Start/Finish
86, Duplicated Protocol Number
88, Missing Major Milestones for Development countries
89, Major Milestones with duration different than zero
90, Missing Regions
91, Missing Estimated Number Of Sites
92, Missing Sample Size
93, Missing Protocol Number
94, Missing Arms
87, Missing Protocol Approval (PSO)
95, Missing Screening Initiated (FPS)
96, Missing First Patient In (Enrolled - FPI)
97, Missing Last Patient In (Enrolled - LPI)
98, Missing Last Patient Last Visit (LPLV)
99, Missing Database Lock (DBLock)
100, Missing CSR Approval & Delivered (CSR)
101, Too Long Protocol Number
102, Missing Project Description, Project Status, Development countries
103, Speciality Activity Type is not indicated for reportable activites and milestones.

104, Missing IP Latest (No value)
105, Missing IP Latest (Upload table value)
106, Misaligned IP Latest (PLM value/No table value)
107, Misaligned IP Latest (Upload table value)

];
///$tab DIM_COUNTRY_REGION
LET vStartTime = now();

[COUNTRY_REGION]:
LOAD 
    [COUNTRY_KEY]	        as [_CNTRY.REGION_COUNTRY_KEY],
	[ORGANIZATION_KEY]      as [_CNTRY.ORGANIZATION_KEY],
    [COUNTRY_LEVEL] 		as [CNTRY.Country Level],
	[COUNTRY_CODE]  		as [CNTRY.Country Code] ,
	[MBI_COUNTRY_CODE] 		as [CNTRY.MBI Country Code],
	[COUNTRY_NAME] 			as [CNTRY.Country Name],
	[REGION_NAME] 			as [CNTRY.Region Name],
    NPV_COUNTRY_CODE		as [CNTRY.NPV Country Code], 
    REGION_NAME_OLD			AS [CNTRY.Region Old], //V1, 07/06/2018, LMIZRAHITO
    NPV_FRC_LEVEL			as [CNTRY.NPV FRC Level],
    [L1_CODE]               as [CNTRY.L1 Code],
	[L1_NAME]				as [CNTRY.L1 Name],
	[L2_CODE] 			    as [CNTRY.L2 Code],
	//[L2_NAME],
	[L3_CODE]			    as [CNTRY.L3_CODE],
        If([L3_CODE] = 'Europe', [L3_CODE], 
            If(match([REGION_NAME], 'CA', 'US'), [REGION_NAME],
            If(match([L2_CODE], 'Asia', 'EMIA', 'LATAM'), [L2_CODE]))) as [CNTRY.Market], 
	//[L3_NAME],
	//[L4_CODE],
	//[L4_NAME],
    [REGION_FOR_BI]         as [CNTRY.Region Name BI],
    GM_COUNTRIES_FLAG       as [CNTRY.GM_countries_flag],
    GM_VENEZUELA_FLAG       as [CNTRY.GM_Venezuela_flag],
    RND_REGION_NAME AS [CNTRY.R&D Region Name]	//LMIZRAHITO 27/08/2018 - Fixed in favor of R&D

 FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_COUNTRY_REGION.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab DIM_ORGANIZATION
LET vStartTime = now();

[ORGANIZATION]:
NoConcatenate
LOAD
    ORGANIZATION_KEY					as [_ORG.ORGANIZATION_KEY],
    MARKET_GARP_CODE					as [Market Garp Code],
    MARKET_GARP_DESC					as [Market Garp Desc],
    MARKET_GARP_DESC_SHORT				as [Market Garp Desc Short],
    MKT_LEVEL1_NAME						as [Market Level1 Name],
    MKT_LEVEL2_NAME						as [Market Level2 Name],
    MKT_LEVEL2_DASHBOARD 				as [Market Level2 Dashboard],
    MKT_LEVEL3_NAME						as [Market Level3 Name],
    MKT_SORT_ORDER						as [Market Sort Order],
    MKT_L2_SORT_ORDER					as [Market L2 Sort Order],
    MKT_L2_DASHBOARD_SORT				as [Market L2 Dahsboard Sort],
    MKT_L3_SORT_ORDER					as [Market L3 Sort Order],
    IMS_COUNTRY							as [IMS Country]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_COUNTRY_ORGANIZATION.QVD]
(qvd);

Left Join(ORGANIZATION) // 2019-02-06 RSYSIUK not sure we need this ToDo: investigate if we can drop this calculation
Load 
    [_CNTRY.REGION_COUNTRY_KEY]	        as [_ORG.REGION_COUNTRY_KEY],
	[_CNTRY.ORGANIZATION_KEY]	      	as [_ORG.ORGANIZATION_KEY]
resident COUNTRY_REGION;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab PRODUCT
LET vStartTime = now();

[PRODUCT]:

LOAD 
	PRODUCT_KEY     	                AS [_PDT.KEY],
	PRODUCT_CODE                        AS [PDT.Product Code],
	DESCRIPTION                         AS [PDT.Description],
	PLM_ONB                             AS [PDT.Internal number],
	GAIN                              	AS [PDT.GAIN],
	ROUTE_OF_ADMINISTRATION             AS [PDT.Route of Administration],
	PACKAGING_FORM                      AS [PDT.Packaging form],
	PRODUCT_TECHNOLOGY                  AS [PDT.Product technology],
	FORM                              	AS [PDT.Form],
	RATIONALE                           AS [PDT.Rationale],
	STRENGTHS                           AS [PDT.Strengths],
	FILL_VOLUMES                        AS [PDT.Fill volumes],
	DOSE_REGIMEN                        AS [PDT.Dose regimen],
	ORIGIN_OF_MATERIAL                  AS [PDT.Origin of Material],
	TAPI                             	AS [PDT.TAPI],
	API_COMMENTS                        AS [PDT.API comments],
	HANDLING_CATEGORY                   AS [PDT.Handling category],
	COMBO_PACK                          AS [PDT.Combo pack],
	HORMONE                             AS [PDT.Hormone],
	STERILE                             AS [PDT.Sterile],
	COMBO_MOLECULE                      AS [PDT.Combo molecule],
	CYTOTOXIC                           AS [PDT.Cytotoxic],
//self note- change to Global Product ID in reports (from identifier )
//IDENTIFIER                	        AS [PDT.Global Product ID],
	GPMS_PRODUCT_DOC_ID                 AS [PDT.ProductDocId],
	PRODUCT_INNOVATOR_CODE              AS [PDT.Product innovator code],
	BRAND_CA                            AS [PDT.BRAND_CA (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	BRAND_EU                            AS [PDT.BRAND_EU (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	BRAND_US                            AS [PDT.BRAND_US (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	INNOVATOR_CA                        AS [PDT.INNOVATOR_CA (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	INNOVATOR_EU                        AS [PDT.INNOVATOR_EU (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	INNOVATOR_US                        AS [PDT.INNOVATOR_US (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	STATUS_CA                           AS [PDT.STATUS_CA (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	STATUS_EU                           AS [PDT.STATUS_EU (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	STATUS_US                           AS [PDT.STATUS_US (IMS impex, PLM_PRODUCTS_IMS_US_V)],
	THERAPEUTIC_CLASS                   AS [PDT.Therapeutic class (ATC1)],
//PLM_MOD_DATE                  	    AS [PDT.Modification date],
	PLM_CREATE_DATE                     AS [PDT.Creation date],
//US_INNOVATOR_APPROVAL_DATE        	AS [PDT.Innovator Approval Date (US)], // 2018-08-16 RS
	IS_GLOBAL_NTE                       AS [PDT.Global NTE],
	DOSAGE_FORM                         AS [PDT.Dosage Form],
	DOSAGE_FORM_GROUP                   AS [PDT.Dosage Form Group],
	INNO_BRAND_GLOBAL                   AS [PDT.Innovator brand name],
	INNOV_COMPANY                       AS [PDT.Innovator company],
	PARTNERS                            AS [PDT.Innovator partners],
	STRENGTH_UOMS_FROM_PDT              AS [PDT.Product strengths UOMs],
/*  2020-04-06 DISAIEV deactivated next 5 fields:
//	IND_PROGRESS_DATE_FOR_DISP_US  		AS [PDT.Ind. progress date for disp. US], //V1, 07/06/2018, LMIZRAHITO - 26/06/2018 unmarked
//	IND_PROGRESS_INFO_PAD_DISP_US  		AS [PDT.Ind. progress info pad. disp. US], //V1, 07/06/2018, LMIZRAHITO - 26/06/2018 unmarked
//	IND_PROGRESS_DATE_FOR_DISP_EU  		AS [PDT.Ind. progress date for disp. EU], //V1, 07/06/2018, LMIZRAHITO - 26/06/2018 unmarked
//	IND_PROGRESS_INFO_PAD_DISP_EU  		AS [PDT.Ind. progress info pad. disp. EU], //V1, 07/06/2018, LMIZRAHITO - 26/06/2018 unmarked
//	TECHNOLOGY_GROUP					AS [PDT.Technology Group],
*/
/* 2019-02-27 RSYSIUK replaced to INDICATION
// us data
	PLM_ID_US  							AS [PDT.PLM_ID_US],
	NETWORK_US  						AS [PDT.NETWORK_US],
	ACT_REG_PDT_CHARAC_US  				AS [PDT.Reg. product characteristics US],
//EFFECTIVE_START_US  					AS [PDT.Effective start date US],
	FILE_TYPE_US  						AS [PDT.File type US],
	INDICATION_INFO_US  				AS [PDT.Indication US],
	INDICATION_PROGRESS_US  			AS [PDT.Indication progress US],
	MAIN_INDICATION_US  				AS [PDT.Main indication US],
//MAJOR_ATC4_US 						AS [PDT.Major ATC4 US],//V1, 07/06/2018, LMIZRAHITO - 29/07/2018 commented
	NAME_US  							AS [PDT.Name US],
//REAL_START_US  						AS [PDT.Real start US],
	STRENGTH_FILL_V_UOM_US  			AS [PDT.Strength fill volume UOM US],
	STRENGTH_FILL_VOLUMES_US  			AS [PDT.Strength fill volumes US],
	D_INNOV_APPROVAL_US  				AS [PDT.Inn. approval date US],
	D_INNOV_SUBMISSION_US  				AS [PDT.Inn. submission date US], //V1, 07/06/2018, LMIZRAHITO - Field name fixed from [PDT.Inn. submiision date US]
	D_PDUFA_US  						AS [PDT.PDUFA date US],
//S_INNOV_APPROVAL_US 					AS [PDT.S. Inn. approval US], // the field should be replaced to the A/P format
	S_INNOV_SUBMISSION_A_OR_P_US  		AS [PDT.Inn Submission A/P US],
	S_PDUFA_A_OR_P_US  					AS [PDT.PDUFA A/P US],
	ACT_START_INNOVATOR_APPR_US  		AS [PDT.Act. start inn. approval US],
	FIX_START_INNOV_APPR_US 			AS [PDT.Fix start inn. approval US], 
	ACT_START_PHASE_1_US  				AS [PDT.Act. start phase 1 US],
	FIX_START_PHASE_1_US  				AS [PDT.Fix start phase 1 US],
	ACT_START_PHASE_2_US  				AS [PDT.Act. start phase 2 US],
	FIX_START_PHASE_2_US  				AS [PDT.Fix start phase 2 US],
	ACT_START_PHASE_3_US  				AS [PDT.Act. start phase 3 US],
	FIX_START_PHASE_3_US  				AS [PDT.Fix start phase 3 US],
	ACT_START_SUCCESS_PHASE_3_US  		AS [PDT.Act. start success phase 3 US],
	FIX_START_SUCCESS_PHASE_3_US  		AS [PDT.Fix start success phase 3 US],
	ACT_START_INNOV_SUBMIT_US  			AS [PDT.Act. start Inn. Submit US],
	FIX_START_INNOV_SUBMIT_US  			AS [PDT.Fix start Inn. Submit US],
	ACT_START_INNOV_SUBMIT_PH_US  		AS [PDT.Act. start Inn. Submit PH US],
	FIX_START_INNOV_SUBMIT_PH_US  		AS [PDT.Fix start Inn. Submit PH US],
// eu data
	PLM_ID_EU  							AS [PDT.PLM_ID_EU],
	NETWORK_EU  						AS [PDT.NETWORK_EU],
	ACT_REG_PDT_CHARAC_EU  				AS [PDT.Reg. product characteristics EU],
//EFFECTIVE_START_EU  					AS [PDT.Effective start date EU],
	FILE_TYPE_EU  						AS [PDT.File type EU],
	INDICATION_INFO_EU 					AS [PDT.Indication EU],
	INDICATION_PROGRESS_EU 				AS [PDT.Indication progress EU],
	MAIN_INDICATION_EU 					AS [PDT.Main indication EU],
//MAJOR_ATC4_EU  						AS [PDT.Major ATC4 EU],//V1, 07/06/2018, LMIZRAHITO - 29/07/2018 commented
	NAME_EU  							AS [PDT.Name EU],
	REAL_START_EU  						AS [PDT.Real start EU],
	STRENGTH_FILL_V_UOM_EU 				AS [PDT.Strength fill volume UOM EU],
	STRENGTH_FILL_VOLUMES_EU 			AS [PDT.Strength fill volumes EU],
	D_INNOV_APPROVAL_EU 				AS [PDT.Inn. approval date EU],
	D_INNOV_SUBMISSION_EU 				AS [PDT.Inn. submission date EU],//V1, 07/06/2018, LMIZRAHITO - Field name fixed from [PDT.Inn. submiision date US]
//D_PDUFA_EU 							AS [PDT.PDUFA date EU], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
//S_INNOV_APPROVAL_EU 					AS [PDT.S. Inn. approval EU], // the field should be replaced to the A/P format
	S_INNOV_SUBMISSION_A_OR_P_EU  		AS [PDT.Inn Submission A/P EU],
//S_PDUFA_A_OR_P_EU  					AS [PDT.PDUFA A/P EU], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
	ACT_START_INNOVATOR_APPR_EU 		AS [PDT.Act. start inn. approval EU],
	FIX_START_INNOV_APPR_EU 			AS [PDT.Fix start inn. approval EU],
	ACT_START_PHASE_1_EU 				AS [PDT.Act. start phase 1 EU],
	FIX_START_PHASE_1_EU 				AS [PDT.Fix start phase 1 EU],
	ACT_START_PHASE_2_EU 				AS [PDT.Act. start phase 2 EU],
	FIX_START_PHASE_2_EU 				AS [PDT.Fix start phase 2 EU],
	ACT_START_PHASE_3_EU 				AS [PDT.Act. start phase 3 EU],
	FIX_START_PHASE_3_EU 				AS [PDT.Fix start phase 3 EU],
	ACT_START_SUCCESS_PHASE_3_EU 		AS [PDT.Act. start success phase 3 EU],
	FIX_START_SUCCESS_PHASE_3_EU 		AS [PDT.Fix start success phase 3 EU],
	ACT_START_INNOV_SUBMIT_EU 			AS [PDT.Act. start inn. Submit EU],
	FIX_START_INNOV_SUBMIT_EU 			AS [PDT.Fix start inn. submit EU],
	ACT_START_INNOV_SUBMIT_PH_EU 		AS [PDT.Act. start inn. submit PH EU],
	FIX_START_INNOV_SUBMIT_PH_EU 		AS [PDT.Fix start inn. submit PH EU],
*/
//below added 2018-Oct-08 R.Sysiuk
	DISEASE_AREA						AS [PDT.Disease Area],
	SPECIALTY_INDICATION				AS [PDT.Teva Specialty Indication],
// 2020-01-27 - RSYSIUK
	EVAL_PHARMA_PDT_ID					as [PDT.Evaluate Pharma Product ID],
	DATA_MONITOR_PRODUCT				as [PDT.Data Monitor Product ID],
	DECISION_RESOURCE					as [PDT.Decision Resources Product ID],

//below added 2018-May-14 M.Jacobs
	MISSING_GAIN_FLAG 					AS [PDT.Missing Gain Flag],
	MISSING_DESC_FLAG 					AS [PDT.Missing Description Flag],
	MISSING_ROA_FORM_FLAG 				AS [PDT.Missing ROA/Form Flag],
	MISSING_ROA_FLAG 					AS [PDT.Missing ROA Flag],
	MISSING_FORM_FLAG 					AS [PDT.Missing Form Flag],
	MISSING_THERAPEUTIC_CLASS_FLAG 		AS [PDT.Missing ATC1 Flag],
	MISSING_STR_UOM_FLAG 				AS [PDT.Missing Strengths/UOM Flag],
	MISSING_ORIGIN_OF_MAT_FLAG 			AS [PDT.Missing Origin of Material Flag],
//below added 2019-02-15 RSYSIUK
	MISSING_INNOVATOR_CODE 				AS [PDT.Missing Innovator Code Flag],
	MISSING_INNOVATOR_COMPANY 			AS [PDT.Missing Innovator Company Flag],
	MISSING_INNOVATOR_BRAND_NAME		AS [PDT.Missing Innovator Brand Name Flag],
    OWNER AS [PDT.Owner]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PRODUCT.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab INDICATION
LET vStartTime = now();

[INDICATION]:
LOAD
	INDICATION_KEY					as [_IND.KEY],
    PRODUCT_KEY						as [_IND.PRODUCT_KEY],
	REGION_COUNTRY_KEY				as [_IND.REGION_COUNTRY_KEY],
	ACT_REG_PDT_CHARAC				as [IND.Regional Product Characteristics],
	EFFECTIVE_START					as [IND.Actual Start],
	FILE_TYPE						as [IND.File Type],
	INDICATION_INFO					as [IND.Indication],
	INDICATION_PROGRESS				as [IND.Indication Progress],
	MAIN_INDICATION					as [IND.Main Indication],
	MAJOR_ATC4						as [IND.Major ATC4],
	NAME							as [IND.Name],
	NETWORK							as [IND.WBS Element],
	PLM_ID							as [IND.Identifier],
	REAL_START						as [IND.Planned Start],
	STRENGTH_FILL_V_UOM				as [IND.Strength-fill Volume UOM],
	STRENGTH_FILL_VOLUMES			as [IND.Strength-fill Volumes],
    INNOV_APPROVAL_DATE				as [IND.Approval Date],
	INNOV_SUBMISSION_DATE			as [IND.Submission Date],
	PDUFA_DATE						as [IND.PDUFA Date],
    INNOV_APPROVAL_AP				as [IND.Approval AP],
	INNOV_SUBMISSION_AP				as [IND.Submission AP],
	PDUFA_AP						as [IND.PDUFA AP],
	START_PHASE_1					as [IND.Phase 1 Start Date],
	START_PHASE_2					as [IND.Phase 2 Start Date],
	START_PHASE_3					as [IND.Phase 3 Start Date],
	START_SUCCESS_PHASE_3			as [IND.Phase 3 Success Start Date],
	START_INNOV_SUBMIT				as [IND.Submition Start Date],
	START_INNOV_SUBMIT_PHASE		as [IND.Submition Phase Date],
	START_INNOV_APPROV				as [IND.Approval Start Date]
    //IND_PROGRESS_DATE_FOR_DISPLAY	as [IND.Last Progress Date],
	//IND_PROGRESS_INFO_PAD_DISPLAY	as [IND.Last Progress Comment]
FROM [lib://PLM_QVD (tevail_iayalon)\DIM_PLM_INDICATION.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab PROJECT
LET vStartTime = now();
PROJECT:
LOAD 
K_DEVELOPMENT_SITE						as [_PJT.DEVELOPMENT_SITE_KEY]
,K_MFG_SITES							as [_PJT.MFG_SITES_KEY]
,K_PRODUCT								as [_PJT.PRODUCT_KEY]
,REGION_COUNTRY_KEY						as [_PJT.REGION_COUNTRY_KEY]
,K_PROJECT								as [_PJT.KEY]
,K_PROJECT								as [_PROJECT_KEY]
,ACTAVIS_PROJECT_ID as [PJT.Actavis Project ID]
,ALLOCATION_COMMITEE_STATUS as [PJT.Allocation committee status]
,ANALYTICAL_MANAGER as [PJT.Analytical manager]
,ANDA_NUMBER as [PJT.ANDA number]
,ANDA_PROC_NUMB as [PJT.ANDA/ Procedure no. (Concatenation of all RA WP)]
,APPLICATION_NUMBER as [PJT.Application number]
,APPLICATION_TYPE as [PJT.Application Type]
,APPROVAL_TO_CLINICAL as [PJT.1st Approval to proceed to clinical study]
,APPROVED as [PJT.The file hAS been Approved by the regulatory authorities]
,B_ALLOC_CHANGED as [PJT.Allocation Changed]
,B_FIRST_TO_FILE as [PJT.First to file (GM)]
,B_IS_SPECIALTY_PROJECT as [PJT.Is a Specialty Project?]
,B_PJT_MGT_MEETING as [PJT.Project Management Meeting]
,BD_MANAGER as [PJT.Bd manager]
,BENCH_PRECLINICAL_POC as [PJT.PTRS Benchmark Preclinical/POC Stage]
,BENCH_PTRS_LOA as [PJT.PTRS Benchmark LOA For Current Progress]
,BENCH_PTRS_PH_I as [PJT.PTRS Benchmark Ph1]
,BENCH_PTRS_PH_II as [PJT.PTRS Benchmark Ph2]
,BENCH_PTRS_PH_III as [PJT.PTRS Benchmark Ph3]
,BENCH_PTRS_SUBMISSION as [PJT.PTRS Benchmark Submission]
,BIO_STRATEGY as [PJT.Bio Clinical Strategy]
,BIOCLINICAL_PROJECT_MANAGER as [PJT.BioClinical project manager]
,BIWEEKLY_REPORT_COMMENTS as [PJT.Bi-weekly report comments]
,BUDGET_COMMENT_CAPEX as [PJT.Budget Comment Capex]
,BUSCASE_CAPEX as [PJT.Business Case Capex]
,BUSINESS as [PJT.Business]
,CAPEX_ESTIMATION as [PJT.Commercial Capex(K$)]
,CAPEX_PJT_DESC as [PJT.Capex Project Desc]
,CAPEX_YTOT as [PJT.Commercial Total]
,CMAT_CU as [PJT.CMAT_CU]
,CMAT_EACHES as [PJT.CMAT_EACHES]
,CMAT_K_UN as [PJT.CMAT_K_UN]
,COM_CAPEX_Y1 as [PJT.Commercial Y1]
,COM_CAPEX_Y10 as [PJT.Commercial Y10]
,COM_CAPEX_Y2 as [PJT.Commercial Y2]
,COM_CAPEX_Y3 as [PJT.Commercial Y3]
,COM_CAPEX_Y4 as [PJT.Commercial Y4]
,COM_CAPEX_Y5 as [PJT.Commercial Y5]
,COM_CAPEX_Y6 as [PJT.Commercial Y6]
,COM_CAPEX_Y7 as [PJT.Commercial Y7]
,COM_CAPEX_Y8 as [PJT.Commercial Y8]
,COM_CAPEX_Y9 as [PJT.Commercial Y9]
,COMMERCIAL_UPDATES as [PJT.Commercial updates]
,COMMITMENT_NOTE as [PJT.Commitment Notes]
,COMMITMENT_YEAR as [PJT.Commitment Year]
,date(D_1ST_DAY_0) as [PJT.Day 0]
,date(D_1ST_DAY_105) as [PJT.Day 105]
,date(D_1ST_DAY_106) as [PJT.Day 106]
,date(D_1ST_FILE_CANCELLED) as [PJT.1st File Cancelled]
,date(D_1ST_PRE_LAUNCH_VARIATION) as [PJT.1st Pre Launch Variation]
,date(D_1ST_PROJECT_CREATED) as [PJT.Project created]
,date(D_1ST_REFUSE_TO_RECEIVE) as [PJT.1st Refuse to receive]
,date(D_1ST_REJECTED) as [PJT.1st Rejected]
,date(D_1ST_TENTATIVE_APPROVAL) as [PJT.1st Tentative Approval]
,date(D_1ST_VARIATION_APPROVAL) as [PJT.1st Variation Approval]
,date(D_ALLOCATION_COMMITEE) as [PJT.Allocation committee date]
,date(D_CREATION) as [PJT.Creation date]
,date(D_DEV_ALLOCATION_STATUS) as [PJT.Development allocation status date]
,date(D_DOSSIER_COMPLETE) as [PJT.1st Dossier Complete date]
// 2020-04-06 DISAIEV added a prefix PJT for the next field
,date(D_DUE_DATE_DUAL_USE_CER_APP) as [PJT.Due Date For Dual Use CER Approval]
,date(D_ENDORSMENT) as [PJT.Endorsement Date] 
,date(D_FDA_ACCEPTANCE) as [PJT.1st FDA acceptance]
,date(D_FINAL_PIVOTAL_REPORT) as [PJT.Final Pivotal Report Date]
,date(D_FIRST_APPROVAL) as [PJT.1st Approval date]
,date(D_FIRST_KICK_OFF_MEETING) as [PJT.1st Kick-off meeting Date]
,date(D_FIRST_LAUNCH) as [PJT.1st Launch Date] 
,date(D_FIRST_PIVOTAL_DOSING) as [PJT.1st First Pivotal Dosing Date]
,date(D_FIRST_SUBMISSION) as [PJT.1st Submission Date] 
,date(D_FORFEITURE) as [PJT.Forfeiture date]
,date(D_IMS_CMAT) as [PJT.IMS_CMAT_DATE]
,date(D_LFC_APPROVED) as [PJT.1st LFC approved]
,date(D_MARS) as [PJT.MARS]
,date(D_SAVED_ON_MFG_SITE) as [PJT.Saved On Maunfacturing Site]
,date(D_ON_HOLD_DUE) as [PJT.On hold due date]
,date(D_OPERATIONS_ALLOC_STATUS) as [PJT.Operations allocation status date]
,date(D_PDT_IMS_CMAT) as [PJT.MAT Date]
,date(D_PILOT_STUDIES_START) as [PJT.Pilot Studies Start Date]
,date(D_PJT_LSD) as [PJT.LSD]
,date(D_PJT_MGT_MEETING) as [PJT.Project Management Meeting Date]
,date(D_PRELIM_RES_LAST_PIVOTAL_FULL) as [PJT.1st 100% QC date]
,date(D_SELECTION) as [PJT.Selection Date] 
,date(D_STABILITY) as [PJT.1st Stability]
//,date(D_STABILITY_COMPLETE) as [PJT.Stability Complete date]
,date(D_STABILITY_COMPLETE) as [PJT.1st stability finish]
,date(D_SUBMISSION_BATCH) as [PJT.1st Manufacture Submission Batches]
,date(D_TECHNICAL_FILE_SENT) as [PJT.1st Submission File sent to submitter]
,date(D_TLD) as [PJT.1st TLD]
,date(D_VALIDATION_START) as [PJT.Validation start date]
,date(D_WITHDRAWN) as [PJT.1st Withdrawn]
// 2020-04-06 DISAIEV added a prefix PJT for the next field
,date(DUE_DATE_COM_CER_APPR) as [PJT.Due Date For Commercial CER Approval]
,DEV_ALLOCATION_REASON as [PJT.Dev allocation reason]
,DEV_ALLOCATION_STATUS as [PJT.Development allocation status]
,DEVELOPMENT_COUNTRIES as [PJT.Development Countries]
,DEVELOPMENT_SITE as [PJT.Development site]
,DUAL_USE_CAPEX as [PJT.Dual Use Capex]
,DUAL_USE_CAPEX_Y1 as [PJT.Dual Use Y1]
,DUAL_USE_CAPEX_Y10 as [PJT.Dual Use Y10]
,DUAL_USE_CAPEX_Y2 as [PJT.Dual Use Y2]
,DUAL_USE_CAPEX_Y3 as [PJT.Dual Use Y3]
,DUAL_USE_CAPEX_Y4 as [PJT.Dual Use Y4]
,DUAL_USE_CAPEX_Y5 as [PJT.Dual Use Y5]
,DUAL_USE_CAPEX_Y6 as [PJT.Dual Use Y6]
,DUAL_USE_CAPEX_Y7 as [PJT.Dual Use Y7]
,DUAL_USE_CAPEX_Y8 as [PJT.Dual Use Y8]
,DUAL_USE_CAPEX_Y9 as [PJT.Dual Use Y9]
,DUAL_USE_CAPEX_YTOT as [PJT.Dual Use Total]
,EXCLUDE_FROM_STR_APP as [PJT.exclude_from_str_app]
,EXCLUSIVITY_STATUS as [PJT.Exclusivity status (US)]
,EXT_UNITS as [PJT.EXT_UNITS]
,F_EXCLUSIVITY_STATUS_US				as [PJT.EXCLUSIVITY_STATUS_FLAG_US]
,F_EXPIRED_KICK_OFF_DATE				as [PJT.Expired Kick-off Date Flag]
,F_FIRST_SUBM_LATR_THAN_MARS			as [PJT.1st Submission later than MARS flag]
,F_FIRST_SUBMISSION_DATE				as [PJT.FIRST_SUBMISSION_DATE_FLAG]
,F_MISSING_FIRST_LAUNCH_DATE			as [PJT.LaunchDateNull_flag]
,F_LAUNCHES_ACTUALS						as [PJT.LAUNCHES_ACTUALS_FLAG]
,F_MISSING_MANUFACTURING_SITE			as [PJT.MANUFACTURING_SITE_FLAG]
,F_MISSING_BUSINESS						as [PJT.Missing business flag]
,F_MISSING_KICK_OFF_DATE				as [PJT.Missing Kick-off Date Flag]
,F_MISSING_MARS_DATE					as [PJT.Missing MARS Date flag]
,F_MISSING_MFG_SITE						as [PJT.Missing manufacturing site flag]
,F_MISSING_PACK_SITE					as [PJT.Missing pack site flag]
,F_MISSING_PROGRESS						as [PJT.Missing project progress flag]
,F_MISSING_STATUS						as [PJT.Missing project status flag]
,F_MISSING_TYPE							as [PJT.Missing project type flag]
,F_MISSING_PORTFOLIO_MANAGER			as [PJT.Missing portfolio project manager flag]
,F_MISSING_RELEASE_SITES				as [PJT.Missing release site flag]
,F_MISSING_TEST_SITES					as [PJT.Missing test site flag]
,F_MISTAKES_BIO_START					as [PJT.MISTAKES_BIO_START_FLAG]
,F_MISTAKES_FINAL_BIO_REPORT			as [PJT.MISTAKES_FINAL_BIO_RPT_FLAG]
,F_MISTAKES_STABILTY_DATE				as [PJT.MISTAKES_STABILTY_DATE_FLAG]
,F_MISTAKES_SUB_BATCH_DATE				as [PJT.MISTAKES_SUB_BATCH_DATE_FLAG]
,F_MISTAKES_SUBMISSION_DATE				as [PJT.MISTAKES_SUBMISSION_DATE_FLAG]
,F_MISSING_PROJECT_MANAGER				as [PJT.PROJECT_MANAGERS_FLAG]
,F_MISSING_SEGMENT						as [PJT.SegmentNull_flag]
,F_MISSING_FIRST_SUBM_DATE				as [PJT.SubmDateNull_flag]
,F_SUBMISSIONS_ACTUAL					as [PJT.SUBMISSIONS_ACTUALS_FLAG]
,F_MISSING_BIO_STRATEGY					as [PJT.BIO_STRATEGY_FLAG]
,F_MISSING_BIWEEKLY_COMMENTS			as [PJT.BIWEEKLY_COMMENTS_FLAG]
,F_MISSING_DEVELOPMENT_SITE				as [PJT.DEVELOPMENT_SITE_FLAG]
,FIRST_APPROVAL as [PJT.1st Approval A/P]
,FIRST_LAUNCH as [PJT.1st Launch A/P]
,FIRSTPIVOTALDOSINGDATE_1ST_PF as [PJT.First Pivotal dosing date Finish]
,GLOBAL_FINANCIAL_CODE as [PJT.Global Financial Code]
,GPMS_DOCUNID as [PJT.GPMS DOCUNID]
,IMS_KG as [PJT.IMS_KG]
,IND_PROGRESS_BRAND_STATUS_EU as [PJT.EU Progress brand status (regional innovator)]
,IND_PROGRESS_BRAND_STATUS_US as [PJT.US Progress brand status (regional innovator)]
,INDICATION as [PJT.Main indication]
,IP_OWNER_VALUE as [PJT.IP Owner]
,IS_A_DEV_PROJECT as [PJT.Is a dev project ?]
,IS_AN_OTC as [PJT.Is an OTC Project]
,IS_FOR_GBS_IMPEX as [PJT.Is for GBS interface (PLW_GBS_EXPORT_V) ?]
,IS_FOR_HYPERION_IMPEX as [PJT.Is for hyperion interface (PLW_GBS_EXPORT_V) ?]
// 2020-04-06 DISAIEV added a prefix PJT for the next field
,LATE_LAUNCH as [PJT.Launch latest]
,LATEST_PRJ_HIGHLIGHT as [PJT.Latest project highlight]
,LAUNCH_MGT_EX_SUM as [PJT.Launch Management Executive Summary]
//Renamed on Tamar's req.TASK02495643
//,LAUNCH_PLMD_COUNTRIES_MAIN as [PJT.PLMD main (countries)]
,LAUNCH_PLMD_COUNTRIES_MAIN as [PJT.IP Earliest - Main (Countries)]
//Renamed on Tamar's req.TASK02495643
//,LAUNCH_PLMD_EARLY_COUNTRIES as [PJT.PLMD early (countries)]
,LAUNCH_PLMD_EARLY_COUNTRIES as [PJT.IP Earliest - Early (Countries)]

,LAUNCH_STATUS as [PJT.Launch risk]
,LAUNCH_STRATEGY_COMMENTS as [PJT.Launch strategy comments]
,LAUNCH_TYPE as [PJT.Launch Type]
//,LEGAL_PJT_MEMBER as [PJT.Legal contact person]
,LICENSOR_NAME as [PJT.Licensor name]
//rename on Talya req 01122021
,LMD_DESC as [PJT.IP Latest comments]
//rename on talya req 01122021
,LMD_EARLY_2 as [PJT.IP Latest - early]
,LOCAL_PROJECT_CODE as [PJT.Local Project Code]
,MANUF_SUB_BATCHES_1ST_PF as [PJT.Manufacture Submission Batches 1st Finish]
,MARKET_ENTRY as [PJT.Market Entry (FTM)]
// 2020-04-06 DISAIEV added a prefix PJT for the next field
,MARKET_IN_SCOPE as [PJT.Markets In Scope]
,MASTER_DOSAGE_FORM as [PJT.Master dosage form]
//,MEDIS_REL as [PJT.Medis Relevance]
,MFG_ALLOCATION_COMMENTS as [PJT.Mfg Allocation comments]
,MFG_ALLOCATION_REASON as [PJT.Mfg allocation reason]
,MFG_PRO_EQUIPMENT_TRAIN as [PJT.MFG Process Equipment Train]
,MFG_SITES as [PJT.Manufacturing Sites]
,MUST_WIN as [PJT.Must win]
,N_CRYSTALINE_FORM as [PJT.Crystaline form]
,N_PROJECT_POS as [PJT.Project PoS (1-100%) ]
,NO_BIO_STUDY_REQUIRED as [PJT.No Bio Study Required]
,ONB as [PJT.Internal number]
,OPERATIONS_ALLOCATION_STATUS as [PJT.Operations allocation status]
,OTC_FRANCHISE as [PJT.OTC franchise]
,PACK_ALLOCATION_REASON as [PJT.Pack allocation reason]
,PACK_SITES as [PJT.Packaging Sites]
,PDCT_FILL_V_UOM as [PJT.Global Product| Fill volume UOM]
,PDCT_STRENGTH_FILL_V_UOM as [PJT.Strength/ F. Volume UOM]
,PDCT_STRENGTH_UOM as [PJT.Global Product| Strength UOM]
,PDT_INNOV_BRAND_NAME as [PJT.Innovator Brand name]
,PDT_PLFD_DESC as [PJT.PLFD description]
,PDT_WBS_ONB as [PJT.Product WBS ONB]
,PHARMA_MANAGER as [PJT.Pharma manager]
,PHASE_I_ALLOC_REASON as [PJT.Phase I Allocation Reason]
,PHASE_I_SITE as [PJT.Phase I Production Sites]
,PHASE_II_ALLOC_REASON as [PJT.Phase II Allocation Reason]
,PHASE_II_SITE as [PJT.Phase II Production Sites]
,PHASE_III_ALLOC_REASON as [PJT.Phase III Allocation Reason]
,PHASE_III_SITE as [PJT.Phase III Production Sites]
,PILOT_STUDIES_START_DATE_A_P as [PJT.Pilot Studies Start Date A/P]
,PIPELINE_MANAGER as [PJT.Pipeline Manager]
//renamed on Talya request 01122021
,PLMD_EARLY as [PJT.IP Earliest - early]
,PLMD_EARLY_MAIN as [PJT.PLMD main]
,PMAT_CU as [PJT.PMAT_CU]
,PMAT_EACHES as [PJT.PMAT_EACHES]
,PMAT_EXT_UNITS as [PJT.PMAT_EXT_UNITS]
,PMAT_K_UN as [PJT.PMAT_K_UN]
,PMAT_SALE_KDOL as [PJT.PMAT_SALE_KDOL]
,PORTFOLIO_MANAGER as [PJT.Portfolio Project Manager]
,PRECLINICAL_POC as [PJT.PTRS Preclinical/POC Stage]
// 2020-10-02 KBODNAR Removed next field
//,PRJ_GLOBAL_PDT_TECH as [PJT.Global product technology]
//Renamed on Tamar's req.TASK02495643
//,PRJ_LMD_EARLY_COUNTRIES as [PJT.LMD early (countries)]
,PRJ_LMD_EARLY_COUNTRIES as [PJT.IP Latest - Early (Countries)]
//Renamed on Tamar's req.TASK02495643
//,PRJ_LMD_EARLY_COUNTRIES_MAIN as [PJT.LMD main (countries)]
,PRJ_LMD_EARLY_COUNTRIES_MAIN as [PJT.IP Latest - Main (Countries)]
,PRJ_LMD_EARLY_MAIN as [PJT.LMD main]
,PRJ_SOURCE_PRJ as [PJT.Source project ID]
,PRJ_SUB_PLFD_EARLY as [PJT.PLFD early]
,PROD_DESCRIPTION as [PJT.Product Description]
,PRODUCT as [PJT.Product]
,PRODUCT_DOSAGE_FORM as [PJT.Product dosage form]
,PRODUCT_FTF as [PJT.Product Strength | FTF]
,PRODUCT_HANDLING_CATEGORY as [PJT.Product Handling category]
,PRODUCT_LABEL as [PJT.Product label]
,PRODUCT_STATUS as [PJT.Product | Status]
,PROGRESS as [PJT.Progress]
,PROJECT_CODE as [PJT.Project Code]
,PROJECT_LICENSEE as [PJT.Licensee]
,PROJECT_NAME as [PJT.Project Name]
,PROJECT_POS_COMMENTS as [PJT.Project PoS Comments]
,PROJECT_RATIONALE as [PJT.Project Rationale]
,PROJECT_STR_FV_FTF as [PJT.Project FTF]
,PROJECT_TECHNOLOGY as [PJT.Project Technology]
,PROJECT_TYPE as [PJT.Project type]
,PROMOTION_PLAN as [PJT.Promotion plan]
,PTLD as [PJT.1st PTLD]
,PTRS_LOA as [PJT.PTRS LOA Based On Current Progress]
,PTRS_PH_I as [PJT.PTRS Ph1]
,PTRS_PH_II as [PJT.PTRS Ph2]
,PTRS_PH_III as [PJT.PTRS Ph3]
,PTRS_SUBMISSION as [PJT.PTRS Submission]
,PV_LAUNCH_DRIVER as [PJT.Launch driver]
,PV_NON_NME_NCE as [PJT.Non-NCE/NME]
,RA_CONTACT as [PJT.RA contact]
,RA_STRAT_COMMENTS as [PJT.RA comments]
,RA_STRAT_FILING_STRAT as [PJT.Project filing strategy for impex]
,RATIONALE_COMMENTS as [PJT.Project rationale comments]
,RECEIVING_SITE as [PJT.Receiving Site]
,REG_COMMENTS as [PJT.Regulatory comments]
,REG_COUNTRY_PRODUCT as [PJT.regional or country product related to project]
,REGIONAL_LAUNCH_MANAGER as [PJT.Regional launch manager]
,REGISTRATION_TYPE as [PJT.Registration Type]
,RELEASE_ALLOCATION_REASON as [PJT.Release allocation reason]
,RELEASE_SITES as [PJT.Release Sites]
,RLD_AVAILABILITY as [PJT.RLD Availability]
,RLD_STRENGTHS as [PJT.RLD Strengths]
,RND_ACTION_ITEMS as [PJT.R&D Action Items]
,RND_PROJECT_MANAGER as [PJT.R&D Project Manager]
,S_1ST_DAY_0 as [PJT.Day 0 A/P]
,S_1ST_DAY_105 as [PJT.Day 105 A/P]
,S_1ST_DAY_106 as [PJT.Day 106 A/P]
,S_1ST_FILE_CANCELLED as [PJT.1st File Cancelled A/P]
,S_1ST_PRE_LAUNCH_VARIATION as [PJT.1st Pre Launch Variation A/P]
,S_1ST_PTLD as [PJT.1st PTLD A/P]
,S_1ST_REFUSE_TO_RECEIVE as [PJT.1st Refuse to receive A/P]
,S_1ST_REJECTED as [PJT.1st Rejected A/P]
,S_1ST_TENTATIVE_APPROVAL as [PJT.1st Tentative Approval A/P]
,S_1ST_TLD as [PJT.1st TLD A/P]
,S_1ST_VARIATION_APPROVAL as [PJT.1st Variation Approval A/P]
,S_APPROVAL_TO_CLINICAL as [PJT.1st Approval to proceed to clinical study A/P]
,S_APPROVED as [PJT.The file hAS been Approved by the regulatory authorities A/P]
,S_DOSSIER_COMPLETE_DATE as [PJT.1st Dossier Complete date A/P]
,S_EXPENSE_DEFINITION as [PJT.Reimbursement type]
,S_FDA_ACCEPTANCE as [PJT.1st FDA acceptance A/P]
,S_FINAL_PIVOTAL_REPORT_DATE as [PJT.Final Pivotal Report Date A/P]
,S_FIRST_KICK_OFF_MEETING as [PJT.1st Kick-off meeting Date A/P]
,S_FIRST_PIVOTAL_DOSING as [PJT.1st First Pivotal Dosing Date A/P]
,S_FIRST_SUBMISSION as [PJT.1st Submission A/P]
,S_FIRSTPIVOTALDOSING_DATE_PF as [PJT.First Pivotal dosing date Finish 1st A/P]
,S_GEN_OPS_RA_NOTES as [PJT.Gen OPS RA Notes]
,S_LFC_APPROVED as [PJT.1st LFC approved A/P]
,S_MANUF_SUB_BATCHES_1ST_PF as [PJT.Manufacture Submission Batches 1st Finish A/P]
,S_OPS_DOSAGE_TYPE as [PJT.Ops dosage type]
,S_PRELIM_RES_LAST_PIVOTAL_FULL as [PJT.1st 100% QC date A/P]
,S_PRJ_LIST_COUNTRIES_LAUNCH as [PJT.List of countries (launch)]
,S_RD_GNPI_COMMENTS as [PJT.R&D - GNPI Comments]
,S_STABILITY as [PJT.1st Stability A/P]
//,S_STABILITY_COMPLETE as [PJT.Stability Complete date A/P]
,S_STABILITY_COMPLETE as [PJT.1st stability finish A/P]
,S_SUBMISSION_BATCH as [PJT.1st Manufacture Submission Batches A/P]
,S_SUBMISSION_BATCH_MAN as [PJT.1st Submission Batch Manuf. Started A/P]
,S_TECH_FILE_SENT as [PJT.1st Submission File sent to submitter A/P]
,S_WITHDRAWN as [PJT.1st Withdrawn A/P]
,S_YEAR_FTF_CONFIRMED as [PJT.Year FTF Confirmed]
,SALES_KDOL as [PJT.SALES_KDOL]
,SALES_KEUR as [PJT.SALES_KEUR]
,SALES_KLC as [PJT.SALES_KLC]
,SEGMENT as [PJT.Segment]
,SENDING_SITE as [PJT.Sending Site]
,SENIOR_PROJECT_LEADER as [PJT.Project Leader]
,SITE_LAUNCH_MANAGER as [PJT.Site launch manager]
,SITE_TRANSFER as [PJT.Site transfer]
,SP_PROJECT_ATTRIBUTES as [PJT.Project Attributes]
,SP_PROJECT_NAME as [PJT.Specialty Project Name]
,SPECIFIC_CAPEX_REQ as [PJT.Specific Capex Required]
,STATUS as [PJT.Status]
,STD_UN as [PJT.STD_UN]
,STR_FILL_V_UOM_DISPLAY2 as [PJT.Strengths (Fill volumes + UOMs) UOMs]
,STRATEGY_COMMENTS as [PJT.Strategy summary]
,STRATEGY_NPV as [PJT.NPV]
,STRENGTHS_FILL_VOLUMES as [PJT.Strengths-Fill volumes]
,SUB_BATCH_MFG_SITE as [PJT.Sub. Batch Mfg. site]
,SUB_PACK_CONF_OR_PACK as [PJT.Submission Packaging CONF OR PACK]
,SUBMISSION as [PJT.Submission]
,SUBMISSION_COMMITMENT as [PJT.Submission Commitment]
,SUBMISSION_RISK as [PJT.Submission Risk]
,SUBMISSION_RISK_NOTES as [PJT.Submission Risk Notes]
,SUBMISSION_TYPE as [PJT.Submission type]
,SUPPLIER_NAME as [PJT.Supplier name]
,T_LEGAL as [PJT.Legal Comments]
,T_SPECIAL_REQ_COM as [PJT.Special requirments/comments]
,TAPI_API as [PJT.TAPI Y/N]
,TARGET_PRJ as [PJT.Target project(s) ID]
,TEST_ALLOCATION_REASON as [PJT.Test allocation reason]
,TEST_SITES as [PJT.Testing Sites]
,THERAPEUTIC_CLASS as [PJT.Product Therapeutic class ATC1]
,TOTAL_PRJ_VARIABLE_BUDGET as [PJT.Business case Total project variable budget]
,TPO_REGION as [PJT.TPO Region ]
,TRACE_COMMENT_NOTEPAD as [PJT.information]
,TRI_WEEKLY_RA_NOTES as [PJT.Tri-weekly RA notes]
,TRI_WEELY_STATUS as [PJT.Tri-weekly Status]
,VALIDATION_NOTES as [PJT.Validation Notes]
,D_YEAR_1_CAPEX as [PJT.Year 1 Capex]
,NO_OF_BATCHES	as [PJT.NO OF BATCHES]
,NPI_COMMENTS	as [PJT.NPI COMMENTS]
,STABILITY_ZONE	as [PJT.Stability Zones]
,PLANNED_SHELF_LIFE	as [PJT.Planned Shelf Life On Launch]
,BRAND_PACK_CONF	as [PJT.Brand Package Configuration]
,MEDIS_RELEVANCE	as [PJT.Medis Relevance]
,NON_STD_PRODUCT	as [PJT.Nonstandard product]
,NOT_COUNTED_LAUNCH as [PJT.Notcounted launch]
// added by O.Voloshchuk on 17/02/2021


,TPO_COMMENTS as [PJT.Site/TPO comments]
//added by O.Voloshchuk
,GAIN_N_N as [PJT.GAIN (n-n)]
,IS_IN_SOURCE_SYSTEM as [_PJT.IS_IN_SOURCE_SYSTEM]
//added only to use in GAIN to API report in Control app
, PRJ_GAIN as [_PJT.PRJ_GAIN]
//added on 2021-05-18 by Olga Voloshchuk
,PACKAGING_NOTES as [PJT.Production and packaging comments]
//Use this field for EU project req. from Anastasia fro R&D
,STRAT_FILING_EU as [PRJ.Strat Filing EU]
//2021-06-31 Olga Voloshchuk                  added PRODUCT_STRATEGY_MANAGER in Project for HiH Npi report
,PRODUCT_STRATEGY_MANAGER as [PRJ.Product Strategy Manager]
//added by o.Voloshchuk on 20210805 to add in the R&D Generic report
 ,HIH_INITIATION_A_OR_P as [PJT.HiH Initiation Date A/P] 
 ,date(HIH_INITIATION) as [PJT.HiH Initiation Date]
 ,HANDOVER_A_OR_P as [PJT.Handover Date A/P]
 ,date (HANDOVER)       as [PJT.Handover Date]   
 //added by O.Voloshchuk on 27082021 on req for Anasatsia 
 ,date (TARGET_VAL_MFG_START) as [PJT.Target Validation Manufacture Start Date]
 ,date ( PROCESS_DESIGN_MFG_START) as [PJT.Process Design Manufacture Start Date]
 ,date(API_ORDER_FOR_VALIDATION) as [PJT.API Order for Validation and Launch Build Date]
 ,VALIDATION_MFG_START_A_P as [PJT.Target Validation Manufacture Start A/P]
 ,PROCESS_DESIGN_MFG_AP as [PJT.Process Design Manufacture Start A/P]
 ,API_ORDER_FOR_VAL_A_P as [PJT.API Order for Validation and Launch Build A/P]
 //added by O.Voloshchuk on 27082021 on req for Anasatsia
 //added by O.Voloshchuk on 04122021 on Nimrod req. TGO report
 ,SITE_TPO_LAUNCH_MANAGER as [PJT.Site/TPO launch manager],
 //added PLP fields by Olga Voloshchuk 01-12-2022
PRJ_OVERVIEW			as		[PJT.PLP Project Overview],
TGO_SEG_SEND_SITE			as		[PJT.PLP TGO Segment (Sending Site)],
TGO_SEG_REC_SITE			as		[PJT.PLP TGO Segment (Receiving Site)],
PLP_MARKET_REG_SKU			as		[PJT.PLP Market Region],
PLP_MARKET_SKU			as		[PJT.PLP Markets],
EMSO_REGION			as		[PJT.PLP EMSO Region],
SENDING_MFG_SITE			as		[PJT.PLP Sending Mfg Site],
RECEI_MFG_SITE			as		[PJT.PLP Receiving Mfg Site],
PLP_SEND_PRIM_PKG_SITE			as		[PJT.PLP Sending Primary Pkg Site],
PLP_SEND_SEC_PKG_SITE			as		[PJT.PLP Sending Secondary Pkg Site],
RECEI_PRIM_PKG_SITE			as		[PJT.PLP Receiving Primary Pkg Site],
PLP_RECEI_SEC_PKG_SITE			as		[PJT.PLP Receiving Secondary Pkg Site],
PLP_PRJ_GROUP			as		[PJT.PLP Project Group],
PLP_INITIATIVE			as		[PJT.PLP Initiative],
PLP_PRIORITY			as		[PJT.PLP Priority],
IN_LINE_PROJECT_MANAGER			as		[PJT.PLP In Line Project Manager],
PROGRAM_MANAGER			as		[PJT.PLP Program Manager],
PLP_RA_SUBMISSION			as		[PJT.PLP RA Submission],
PLP_PDT_SHELF_LIFE			as		[PJT.PLP Product Shelf-Life (Months)],
date((BRIDGE_SCK_COVERS)	)	as		[PJT.PLP Bridge Stock Coverage],
OOS_RISK			as		[PJT.PLP Out Of Stock Risk],
PLP_OOS_DETAIL			as		[PJT.Details about Out Of Stk],
PLP_SKU_CHANGE_REQ			as		[PJT.PLP SKU Change Required],
PLP_CURR_API_SOURCE			as		[PJT.PLP Current API Source],
PLP_FUT_API_SOURCE			as		[PJT.PLP Future API Source],
PLP_CURR_API_PRICE			as		[PJT.PLP Current API price ($/kg)],
PLP_FUT_API_PRICE			as		[PJT.PLP Future API price ($/kg)],
PLP_ANN_API_QTY			as		[PJT.PLP Annual API Quantity(kg)],
PLP_EST_API_SAV			as		[PJT.PLP Estimated API Savings ($)],
PLP_AOP_CAT			as		[PJT.PLP AOP Category / Project Rationale],
GILP_ID			as		[PJT.PLP GILP ID],
PLP_PSNEXT_REF			as		[PJT.PLP PS Next Reference],
PLP_SKUS			as		[PJT.PLP SKU],
PLP_SEND_TEST_SITE			as		[PJT.PLP Sending testing sites],
PLP_FUT_SEND_RELEASE_SITE			as		[PJT.PLP Sending Release sites],
PLP_SEND_STAB_TEST_SITE			as		[PJT.PLP Sending Stability Testing sites],
PLP_REC_TEST_SITE			as		[PJT.PLP Receiving testing sites],
PLP_REV_RELEASE_SITE			as		[PJT.PLP Receiving Release sites],
PLP_REC_STAB_TEST_SITE			as		[PJT.PLP Receiving Stability Testing sites],
PLP_PERCENT_COMPLETE			as		[PJT.PLP % Completion],
PLP_DOSSIER			as		[PJT.PLP Dossier #],
PLP_AMSO_PRJ			as		[PJT.PLP AMSO Project ID],
date(PLP_ASOFDATE)			as		[PJT.PLP As of Date],
REGION_MARKET_SKU			as		[PJT.PLP SKU Related Regions/Markets (SKU Market per Region)],
//removed as for the PLP we use the same strenght as for pipline projects
//PRJ_STRENGTHS			as		[PJT.PLP Strength],
NITRO_AFFECTED_PRJ			as		[PJT.PLP Nitrosamine Affected Project],
//remove -for PLP applies the same dosage form as for pipline projects from product
//DOSAGE_FORM			as		[PJT.PLP Dosage Form],
PLP_PRJ_TYPE			as		[PJT.PLP Project type],
PRJ_RND_PROGRESS			as		[PJT.PLP R&D Project Progress],
PLP_API_STOCK_COVER			as		[PJT.PLP API Bridge Stock Coverage],
PLP_API_STOCK_QTY			as		[PJT.PLP API Bridge Stock Quantity (kg)],
RECEIV_BULK_MFG_ALLOC_REASON			as		[PJT.PLP Receiving Bulk Mfg. Allocation Reason],
RECEIV_BULK_MFG_ALLOC_COMMENTS			as		[PJT.PLP Receiving Bulk Mfg. Allocation Comments],
// field is indicating if the project is PLP or not (yes-no)
PLP_PROJECT as  [PJT.PLP Project Y/N],


//added PLP fields by Olga Voloshchuk 01-12-2022
//new plp fields 16/03/2023
PLP_FUT_STAB_TEST_SITE		as	[PJT.PLP Future Stability Testing Site],
PLP_FUT_REL_TEST_SITE		as	[PJT.PLP Future Release Testing site],
PLP_PRJ_COUNTRIES		as	[PJT.PLP PLP Project Countries],
date(MAJOR_COMM_SUPPLY)		as	[PJT.PLP WP Commitment date - Commercial Supply],
date(MAJOR_REGULATORY_SUBMISSION)		as	[PJT.PLP WP Commitment date - Regulatory Submission],
date(MAJOR_SUB_BATCH_MFG)		as	[PJT.PLP WP Commitment date - Sub Batch Mfg],
date(MAJOR_TTD)		as	[PJT.PLP WP Commitment date - TTD],
date(PLP_COMM_SUPPLY_FOR_MAJOR)		as	[PJT.PLP 1st Commercial Supply for Major],
date(PLP_REG_SUB_FOR_MAJOR)		as	[PJT.PLP 1st Regulatory Submission for Major],
date(PLP_SUB_BATCH_MFG_FOR_MAJOR)		as	[PJT.PLP 1st Submission Batch Mfg for Major],
PLP_TTD_FOR_MAJOR		as	[PJT.PLP 1st TTD for Major],
COMM_SUPPLY_FOR_MAJOR_A_P		as	[PJT.PLP 1st Commercial Supply for Major A/P],
PLP_REG_SUB_FOR_MAJOR_A_P		as	[PJT.PLP 1st Regulatory Submission for Major A/P],
SUB_BATCH_MFG_FOR_MAJOR_A_P		as	[PJT.PLP 1st Submission Batch Mfg for Major A/P],
PLP_TTD_FOR_MAJOR_A_P		as	[PJT.PLP 1st TTD for Major A/P],
if(WildMatch(SP_PROJECT_ATTRIBUTES,'*Biosimilar product*')>0,'Y','N') as [PJT.Biosimilar Y/N],
PRJ_TOP_PROJECT as [PJT.Top Project],
date(SMALL_SCALE_BATCH_MNF_R_D_DATE) as [PRJ.Small scale batch manufacturing R&D],
CPD_DEVICE_SITE as [PRJ.CPD Device Site],
MAIN_MARKET as [PRJ.Main market],
date(SUPPLY_NEXT_YEAR) as 	[PJT.PLP WP Commitment date Next Year - Commercial Supply],	
SUB_NEXT_YEAR		as [PJT.PLP WP Commitment date Next Year - Regulatory Submission],
MFG_NEXT_YEAR	as [PJT.PLP WP Commitment date Next Year - Sub Batch Mfg],	
TTD_NEXT_YEAR	as [PJT.PLP WP Commitment date Next Year - TTD]	,
SIGNATURE_LA    as [PJT.Signature date (LSA)],
CROWN_JEWELS    as [PJT.Medis Crown jewels],
date(DOCUMENT_TTD_EARLIEST)   as  [PJT.Current Start Date Technology Transfer Document (TTD)],
DOCUMENT_TTD_EARLIEST_AP      as  [PJT.Current Dates Technology Transfer Document (TTD)],
date(MFG_INITIATION_EARLIEST) as  [PJT.Current Start Date Submission Batches Manufacturing Initiation],
MFG_INITIATION_EARLIEST_AP    as  [PJT.Current Dates Submission Batches Manufacturing Initiation],
date(REG_SUBMISSION_EARLIEST) as  [PJT.Current Start Date Regulatory Submission],
REG_SUBMISSION_EARLIEST_AP    as  [PJT.Current Dates Regulatory Submission],
date(COMM_SUP_1ST_DELIVERY_EARLIEST)  as  [PJT.Current Start Date Commercial Supply - 1st Delivery],
date(COMM_SUP_1ST_DELIVERY_LATEST)    as  [PJT.Commercial supply to last market – planned start],
COMM_SUPPLY_1ST_DELIVERY_AP           as  [PJT.Current Dates Commercial Supply - 1st Delivery]
,TOP_PROJECT		                  as  [PJT.Top project]   
,MOA                                  as  [PJT.MoA]	
,LOE		                          as  [PJT.LoE]
,HIGH_LEVEL_STATUS                    as  [PJT.high level status/ risk summary]		
,COMPETITOR_LANDSCAPE                 as  [PJT.Competitor Landscape]		






//new PLP fields 16/03/2023
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT.QVD](qvd)
;

///////////////////////////////////////////////////////////////////////////////////////////////
PROJECT_HIST: //2018-11-05, RSYSIUK	added //2019-01-02	RSYSIUK	changed
NoConcatenate 
LOAD 
	[PROJECT_CODE]			AS [PJT.Project Code]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] <> 1
and [VERSION] = 1
and [TO_DATE] >= YearStart(Today())
and [STATUS] = 'Active' and Year([FIRST_SUBMISSION_DATE]) = Year(Today())
;

Concatenate(PROJECT_HIST)
LOAD 
	[PROJECT_CODE]			AS [PJT.Project Code]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] <> 1
and [VERSION] <> 1
and [FROM_DATE] < YearStart(Today())
and [TO_DATE] >= YearStart(Today())
and [STATUS] = 'Active' and Year([FIRST_SUBMISSION_DATE]) = Year(Today())
;

Inner Join(PROJECT_HIST)
LOAD 
	[PROJECT_CODE]			AS [PJT.Project Code]
    FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] = 1
and (WildMatch(STATUS,'Cancelled','On Hold') or Year(FIRST_SUBMISSION_DATE) > Year(Today()))
;

Left Join(PROJECT) //2018-11-05, RSYSIUK
LOAD
	[PJT.Project Code],
    1						AS [_FLAG_MOVED_TO_NEXT_YEAR_OR_CANCELED_ORON_HOLD]
Resident PROJECT_HIST
;
Drop Table PROJECT_HIST;

///////////////////////////////////////////////////////////////////////////////////////////////
[PJT/Manufacturing Sites]:
Load *,
Pick(WildMatch([PJT.Manufacturing Site (single value)],'*Kfar-Saba*','*Salt Lake City*','*Zagreb*','*Jerusalem*','*Contract Manufacturing*','*Haarlem*','*Goa*'),'Kfar-Saba','Salt Lake City','Zagreb','Jerusalem','TPO','Haarlem','Goa') as [PJT.Manufacturing Group of Sites]
;
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.Manufacturing Sites],',')) as [PJT.Manufacturing Site (single value)]
Resident PROJECT;

[PJT/Development Sites]:
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.Development site],',')) as [PJT.Development Site (single value)]
Resident PROJECT;

[PJT/Packaging Sites]:
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.Packaging Sites],',')) as [PJT.Packaging Site (single value)]
Resident PROJECT;




//Added on 18052021 for the new project permission group CMO & external sites (Non DEV/MNF)
[PJT/Release Sites]:
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.Release Sites],',')) as [PJT.Release Sites (single value)]
Resident PROJECT;
[PJT/Testing Sites]:
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.Testing Sites],',')) as [PJT.Testing Sites (single value)]
Resident PROJECT;

[PJT_SITES (Non DEV/MNF)]:
Load [_PROJECT_KEY], 
[PJT.Release Sites (single value)] as [PJT.Site.Value (Non DEV/MNF)],
'Release Sites' as [PJT.Site.Name (Non DEV/MNF)]
Resident [PJT/Release Sites];
Concatenate
Load [_PROJECT_KEY], 
[PJT.Testing Sites (single value)] as [PJT.Site.Value (Non DEV/MNF)],
'Testing Sites' as [PJT.Site.Name (Non DEV/MNF)]
Resident [PJT/Testing Sites];
Concatenate
Load [_PROJECT_KEY], 
[PJT.Packaging Site (single value)] as [PJT.Site.Value (Non DEV/MNF)],
'Packaging Site' as [PJT.Site.Name (Non DEV/MNF)]
Resident [PJT/Packaging Sites];
//End of Added on 18052021 for the new project permission group CMO & external sites (Non DEV/MNF)





[PJT_SITES]:
Load [_PROJECT_KEY], 
[PJT.Manufacturing Site (single value)] as [PJT.Site.Value],
'Manufacturing Site' as [PJT.Site.Name]
Resident [PJT/Manufacturing Sites];
Concatenate
Load [_PROJECT_KEY], 
[PJT.Development Site (single value)] as [PJT.Site.Value],
'Development Site' as [PJT.Site.Name]
Resident [PJT/Development Sites];
Concatenate
Load [_PROJECT_KEY], 
[PJT.Packaging Site (single value)] as [PJT.Site.Value],
'Packaging Site' as [PJT.Site.Name]
Resident [PJT/Packaging Sites];

///////////////////////////////////////////////////////////////////////////////////////////////
//13032023 Added for PLP single site
NoConcatenate
[PJT/PLP Site Temp1]:
Load Distinct [_PJT.KEY] as [_PROJECT_KEY],
Trim(SubField([PJT.PLP Receiving Mfg Site]
&','&[PJT.PLP Sending Primary Pkg Site]
&','&[PJT.PLP Sending Secondary Pkg Site]
&','&[PJT.PLP Receiving Primary Pkg Site]
&','&[PJT.PLP Receiving Secondary Pkg Site]
&','&[PJT.PLP Sending Mfg Site]
&','&[PJT.PLP Receiving Mfg Site]
&','&[PJT.PLP Sending Primary Pkg Site]
&','&[PJT.PLP Sending Secondary Pkg Site]
&','&[PJT.PLP Receiving Primary Pkg Site]
&','&[PJT.PLP Receiving Secondary Pkg Site],',') ) as [PJT.PLP Site con]
Resident PROJECT;
NoConcatenate
Temp:
Load Distinct
 [_PROJECT_KEY]
 ,[PJT.PLP Site con] as [PJT.PLP Site single value]

 Resident [PJT/PLP Site Temp1]
  where len(trim([PJT.PLP Site con]))>0 ;
 Drop Table [PJT/PLP Site Temp1];
 rename table Temp to [PJT/PLP Site];
 
 //13032023 Added for PLP single site
ip_owners_flags:
Load Distinct [_PJT.KEY],
left(SubField([PJT.IP Owner],'(',2),3) as flag
Resident PROJECT;
Concatenate
Load Distinct [_PJT.KEY],
lower(SubField(trim(SubField([PJT.Development site],',')),' ')) as flag
Resident PROJECT;
Concatenate
Load Distinct [_PJT.KEY],
lower(SubField(trim(SubField([PJT.Manufacturing Sites],',')),' ')) as flag
Resident PROJECT;

ip_owners:
//PJT.IP Owner/PJT.Dev.Site/PJT.Manuf.Site - user_name
Load * Inline [flag, _PJT.IP Owner Username
721, Milan Brkan
zagreb, Milan Brkan
721, IVANA SKOKO-BONIC
zagreb, IVANA SKOKO-BONIC
361, Claire Kellow
toronto, Claire Kellow
001, Eran Hadad
744, Eran Hadad
kfar-saba, Eran Hadad
jerusalem, Eran Hadad
godollo, Eran Hadad
debrecen, Eran Hadad
];

Inner Join
Load Distinct flag,
	[_PJT.KEY] as [_PROJECT_KEY]
Resident ip_owners_flags;
Drop Table ip_owners_flags;
Drop Field flag;

///////////////////////////////////////////////////////////////////////////////////////////////

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);


///$tab TGO
LET vStartTime = now();

[TGO_SEGMENT]:
LOAD
	MFG_SITES 		AS 	[PJT.Manufacturing Sites]
, 	TGO_SEGMENT   	AS  [TGO.TGO segmnent]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_TGO_SEGMENT.QVD] (qvd);

//FROM [lib://PLM_QVD (tevail_iayalon)\DIM_PLM_INDICATION.QVD](qvd);

//store * from [TGO_SEGMENT] into [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\TGO_SEGMENT.QVD];

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab Medical Writing Monthly Milestone
LET vStartTime = now();

DIM_MEDICAL_MILESTONE:
Load 
  R_NUM					AS R_NUM_99 
, PROJECT_KEY 			AS PROJECT_KEY_99
, WP_KEY				AS WP_KEY_99
, PROJECT				AS PROJECT_99
, MILESTONE_CATEGORY	AS MILESTONE_CATEGORY_99
, CLINICAL_STUDY_PHASE	AS CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY		AS LEGEND_CATEGORY_99
, PROTOCOL_NUMBER		AS PROTOCOL_NUMBER_99
, ACTIVITY_NAME			AS ACTIVITY_NAME_99
, MILESTONE_DATE 		AS MILESTONE_DATE_99
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_MEDICAL_MILESTONE.QVD](qvd);


DIM_MEDICAL_MILESTONE_ALL:
Load 
  R_NUM_99 
, PROJECT_KEY_99
, PROJECT_99
, PROJECT_KEY_99 as _PROJECT_KEY
Resident DIM_MEDICAL_MILESTONE;

//M_1
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_1
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_1
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_1
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),0))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_2
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_2
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_2
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_2
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),1))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_3
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_3
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_3
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_3
//, w.ACTIVITY_NAME
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),2))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_4
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_4
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_4
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_4
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),3))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_5
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_5
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_5
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_5
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),4))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_6
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_6
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_6
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_6
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),5))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_7
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_7
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_7
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_7
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),6))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_8
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_8
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_8
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_8
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),7))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_9
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_9
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_9
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_9
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),8))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_10
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_10
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_10
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_10
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),9))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_11
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_11
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_11
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_11
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),10))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_12
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_12
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_12
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_12
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),11))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_13
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_13
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_13
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_13
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),12))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_14
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_14
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_14
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_14
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),13))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_15
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_15
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_15
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_15
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),14))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_16
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_16
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_16
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_16
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),15))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

//M_17
Left Join(DIM_MEDICAL_MILESTONE_ALL)
Load 
if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_99
//, if(PROJECT_99=peek(PROJECT_99,-1),peek(R_NUM_99,-1)+1,1) as R_NUM_17
, PROJECT_99
//, MILESTONE_CATEGORY_99
//, CLINICAL_STUDY_PHASE_99
, LEGEND_CATEGORY_99 AS LEGEND_CATEGORY_17
, if(MILESTONE_CATEGORY_99='Clinical',ACTIVITY_NAME_99 &' '& PROTOCOL_NUMBER_99,ACTIVITY_NAME_99) AS MILEST_MED_17
//, ACTIVITY_NAME_99
//, PROTOCOL_NUMBER_99
//, MILESTONE_DATE_99
Resident DIM_MEDICAL_MILESTONE
where 1=1 and MonthEnd(MILESTONE_DATE_99) = MonthEnd(addmonths(Today(),16))
ORDER BY PROJECT_99, MILESTONE_DATE_99 DESC;

DROP Table DIM_MEDICAL_MILESTONE;

DIM_MEDICAL_MILESTONE_FINAL:
Load 
  R_NUM_99 			
, PROJECT_KEY_99
, PROJECT_99
, _PROJECT_KEY
, MILEST_MED_1
, LEGEND_CATEGORY_1			AS LEG_CAT_1
, MILEST_MED_2
, LEGEND_CATEGORY_2			AS LEG_CAT_2
, MILEST_MED_3
, LEGEND_CATEGORY_3			AS LEG_CAT_3
, MILEST_MED_4
, LEGEND_CATEGORY_4			AS LEG_CAT_4
, MILEST_MED_5
, LEGEND_CATEGORY_5			AS LEG_CAT_5
, MILEST_MED_6
, LEGEND_CATEGORY_6			AS LEG_CAT_6
, MILEST_MED_7
, LEGEND_CATEGORY_7			AS LEG_CAT_7
, MILEST_MED_8
, LEGEND_CATEGORY_8			AS LEG_CAT_8
, MILEST_MED_9
, LEGEND_CATEGORY_9			AS LEG_CAT_9
, MILEST_MED_10
, LEGEND_CATEGORY_10		AS LEG_CAT_10
, MILEST_MED_11
, LEGEND_CATEGORY_11		AS LEG_CAT_11
, MILEST_MED_12
, LEGEND_CATEGORY_12		AS LEG_CAT_12
, MILEST_MED_13
, LEGEND_CATEGORY_13		AS LEG_CAT_13
, MILEST_MED_14
, LEGEND_CATEGORY_14		AS LEG_CAT_14
, MILEST_MED_15
, LEGEND_CATEGORY_15		AS LEG_CAT_15
, MILEST_MED_16
, LEGEND_CATEGORY_16		AS LEG_CAT_16
, MILEST_MED_17
, LEGEND_CATEGORY_17 		AS LEG_CAT_17
Resident DIM_MEDICAL_MILESTONE_ALL
Where 1=1 and 
Not (
IsNull(MILEST_MED_1) and
IsNull(MILEST_MED_2) and 
IsNull(MILEST_MED_3) and
IsNull(MILEST_MED_4) and
IsNull(MILEST_MED_5) and
IsNull(MILEST_MED_6) and
IsNull(MILEST_MED_7) and
IsNull(MILEST_MED_8) and
IsNull(MILEST_MED_9) and
IsNull(MILEST_MED_10) and
IsNull(MILEST_MED_11) and
IsNull(MILEST_MED_12) and
IsNull(MILEST_MED_13) and
IsNull(MILEST_MED_14) and
IsNull(MILEST_MED_15) and
IsNull(MILEST_MED_16) and
IsNull(MILEST_MED_17)
);

DROP Table DIM_MEDICAL_MILESTONE_ALL;



LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab PROJECT OLD
/*

LET vStartTime = now();

[PROJECT]:
Load 
//	PROJECTTBL_KEY								AS [PROJECTTBL_Key], //2019-02-06 - RSYSIUK - Deprecated
    PROJECTTBL_KEY								AS [_PJT.KEY],
	PROJECT_KEY 								AS [_PJT.PROJECT_KEY],
	REGION_COUNTRY_KEY                    		AS [_PJT.REGION_COUNTRY_KEY],
	PRODUCT_KEY 								AS [_PJT.PRODUCT_KEY],
//PROJECT_KEY 									AS [_WP.PROJECT_KEY],
//	PROJECT_KEY                               	AS [_FRC_CY.PROJECT_KEY],
//[PRODUCT_KEY] 								AS [_PDT_PRODUCT_KEY],
	MFG_SITES_KEY                           	AS [_PJT.mfg_sites_key],
	DEVELOPMENT_SITE_KEY                    	AS [_PJT.development_site_key],
	REGION_FOR_BI  								AS [PJT.Region],
//	ORIG_PRJ									AS [PJT.Is Origin PJT],
	PROJECT_CODE                                AS [PJT.Project Code],
	PRODUCT                                     AS [PJT.Product],//Don't remove- Is different than standard Product Code beacuse it's combined with region/country
//MODIFY_VERSION	                            AS [PJT.Object version number],
	PDT_WBS_ONB                                 AS [PJT.Product WBS ONB],
	GPMS_DOCUNID                                AS [PJT.GPMS DOCUNID],
	DATE_MARS                                   AS [PJT.MARS],
//DATE_MARS_KEY 	                            AS [PJT.date_mars_key],
//Date(SELECTION_DATE,'M/D/YYYY')				AS [PJT.Selection Date],
	date(SELECTION_DATE)                   		AS [PJT.Selection Date],
//SELECTION_DATE_KEY							AS [_WP.SELECTION_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	SENDING_SITE                                AS [PJT.Sending Site],
	DEV_ALLOCATION_STATUS                       AS [PJT.Development allocation status],
    date(FIRST_SUBMISSION_DATE)					AS [PJT.1st Submission Date],
    date(FIRST_LAUNCH_DATE)						AS [PJT.1st Launch Date],
	date(FIRST_APPROVAL_DATE)					AS [PJT.1st Approval date],
	date(ENDORSMENT_DATE)	                    AS [PJT.Endorsement Date],
	date(ALLOCATION_COMMITEE_DATE)              AS [PJT.Allocation committee date],
//FIRST_LAUNCH_DATE_KEY							AS [_WP.FIRST_LAUNCH_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
//ALLOCATION_COMMITEE_DATE_KEY            		AS [PJT.allocation_commitee_date_key],
//BASE_PIPE_Y1_SALES                        	AS [PJT.Project Full Y1 | Sales],
//BASE_PIPE_Y1_STD_UNITS                      	AS [PJT.Project Full Y1 | Std Units],
//BASE_PIPE_Y2_SALES                          	AS [PJT.Project Full Y2 | Sales],
//BASE_PIPE_Y2_STD_UNITS                      	AS [PJT.Project Full Y2 | Std Units],
//BASE_PIPE_Y3_SALES                          	AS [PJT.Project Full Y3 | Sales],
//BASE_PIPE_Y3_STD_UNITS                      	AS [PJT.Project Full Y3 | Std Units],
//PROGRESS_LINK                             	AS [PJT.Progress],
//Date( BRAND_NCE_DATE,'DD-MMM-YYYY')       	AS [PJT.Brand NCE-1 date],
//BRAND_NCE_DATE_KEY							AS [_WP.BRAND_NCE_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	date(DEV_ALLOCATION_STATUS_DATE)            AS [PJT.Development allocation status date],
//DEV_ALLOCATION_STATUS_DATE_KEY            	AS [PJT.dev_allocation_status_date_key],
//FIRST_APPROVAL_DATE_KEY						AS [_WP.FIRST_APPROVAL_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	PTLD                                        AS [PJT.1st PTLD],
//PTLD_DATE_KEY                             	AS [PJT.ptld_date_key],
	date(PDT_IMS_CMAT_DATE)                     AS [PJT.MAT Date],
//PDT_IMS_CMAT_DATE_KEY 	                    AS [PJT.pdt_ims_cmat_date_key],
	SITE_TRANSFER								AS [PJT.Site transfer],
	STATUS                                      AS [PJT.Status],
	SEGMENT                                     AS [PJT.Segment],
	PROJECT_TECHNOLOGY                          AS [PJT.Project Technology],
//GLOBAL_DEV_STATUS                   		    AS [PJT.Global Development Status], //V1, 07/06/2018, LMIZRAHITO - remarked 26/06/2018
	date(DATE_TLD)                              AS [PJT.1st TLD],
//DATE_TLD_KEY                              	AS [PJT.date_tld_key],
	date(DATE_SUBMISSION_BATCH_DATE)            AS [PJT.1st Manufacture Submission Batches],
//DATE_SUBMISSION_BATCH_DATE_KEY            	AS [PJT.date_submission_batch_date_key],
	date(DATE_STABILITY_DATE)                   AS [PJT.1st Stability],
//DATE_STABILITY_DATE_KEY           	        AS [PJT.date_stability_date_key],
	REGION_COUNTRY                              AS [PJT.Region/country],
//PLM_ID                    	                AS [PJT.plm_id],//In reports to replace with pjt.plm_code
	EXCLUDE_FROM_STR_APP                        AS [PJT.exclude_from_str_app],
	ANDA_PROC_NUMB                              AS [PJT.ANDA/ Procedure no. (Concatenation of all RA WP)],
	AP_SUBMISSION_BATCH                         AS [PJT.1st Manufacture Submission Batches A/P],
	AP_TECH_FILE_SENT                           AS [PJT.1st Submission File sent to submitter A/P],
	LAUNCH_STATUS                               AS [PJT.Launch risk],
	MASTER_DOSAGE_FORM                          AS [PJT.Master dosage form],
	PDCT_FILL_V_UOM                             AS [PJT.Global Product| Fill volume UOM],
	PDCT_STRENGTH_FILL_V_UOM                    AS [PJT.Strength/ F. Volume UOM],
	PDCT_STRENGTH_UOM                           AS [PJT.Global Product| Strength UOM],
	PDT_INNOV_BRAND_NAME                        AS [PJT.Innovator Brand name],
	PDT_PLFD_DESC                               AS [PJT.PLFD description],
	PRJ_SUB_PLFD_EARLY                          AS [PJT.PLFD early],
	PRODUCT_DOSAGE_FORM                         AS [PJT.Product dosage form],
	PRODUCT_FTF                                 AS [PJT.Product Strength |  FTF],
	PRODUCT_HANDLING_CATEGORY                   AS [PJT.Product Handling category],
//PRODUCT_ID    	                            AS [PJT.Global Product ID], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
	PRODUCT_LABEL                               AS [PJT.Product label],
	PROGRESS                                    AS [PJT.Progress], //V1, 07/06/2018, LMIZRAHITO - 22/07/2018 renamed from PJT.Progress2
	PROJECT_NAME                                AS [PJT.Project Name],
	RA_CONTACT                                  AS [PJT.RA contact],
	STR_FILL_V_UOM_DISPLAY2                     AS [PJT.Strengths (Fill volumes + UOMs) UOMs],
	THERAPEUTIC_CLASS                           AS [PJT.Product Therapeutic class ATC1],
	IP_OWNER_VALUE                              AS [PJT.IP Owner],
	MFG_ALLOCATION_REASON                       AS [PJT.Mfg allocation reason],
//PRJ_GAIN     		                            AS [PJT.GAIN],//V1, 07/06/2018, LMIZRAHITO - 24/07/2018 removed, use only PDT.GAIN
	MFG_SITES                                   AS [PJT.Manufacturing Sites],
	PACK_SITES                                  AS [PJT.Packaging Sites],
	RELEASE_SITES                               AS [PJT.Release Sites],
	STRENGTHS_FILL_VOLUMES                      AS [PJT.Strengths-Fill volumes],
	TEST_SITES                                  AS [PJT.Testing Sites],
	PROJECT_RATIONALE                           AS [PJT.Project Rationale],
	DATE_TECHNICAL_FILE_SENT                    AS [PJT.1st Submission File sent to submitter],
//DATE_TECHNICAL_FILE_SENT_KEY          	    AS [PJT.date_technical_file_sent_key],
	OPERATIONS_ALLOC_STATUS_DATE                AS [PJT.Operations allocation status date],
//OPERATIONS_ALL_STAT_DATE_KEY          	    AS [PJT.operations_all_stat_date_key],
	FIRST_APPROVAL                              AS [PJT.1st Approval A/P],
	FIRST_LAUNCH                                AS [PJT.1st Launch A/P],
	FIRST_SUBMISSION_AP                         AS [PJT.1st Submission A/P],
	ALLOCATION_COMMITEE_STATUS                  AS [PJT.Allocation committee status],
	DEVELOPMENT_SITE                            AS [PJT.Development site],
	LMD_DESC                                    AS [PJT.LMD description],
	LMD_EARLY_2                                 AS [PJT.LMD early],
	MFG_ALLOCATION_COMMENTS                     AS [PJT.Mfg Allocation comments],
	OPERATIONS_ALLOCATION_STATUS                AS [PJT.Operations allocation status],
	PLMD_EARLY                                  AS [PJT.PLMD early],
	PV_NON_NME_NCE                              AS [PJT.Non-NCE/NME],
	RECEIVING_SITE                              AS [PJT.Receiving Site],
	IS_A_DEV_PROJECT                            AS [PJT.Is a dev project ?],
	PROJECT_TYPE                                AS [PJT.Project type],
	ACTAVIS_PROJECT_ID                          AS [PJT.Actavis Project ID],
	SUB_BATCH_MFG_SITE                          AS [PJT.Sub. Batch Mfg. site],
	REG_COUNTRY_PRODUCT                         AS [PJT.regional or country product related to project],
//	ROUTE_ADMIN                                 AS [PJT.Route of Administration],
	PROD_DESCRIPTION                            AS [PJT.Product Description],
	RLD_STRENGTHS                               AS [PJT.RLD Strengths],
	LOCAL_PROJECT_CODE                          AS [PJT.Local Project Code],
	IND_PROGRESS_BRAND_STATUS_US                AS [PJT.US Progress brand status (regional innovator)],
	date(FIRST_PIVOTAL_DOSING_DATE)             AS [PJT.1st First Pivotal Dosing Date],
//FIRST_PIVOTAL_DOSING_DATE_KEY 	            AS [PJT.first_pivotal_dosing_date_key],
	date(FINAL_PIVOTAL_REPORT_DATE)             AS [PJT.Final Pivotal Report Date],
//FINAL_PIVOTAL_REPORT_DATE_KEY   			    AS [PJT.final_pivotal_report_date_key],
	FIRST_PIVOTAL_DOSING_A_P                    AS [PJT.1st First Pivotal Dosing Date A/P],
	FINAL_PIVOTAL_REPORT_DATE_A_P               AS [PJT.Final Pivotal Report Date A/P],
	IND_PROGRESS_BRAND_STATUS_EU                AS [PJT.EU Progress brand status (regional innovator)],
	RND_PROJECT_MANAGER                         AS [PJT.R&D Project Manager],
	SENIOR_PROJECT_LEADER						AS [PJT.Project Leader], // RS 2018-12-06
	BIOCLINICAL_PROJECT_MANAGER                 AS [PJT.BioClinical project manager],
	PRELIM_RES_LAST_PIVOTAL_100PCT              AS [PJT.1st 100% QC date],
//PRELM_RES_LST_PIVOT_100PCT_KEY            	AS [PJT.prelm_res_lst_pivot_100pct_key],
	PILOT_STUDIES_START_DATE                    AS [PJT.Pilot Studies Start Date],
//PILOT_STUDIES_START_DATE_KEY              	AS [PJT.pilot_studies_start_date_key],
	PRELI_RES_LAST_PIVOTAL_FULL_AP              AS [PJT.1st 100% QC date A/P],
	PILOT_STUDIES_START_DATE_A_P                AS [PJT.Pilot Studies Start Date A/P],
	IS_FOR_GBS_IMPEX                            AS [PJT.Is for GBS interface (PLW_GBS_EXPORT_V) ?],
	PRODUCT_STATUS                              AS [PJT.Product | Status],
	FIRST_KICK_OFF_MEETING_DATE_AP              AS [PJT.1st Kick-off meeting Date A/P],
	FIRST_KICK_OFF_MEETING_DATE                 AS [PJT.1st Kick-off meeting Date],
//FRST_KICK_OFF_MEET_DATE_KEY               	AS [PJT.frst_kick_off_meet_date_key],
	ONB                                         AS [PJT.Internal number],
	SUBMBATCHMANAP                              AS [PJT.1st Submission Batch Manuf. Started A/P],
	date(STABILITY_COMPLETE_DATE)               AS [PJT.Stability Complete date],
//STABILITY_COMPLETE_DATE_KEY               	AS [PJT.stability_complete_date_key],
	STABILITY_COMPLETE_DATE_AP                  AS [PJT.Stability Complete date A/P],
//STABILITY_START_DATE                      	AS [PJT.Stability Start Date],
//STABILITY_START_DATE_KEY                  	AS [PJT.stability_start_date_key], //V1, 07/06/2018, LMIZRAHITO - remarked field, not in view
//STABILITY_START_DATE_AP                   	AS [PJT.Stability Start Date A/P],
//IND_PDUFA_AP                              	AS [PJT.PDUFA AP],
//IND_PDUFA_PS                              	AS [PJT.PDFUA (to be fixed)],
//IND_PDUFA_PS_KEY                          	AS [PJT.ind_pdufa_ps_key],
	INDICATION                                  AS [PJT.Main indication],
	IS_FOR_HYPERION_IMPEX                       AS [PJT.Is for hyperion interface (PLW_GBS_EXPORT_V) ?],
//MODIFICATION_DATE                         	AS [PJT.Modification date],
//MODIFICATION_DATE_KEY                     	AS [PJT.modification_date_key],
	date(CREATION_DATE)				            AS [PJT.Creation date],
//CREATION_DATE_KEY                        		AS [PJT.creation_date_key],
	NO_BIO_STUDY_REQUIRED                       AS [PJT.No Bio Study Required],
	IS_AN_OTC                                   AS [PJT.Is an OTC Project],
	PRJ_GLOBAL_PDT_TECH                         AS [PJT.Global product technology],
	RA_STRAT_FILING_STRAT                       AS [PJT.Project filing strategy for impex],
	PRJ_LMD_EARLY_COUNTRIES                     AS [PJT.LMD early (countries)],
	PRJ_LMD_EARLY_MAIN                          AS [PJT.LMD main],
	PRJ_LMD_EARLY_COUNTRIES_MAIN                AS [PJT.LMD main (countries)],
	LAUNCH_PLMD_EARLY_COUNTRIES                 AS [PJT.PLMD early (countries)],
	LAUNCH_PLMD_COUNTRIES_MAIN                  AS [PJT.PLMD main (countries)],
	MANUF_SUB_BATCHES_1ST_PF                    AS [PJT.Manufacture Submission Batches 1st Finish],
//MANUF_SUB_BATCHES_1ST_PF_KEY         		    AS [PJT.manuf_sub_batches_1st_pf_key],
	FIRSTPIVOTALDOSING_DATE_PF_AP               AS [PJT.First Pivotal dosing date Finish 1st A/P],
	FIRSTPIVOTALDOSINGDATE_1ST_PF               AS [PJT.First Pivotal dosing date Finish],
//FIRSTPIVTDOSINGDAT_1ST_PF_KEY        		    AS [PJT.firstpivtdosingdat_1st_pf_key],
	MANUF_SUB_BATCHES_1ST_PF_AP                 AS [PJT.Manufacture Submission Batches 1st Finish A/P],
	S_1ST_REFUSE_TO_RECEIVE                     AS [PJT.1st Refuse to receive A/P],
	D_1ST_REJECTED                              AS [PJT.1st Rejected],
//D_1ST_REJECTED_KEY                        	AS [PJT.d_1st_rejected_key],
	S_1ST_REJECTED                              AS [PJT.1st Rejected A/P],
	D_1ST_PROJECT_CREATED                       AS [PJT.Project created],
//D_1ST_PROJECT_CREATED_KEY                 	AS [PJT.d_1st_project_created_key],
	SUPPLIER_NAME                               AS [PJT.Supplier name],
	STRATEGY_COMMENTS                           AS [PJT.Strategy summary],
	TAPI_API									AS [PJT.TAPI Y/N],
	BIWEEKLY_REPORT_COMMENTS                    AS [PJT.Bi-weekly report comments],
	RLD_AVAILABILITY                            AS [PJT.RLD Availability],
	TOTAL_PRJ_VARIABLE_BUDGET                   AS [PJT.Business case Total project variable budget],
	REG_COMMENTS                                AS [PJT.Regulatory comments],
	LAUNCH_MGT_EX_SUM                           AS [PJT.Launch Management Executive Summary],
	COMMERCIAL_UPDATES                          AS [PJT.Commercial updates],
	STRATEGY_NPV                                AS [PJT.NPV],
//ENDORSMENT_DATE_KEY                       	AS [PJT.endorsment_date_key],
	LICENSOR_NAME                               AS [PJT.Licensor name],
	PRJ_SOURCE_PRJ                              AS [PJT.Source project ID],
	TARGET_PRJ                                  AS [PJT.Target project(s) ID],
	OTC_FRANCHISE                               AS [PJT.OTC franchise],
	EXCLUSIVITY_STATUS                          AS [PJT.Exclusivity status (US)],
	SUBMISSION_COMMITMENT                       AS [PJT.Submission Commitment],
	COMMITMENT_YEAR                             AS [PJT.Commitment Year],
	PJT_LSD_DATE                                AS [PJT.LSD],
	date(ON_HOLD_DUE_DATE)                      AS [PJT.On hold due date],
//ON_HOLD_DUE_DATE_KEY                      	AS [PJT.on_hold_due_date_key],
	PROJECT_STR_FV_FTF                          AS [PJT.Project FTF],
	MUST_WIN                                    AS [PJT.Must win],
	COMMITMENT_NOTE                             AS [PJT.Commitment Notes],
//TRACE_STATUS_DATE                         	AS [PJT.Trace:StatusDate],
	SUBMISSION_TYPE                             AS [PJT.Submission type],
	S_1ST_TENTATIVE_APPROVAL                    AS [PJT.1st Tentative Approval A/P],
	RA_STRAT_COMMENTS                           AS [PJT.RA comments],
	APPLICATION_TYPE                            AS [PJT.Application Type],
	date(D_1ST_TENTATIVE_APPROVAL)              AS [PJT.1st Tentative Approval],
//D_1ST_TENTATIVE_APPROVAL_KEY             		AS [PJT.d_1st_tentative_approval_key],
	S_1ST_FILE_CANCELLED                       	AS [PJT.1st File Cancelled A/P],
	date(D_1ST_FILE_CANCELLED)                  AS [PJT.1st File Cancelled],
//D_1ST_FILE_CANCELLED_KEY                  	AS [PJT.d_1st_file_cancelled_key],
	S_FDA_ACCEPTANCE                            AS [PJT.1st FDA acceptance A/P],
	S_1ST_TLD                                   AS [PJT.1st TLD A/P],
	S_WITHDRAWN                                 AS [PJT.1st Withdrawn A/P],
	STABILITY_AP                                AS [PJT.1st Stability A/P],
	date(D_FDA_ACCEPTANCE)                      AS [PJT.1st FDA acceptance],
//D_FDA_ACCEPTANCE_KEY                      	AS [PJT.d_fda_acceptance_key],
	date(D_WITHDRAWN)                           AS [PJT.1st Withdrawn],
//D_WITHDRRAWN_KEY                          	AS [PJT.d_withdrrawn_key],
	LFC_APPROVED_DATE_AP                        AS [PJT.1st LFC approved A/P],
	LFC_APPROVED_DATE                           AS [PJT.1st LFC approved],
//LFC_APPROVED_DATE_KEY                     	AS [PJT.lfc_approved_date_key],
	N_PROJECT_POS		                        AS [PJT.Project PoS (1-100%) ],
	LATEST_PRJ_HIGHLIGHT                        AS [PJT.Latest project highlight],
	date(D_1ST_REFUSE_TO_RECEIVE)               AS [PJT.1st Refuse to receive],
//D_1ST_REFUSE_TO_RECEIVE_KEY               	AS [PJT.d_1st_refuse_to_receive_key],
	PROJECT_POS_COMMENTS                        AS [PJT.Project PoS Comments],
	date(D_DOSSIER_COMPLETE_DATE)               AS [PJT.1st Dossier Complete date],
//D_DOSSIER_COMPLETE_DATE_KEY               	AS [PJT.d_dossier_complete_date_key],
	S_DOSSIER_COMPLETE_DATE                     AS [PJT.1st Dossier Complete date A/P],
	S_1ST_PTLD                                  AS [PJT.1st PTLD A/P],
	PLMD_EARLY_MAIN                             AS [PJT.PLMD main],
	APPROVAL_TO_CLINICAL                        AS [PJT.1st Approval to proceed to clinical study],
//APPROVAL_TO_CLINICAL_DATE_KEY             	AS [PJT.approval_to_clinical_date_key],
	APPROVAL_TO_CLINICAL_AP                     AS [PJT.1st Approval to proceed to clinical study A/P],
	S_1ST_DAY_106                               AS [PJT.Day 106 A/P],
	date(D_1ST_DAY_105)                         AS [PJT.Day 105],
//D_1ST_DAY_105_DATE_KEY                    	AS [PJT.d_1st_day_105_date_key],
	S_1ST_DAY_105                               AS [PJT.Day 105 A/P],
	date(D_1ST_DAY_106)                         AS [PJT.Day 106],
//D_1ST_DAY_106_DATE_KEY                    	AS [PJT.d_1st_day_106_date_key],
	S_1ST_DAY_0                                 AS [PJT.Day 0 A/P],
	date(D_1ST_DAY_0)                           AS [PJT.Day 0],
//D_1ST_DAY_0_DATE_KEY                      	AS [PJT.d_1st_day_0_date_key],
	S_1ST_PRE_LAUNCH_VARIATION                  AS [PJT.1st Pre Launch Variation A/P],
	S_1ST_VARIATION_APPROVAL                    AS [PJT.1st Variation Approval A/P],
	date(D_1ST_PRE_LAUNCH_VARIATION)            AS [PJT.1st Pre Launch Variation],
//D_1ST_PRE_LAUNCH_VARIATION_KEY            	AS [PJT.d_1st_pre_launch_variation_key],
	APPROVED_AP                                 AS [PJT.The file hAS been Approved by the regulatory authorities A/P],
	date(D_1ST_VARIATION_APPROVAL)              AS [PJT.1st Variation Approval],
//D_1ST_VARIATION_APPROVAL_KEY              	AS [PJT.d_1st_variation_approval_key],
	APPROVED                                    AS [PJT.The file hAS been Approved by the regulatory authorities],
//APPROVED_DATE_KEY                         	AS [PJT.approved_date_key],
	PIPELINE_MANAGER                            AS [PJT.Pipeline Manager],
	PHARMA_MANAGER                              AS [PJT.Pharma manager],
	SITE_LAUNCH_MANAGER                         AS [PJT.Site launch manager],
	ANALYTICAL_MANAGER                          AS [PJT.Analytical manager],
	PORTFOLIO_MANAGER                           AS [PJT.Portfolio manager],
	REGIONAL_LAUNCH_MANAGER                     AS [PJT.Regional launch manager],
	BD_MANAGER                                  AS [PJT.Bd manager],
	ANDA_NUMBER                                 AS [PJT.ANDA number],
	APPLICATION_NUMBER                          AS [PJT.Application number],
	B_PJT_MGT_MEETING							AS [PJT.Project Management Meeting],
	BIO_STRATEGY                                AS [PJT.Bio Clinical Strategy],
	date(D_PJT_MGT_MEETING)                     AS [PJT.Project Management Meeting Date],
//D_PJT_MGT_MEETING_DATE_KEY                	AS [PJT.d_pjt_mgt_meeting_date_key],
	DEV_ALLOCATION_REASON                       AS [PJT.Dev allocation reason],
	LAUNCH_TYPE                                 AS [PJT.Launch Type],
	N_CRYSTALINE_FORM                           AS [PJT.Crystaline form],
	PACK_ALLOCATION_REASON                      AS [PJT.Pack allocation reason],
	PV_LAUNCH_DRIVER                            AS [PJT.Launch driver],
	REGISTRATION_TYPE                           AS [PJT.Registration Type],
	RELEASE_ALLOCATION_REASON                   AS [PJT.Release allocation reason],
	S_EXPENSE_DEFINITION                        AS [PJT.Reimbursement type],
	S_YEAR_FTF_CONFIRMED                        AS [PJT.Year FTF Confirmed],
	TEST_ALLOCATION_REASON                      AS [PJT.Test allocation reason],
	B_FIRST_TO_FILE                             AS [PJT.First to file (GM)],
//LEGAL_RISK_LAUNCH                         	AS [PJT.Legal risk for launch],
	PROMOTION_PLAN                              AS [PJT.Promotion plan],
	date(D_FORFEITURE_DATE)                     AS [PJT.Forfeiture date],
//D_FORFEITURE_DATE_KEY                     	AS [PJT.d_forfeiture_date_key],
	S_GEN_OPS_RA_NOTES                          AS [PJT.Gen OPS RA Notes],
	S_RD_GNPI_COMMENTS                          AS [PJT.R&D - GNPI Comments],
// T_SPECIAL_REQ_COMMENTS                      AS [PJT.special requirement/ comments], //V1, 27/08/2018, LMIZRAHITO - removed field, duplicate field T_SPECIAL_REQ_COM
//S_API_LT                                  	AS [PJT.API lead time],
	RATIONALE_COMMENTS                          AS [PJT.Project rationale comments],
//REMARKS                                   	AS [PJT.Remarks],
	LEGAL_PJT_MEMBER                            AS [PJT.Legal contact person],
	S_PRJ_LIST_COUNTRIES_LAUNCH					AS [PJT.List of countries (launch)], //V1, 27/08/2018, RSYSIUK - Adding PJT. prefix to field name
//New fields added by LMIZRAHITO 07/06/2018
	SALES_KDOL									AS [PJT.SALES_KDOL], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_SALE_KDOL								AS [PJT.PMAT_SALE_KDOL], //V1, 07/06/2018, LMIZRAHITO - added field
	SALES_KEUR									AS [PJT.SALES_KEUR], //V1, 07/06/2018, LMIZRAHITO - added field
	SALES_KLC									AS [PJT.SALES_KLC], //V1, 07/06/2018, LMIZRAHITO - added field
	EXT_UNITS									AS [PJT.EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_EXT_UNITS								AS [PJT.PMAT_EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - added field
	CMAT_EACHES									AS [PJT.CMAT_EACHES], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_EACHES									AS [PJT.PMAT_EACHES], //V1, 07/06/2018, LMIZRAHITO - added field
	IMS_CMAT_DATE								AS [PJT.IMS_CMAT_DATE], //V1, 07/06/2018, LMIZRAHITO - added field
//	IMS_CMAT_DATE_KEY							AS [_PJT.IMS_CMAT_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, Commented
	CMAT_CU										AS [PJT.CMAT_CU], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_CU										AS [PJT.PMAT_CU], //V1, 07/06/2018, LMIZRAHITO - added field
	CMAT_K_UN									AS [PJT.CMAT_K_UN], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_K_UN									AS [PJT.PMAT_K_UN], //V1, 07/06/2018, LMIZRAHITO - added field
	STD_UN										AS [PJT.STD_UN], //V1, 07/06/2018, LMIZRAHITO - added field
	IMS_KG										AS [PJT.IMS_KG], //V1, 07/06/2018, LMIZRAHITO - added field
	B_ALLOC_CHANGED								AS [PJT.Allocation Changed], //V1, 07/06/2018, LMIZRAHITO - added field
	S_OPS_DOSAGE_TYPE							AS [PJT.Ops dosage type], //V1, 07/06/2018, LMIZRAHITO - added field
	T_SPECIAL_REQ_COM							AS [PJT.Special requirments/comments], //V1, 07/06/2018, LMIZRAHITO - added field
	PROJECT_LICENSEE							AS [PJT.Licensee], //V1, 07/06/2018, LMIZRAHITO - added field
//	TRACE_STATUS_DATE_KEY						AS [_PJT.TRACE_STATUS_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field
	TRACE_COMMENT_NOTEPAD						AS [PJT.information], //V1, 07/06/2018, LMIZRAHITO - added field
	TRI_WEEKLY_RA_NOTES							AS [PJT.Tri-weekly RA notes], //V1, 07/06/2018, LMIZRAHITO - added field
	LAUNCH_STRATEGY_COMMENTS					AS [PJT.Launch strategy comments], //V1, 07/06/2018, LMIZRAHITO - added field
	VALIDATION_START_DATE						AS [PJT.Validation start date], //V1, 07/06/2018, LMIZRAHITO - added field
// VALIDATION_START_DATE_KEY					AS [PJT.VALIDATION_START_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, Commented
	VALIDATION_NOTES							AS [PJT.Validation Notes],
	BUSINESS                                    AS [PJT.Business],
//	GM_BUSINESS_FLAG                            AS [PJT.GM_business_flag], 
//	GM_PROJECTS_FLAG                            AS [PJT.GM_projects_flag],
//Projects flag originally established for  R&D accuracy reports
	FIRST_SUBMISSION_DATE_FLAG	    			AS [PJT.FIRST_SUBMISSION_DATE_FLAG],			
	DEVELOPMENT_SITE_FLAG         				AS [PJT.DEVELOPMENT_SITE_FLAG],
	MANUFACTURING_SITE_FLAG       				AS [PJT.MANUFACTURING_SITE_FLAG],
	PROJECT_MANAGERS_FLAG         		    	AS [PJT.PROJECT_MANAGERS_FLAG],
	EXCLUSIVITY_STATUS_FLAG_US                  AS [PJT.EXCLUSIVITY_STATUS_FLAG_US],
	BIWEEKLY_COMMENTS_FLAG                      AS [PJT.BIWEEKLY_COMMENTS_FLAG],
	BIO_STRATEGY_FLAG                           AS [PJT.BIO_STRATEGY_FLAG],
//	CHG_PRJ_TO_COMPLETED_FLAG					AS [PJT.CHG_PRJ_TO_COMPLETED_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field
//	CHG_PRJ_TO_ACTIVE_FLAG						AS [PJT.CHG_PRJ_TO_ACTIVE_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field
//	SUBMISSION_FROM_DATE                        AS [PJT.Submission From Date],
//	PREVIOUS_SUBMISSION_DATE                    AS [PJT.Previous Submission Date],
//	GM_THERAPEUTIC_AREA							AS [PJT.GM_THERAPEUTIC_AREA_PLM], //V1, 07/06/2018, LMIZRAHITO - added field
//	GM_SELECTION_METHOD							AS [PJT.GM_SELECTION_METHOD], //V1, 07/06/2018, LMIZRAHITO - added field
//	date(DB_INSERT_DATE)                        AS DB_insert_date,
// ims measures from REG_PDT
//SALES_IN_KUSD                            		AS [PJT.SALES_IN_KUSD], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//SALES_IN_KEUR                             	AS [PJT.SALES_IN_KEUR], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//COUNTING_UNITS                            	AS [PJT.COUNTING_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//KG                                        	AS [PJT.KG], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//SU                                        	AS [PJT.SU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_SALES_K_USD                           	AS [PJT.IMS_SALES_K_USD], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_SALES_K_EUR                           	AS [PJT.IMS_SALES_K_EUR], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_EXT_UNITS                             	AS [PJT.IMS_EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_EACHES                                	AS [PJT.IMS_EACHES], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_UNITS                                 	AS [PJT.IMS_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_PREV_SALES_K_USD                      	AS [PJT.IMS_PREV_SALES_K_USD], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_SALES_K_LC                            	AS [PJT.IMS_SALES_K_LC], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_CU                                    	AS [PJT.IMS_CU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_PREV_CU                               	AS [PJT.IMS_PREV_CU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_SU                                    	AS [PJT.IMS_SU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_PREV_UNITS                            	AS [PJT.IMS_PREV_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_PREV_EACHES                           	AS [PJT.IMS_PREV_EACHES], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//	IMS_PMAT_EXT_UNITS                        	AS [PJT.IMS_PMAT_EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018

	T_LEGAL									  	AS [PJT.Legal Comments],
//	BUSINESS_R                              	AS [PJT.BUSINESS_R],
//	BUSINESS_G                              	AS [PJT.BUSINESS_G],
//	BUSINESS_B                              	AS [PJT.BUSINESS_B],
	B_IS_SPECIALTY_PROJECT                  	AS [PJT.Is a Specialty Project?],
	DEVELOPMENT_COUNTRIES                  		AS [PJT.Development Countries],
	TRI_WEELY_STATUS                  			AS [PJT.Tri-weekly Status],
	SP_PROJECT_ATTRIBUTES                  		AS [PJT.Project Attributes],
	SP_PROJECT_NAME                  			AS [PJT.Specialty Project Name],
	PHASE_I_SITE                  				AS [PJT.Phase I Production Sites],
	PHASE_II_SITE                  				AS [PJT.Phase II Production Sites],
	PHASE_III_SITE                  			AS [PJT.Phase III Production Sites],
	PHASE_I_ALLOC_REASON                  		AS [PJT.Phase I Allocation Reason],
	PHASE_II_ALLOC_REASON                  		AS [PJT.Phase II Allocation Reason],
	PHASE_III_ALLOC_REASON                  	AS [PJT.Phase III Allocation Reason],
	SUBMISSION                  				AS [PJT.Submission],
	SP_PROJECT_NAME								AS [PJT.PTRS Specialty Project Name],
	PRECLINICAL_POC								AS [PJT.PTRS Preclinical/POC Stage],
	BENCH_PRECLINICAL_POC						AS [PJT.PTRS Benchmark Preclinical/POC Stage],
	PTRS_PH_I									AS [PJT.PTRS Ph1],
	BENCH_PTRS_PH_I								AS [PJT.PTRS Benchmark Ph1],
	PTRS_PH_II									AS [PJT.PTRS Ph2],
	BENCH_PTRS_PH_II							AS [PJT.PTRS Benchmark Ph2],
	PTRS_PH_III									AS [PJT.PTRS Ph3],
	BENCH_PTRS_PH_III							AS [PJT.PTRS Benchmark Ph3],
	PTRS_SUBMISSION								AS [PJT.PTRS Submission],
	BENCH_PTRS_SUBMISSION						AS [PJT.PTRS Benchmark Submission],
	PTRS_LOA									AS [PJT.PTRS LOA Based On Current Progress],
	BENCH_PTRS_LOA								AS [PJT.PTRS Benchmark LOA For Current Progress],
	GLOBAL_FINANCIAL_CODE						AS [PJT.Global Financial Code],
	RND_ACTION_ITEMS							AS [PJT.R&D Action Items],
//2018-12-27 RS
	MFG_PRO_EQUIPMENT_TRAIN						AS [PJT.MFG Process Equipment Train],
	SUB_PACK_CONF_OR_PACK						AS [PJT.Submission Packaging CONF OR PACK],
//DAY_50										AS [PJT.DAY_50],
//DAY_50_KEY									AS [PJT.DAY_50 KEY],
//DAY_80										AS [PJT.DAY_80],
//DAY_80_KEY									AS [PJT.DAY_80 KEY], 
//DAY_90										AS [PJT.DAY_90],
//DAY_90_KEY									AS [PJT.DAY_90 KEY], 
//DAY_120										AS [PJT.DAY_120],
//DAY_120_KEY									AS [PJT.DAY_120 KEY], 
//DAY_121										AS [PJT.DAY_121],
//DAY_121_KEY									AS [PJT.DAY_121 KEY],
//DAY_150										AS [PJT.DAY_150],
//DAY_150_KEY									AS [PJT.DAY_150 KEY],
//DAY_50_AP										AS [PJT.DAY_50 AP],
//DAY_80_AP										AS [PJT.DAY_80 AP],
//DAY_90_AP										AS [PJT.DAY_90 AP],
//DAY_120_AP									AS [PJT.DAY_120 AP],
//DAY_121_AP									AS [PJT.DAY_121 AP],
//DAY_150_AP									AS [PJT.DAY_150 AP],
//DEVELOPMENT_SITE_DESCRIPTION              	AS [PJT.Development_Site_Description], //V1, 07/06/2018, LMIZRAHITO - Remarked, not in view                    
	SUBMISSIONS_ACTUALS_FLAG					AS [PJT.SUBMISSIONS_ACTUALS_FLAG],
	LAUNCHES_ACTUALS_FLAG						AS [PJT.LAUNCHES_ACTUALS_FLAG],
//	GROSS_SELECTIONS							AS [PJT.Gross Selections],
//	NET_SELECTIONS								AS [PJT.Net Selections],
//	ACTIVE_DRAFT_STATUS							AS [PJT.Active\Draft Status], 
//	GM_BUSINESS      							AS [PJT.GM Business],
	SUBMDATENULL_FLAG     						AS [PJT.SubmDateNull_flag],
	LAUNCHDATENULL_FLAG         				AS [PJT.LaunchDateNull_flag],
	SEGMENTNULL_FLAG                   			AS [PJT.SegmentNull_flag],
//	PROJECT_COUNT                        		AS [PJT.Projects Count],
//	GM_REVISED_THERAPEUTIC_AREA					AS [Reg_PDT.GM Revised Therapeutic Area],
	SELECTION_SUB_METHOD						AS [Reg_PDT.Selection Sub Method],
//	PTRS_TO_NEXT_PHASE							AS [PJT.PTRS to Next Phase],
//	SELECTION_DATE_NUM                     		AS [PJT.SelectionDateNum],
//	FIRST_LAUNCH_DATE_NUM						AS [PJT.1stLaunchDateNum],
//	FIRST_LAUNCH_MONTH_NUM						AS [PJT.1stLaunchMonthNum],
//	GM_LAUNCH_BY_YEAR							AS [PJT.GM Launch by Year],
//	FIRST_SUBMISSION_DATE_NUM					AS [PJT.1stSubmissionDateNum],
//	FIRST_SUBMISSION_MONTH_NUM 					AS [PJT.1stSubmissionMonthNum],
//	GM_SUBMISSION_BY_YEAR	 					AS [PJT.GM Submission by Year],
//	FIRST_APPROVAL_YEAR                   		AS [PJT.1st Approval Year],
//	ENDORSMENT_DATE_NUM                      	AS [PJT.EndorsementDateNum],
    
//  MISTAKES_IN_PROJECT_MS_FLAG                 AS [PJT.MISTAKES_IN_PROJECT_MS_FLAG],
	MISTAKES_SUB_BATCH_DATE_FLAG				AS [PJT.MISTAKES_SUB_BATCH_DATE_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018
	MISTAKES_BIO_START_FLAG						AS [PJT.MISTAKES_BIO_START_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018
	MISTAKES_FINAL_BIO_RPT_FLAG					AS [PJT.MISTAKES_FINAL_BIO_RPT_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018
	MISTAKES_SUBMISSION_DATE_FLAG				AS [PJT.MISTAKES_SUBMISSION_DATE_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018
	MISTAKES_STABILTY_DATE_FLAG					AS [PJT.MISTAKES_STABILTY_DATE_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018
    //FLAGS ADDED BY VFERMAN ON 21-3-2018 FOR EU DATA ACCURACY REPORTS
	MISSING_MARS_DATE_FLAG						AS [PJT.Missing MARS Date flag],
	FIRST_SUBM_LATR_THAN_MARS_FLAG				AS [PJT.1st Submission later than MARS flag],
	MISSING_PROJECT_STATUS_FLAG					AS [PJT.Missing project status flag],
	MISSING_BUSINESS_FLAG						AS [PJT.Missing business flag],
	MISSING_PROJECT_TYPE_FLAG					AS [PJT.Missing project type flag],
	MISSING_PTF_PJT_MNGR_FLAG					AS [PJT.Missing portfolio project manager flag],
	MISSING_PROJECT_PROGRES_FLAG				AS [PJT.Missing project progress flag],
	MISSING_MFG_SITE_FLAG						AS [PJT.Missing manufacturing site flag],
	MISSING_PACK_SITE_FLAG						AS [PJT.Missing pack site flag],
	MISSING_TEST_SITE_FLAG						AS [PJT.Missing test site flag],
	MISSING_RELEASE_SITE_FLAG					AS [PJT.Missing release site flag],
//  MISSING_CONS_RAWPS_FLAG					AS [PJT.MISSING_CONS_RAWPS_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field
//	MISSING_CONS_CLWPS_FLAG						AS [PJT.MISSING_CONS_CLWPS_FLAG], //V1, 07/06/2018, LMIZRAHITO - added field
    MISSING_KICK_OFF_DATE_FLAG					AS [PJT.Missing Kick-off Date Flag], // 2019-03-19 RSYSIUK
    EXPIRED_KICK_OFF_DATE_FLAG					AS [PJT.Expired Kick-off Date Flag] // 2019-03-19 RSYSIUK
 FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT.QVD](qvd)
;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);

*/


PROJECT_HIST: //2018-11-05, RSYSIUK	added //2019-01-02	RSYSIUK	changed
NoConcatenate 
LOAD 
//	[REGION_COUNTRY_KEY]	AS [_REGION_COUNTRY_KEY],
	[PROJECT_CODE]			AS [PJT.Project Code],
	[PRODUCT]				AS [PJT.Product]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] <> 1
and [VERSION] = 1
and [TO_DATE] >= YearStart(Today())
and [STATUS] = 'Active' and Year([FIRST_SUBMISSION_DATE]) = Year(Today())
;

Concatenate(PROJECT_HIST)
LOAD 
//	[REGION_COUNTRY_KEY]	AS [_REGION_COUNTRY_KEY],
	[PROJECT_CODE]			AS [PJT.Project Code],
	[PRODUCT]				AS [PJT.Product]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] <> 1
and [VERSION] <> 1
and [FROM_DATE] < YearStart(Today())
and [TO_DATE] >= YearStart(Today())
and [STATUS] = 'Active' and Year([FIRST_SUBMISSION_DATE]) = Year(Today())
;

Inner Join(PROJECT_HIST)
LOAD 
//	[REGION_COUNTRY_KEY]	AS [_REGION_COUNTRY_KEY],
	[PROJECT_CODE]			AS [PJT.Project Code],
	[PRODUCT]				AS [PJT.Product]
    FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PROJECT_HIST.QVD] (qvd)
Where [ACT_IND] = 1
and (WildMatch(STATUS,'Cancelled','On Hold') or Year(FIRST_SUBMISSION_DATE) > Year(Today()))
;

Left Join(PROJECT) //2018-11-05, RSYSIUK
LOAD
//	[_REGION_COUNTRY_KEY]	AS [_PJT.REGION_COUNTRY_KEY],
	[PJT.Project Code],
	[PJT.Product],
    1						AS [_FLAG_MOVED_TO_NEXT_YEAR_OR_CANCELED_ORON_HOLD]
Resident PROJECT_HIST
;
Drop Table PROJECT_HIST;



///$tab API_SUPPLIER_N_N_BI
LET vStartTime = now();

API_SUPPLIER_N_N_BI:
LOAD
API_SUPPLIER_N_N_BI_KEY	as [_API.KEY]
,PROJECT_KEY			as [_PROJECT_KEY]
,S_API_LT				as [API.Lead Time For Launch]
,API					as [API.API]
,SHELF_LIFE				as [API.Shelf Life]
,API_SUPPLIER			as [API.Supplier]
,COMMENT_PLW			as [API.Comment]
,COMMERCIAL				as [API.Commercial]
,COMMERCIAL_PRICE		as [API.Commercial Price]
,DEVELOPMENT			as [API.Development]
,DMF_STATUS				as [API.DMF Status]
,FORM_AND_OR_SALT		as [API.Form and/or Salt]
,MANUFACTURING_FACILITY	as [API.Manufacturing Facility]
,RND_PRICE				as [API.R&D Price]
,SUBMISSION				as [API.Submission]
,SUPPLIER_STATUS		as [API.Supplier Status]
,LAUNCH					as [API.Launching API Supplier]
//added on 20-12-2021 by Olga Voloshchuk on Talya request
,API_AGREEMENT_STATUS   as [API.AGREEMENT STATUS]
//added on 21-07-2022
,FACILITY_ADDRESS       as  [API.Facility Address]

//,MODIFICATION_AUTHOR	 as []
//,LAST_MODIFICATION_DATE	 as []
//,PLM_ONB	 as []
//,PROJECT	 as []
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\API_SUPPLIER_N_N_BI.QVD](qvd);

/*
Load Distinct [_API.KEY],
Trim(SubField([PJT.Manufacturing Sites],',')) as [PJT.Manufacturing Site]
Resident API_SUPPLIER_N_N_BI;
*/
LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab PR_PACKAGING
//added 2021-12-20 by Olga Voloshchuk on Talya req
PACKAGING:

LOAD
    PR_PACKAGING_KEY as [_PR_PACK.PR_PACKAGING_KEY],
    PROJECT_KEY as [_PROJECT_KEY],
    PROJECT as [_PR_PACK.Project],
    PLM_ONB as [_PR_PACK.PLM_ONB] ,
    PACKAGING_AGREEMENT_STATUS as [PR_PACK.Packaging Agreement status]  ,
    PACKAGING_COMMENTS as [PR_PACK.Packaging comment],
    PACKAGING_MATERIAL_NAME as [PR_PACK.Packaging material name],
    CRITICAL_PACKAGING as [PR_PACK.Critical packaging],
    PACKAGING_SUPPLIER as [PR_PACK.Packaging supplier name],
    PACKAGING_SUPPLIER_STATUS as [PR_PACK.Packaging supplier status],
    MANUFACTURING_FACILITY	as [PR_PACK.Manufacturing Facility]	,
    MANUFACTURING_FACILITY_ADDRESS	as	[PR_PACK.Manufacturing Facility Address],
    RND_PRICE	as [PR_PACK.RND Price]	,
    COMMERCIAL_PRICE  as [PR_PACK.Commercial Price]		,

    LEAD_TIME_FOR_LAUNCH	as [PR_PACK.Lead Time for Launch]	,
    NITROSAMINE_RISK_ASSESSMENT	 as [PR_PACK.Nitrosamine Risk Assessment]

   
FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_PR_PACKAGING.QVD]
(qvd);


///$tab PR_Excipients
//added 2021-12-20 by Olga Voloshchuk on Talya req
[Excipients]:
LOAD
    PR_EXCIPIENTS_KEY as [_EXC.PR_EXCIPIENTS_KEY],
    PROJECT_KEY as [_PROJECT_KEY] ,
    PROJECT as [_EXC.Project code],
    PLM_ONB as [_EXC.PLM_ONB],
    EXCIPIENT_AGREEMENT_STATUS as [EXC.Excipients Agreement status],
    EXCIPIENT_COMMENT as [EXC.Excipients comment],
    EXCIPIENT_SUPPLIER_STATUS as [EXC.Excipients supplier name],
    CRITICAL_EXCIPIENT as [EXC.Critical excipients],
    EXCIPIENT_SUPPLIER as [EXC.Excipients supplier],
    EXCIPIENT_MATERIAL_NAME as [EXC.Excipients material name],
    //new columns added on 21072022
    MANUFACTURING_FACILITY	as [EXC.Manufacturing Facility]	,
    MANUFACTURING_FACILITY_ADDRESS	as	[EXC.Manufacturing Facility Address],
    RND_PRICE	as [EXC.RND Price]	,
    COMMERCIAL_PRICE  as [EXC.Commercial Price]		,
    SHELF_LIFE	as [EXC.Shelf Life]	,
    LEAD_TIME_FOR_LAUNCH	as [EXC.Lead Time for Launch]	,
    NITROSAMINE_RISK_ASSESSMENT	 as [EXC.Nitrosamine Risk Assessment]

    
FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_PR_EXCIPIENTS.QVD]
(qvd);


///$tab CALENDARS
LET vStartTime = now();

SUB makeCalendar(name)
	[CALENDAR.$(name)]:
    Load  
	[iCalendar.Date]		as [$(name) Date], 
	[iCalendar.Year]		as [$(name) Year],
	[iCalendar.Quarter]		as [$(name) Quarter],
	[iCalendar.Month]		as [$(name) Month], 
	[iCalendar.Week]		as [$(name) Week],
	[iCalendar.Day]			as [$(name) Day],
	[iCalendar.MonthYear]	as [$(name) MonthYear],  
	[iCalendar.WeekYear]	as [$(name) WeekYear],
	[iCalendar.WeekDay]		as [$(name) WeekDay],
	[iCalendar.DateDiff]	as [$(name) Date Diff],
	[iCalendar.MonthDiff]	as [$(name) Month Diff],
	[iCalendar.QtrDiff]		as [$(name) Qtr Diff],
	[iCalendar.YearDiff]	as [$(name) Year Diff]
	Resident iCalendar
	Where Exists([$(name) Date],[iCalendar.Date]);
END SUB

Call makeCalendar('PJT.1st Submission');
Call makeCalendar('PJT.1st Launch');
Call makeCalendar('PJT.Selection');
Call makeCalendar('PJT.Endorsement');

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab PROJECT_CALENDAR_FIRST_SUBMISSION
/*
LET vStartTime = now();

Temp:  
Load  
               min([PJT.1stSubmissionDateNum]) as minDate,
               max([PJT.1stSubmissionDateNum]) as maxDate
               //floor(Now()) as maxDate  
Resident PROJECT; 
  
Let varMinDate = If(Num(Peek('minDate', 0, 'Temp'))>0, Num(Peek('minDate', 0, 'Temp')), MakeDate(2018));  
Let varMaxDate = If(Num(Peek('maxDate', 0, 'Temp'))>0, Num(Peek('maxDate', 0, 'Temp')), MakeDate(2019));
  
DROP Table Temp;  

TempCalendar:  
LOAD  
               $(varMinDate) + Iterno()-1 as Num,  
               Date($(varMinDate) + IterNo() - 1) as TempDate  
               AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate);  

PJT_Calendar_First_Submission:  
Load  
               TempDate as [PJT.1stSubmissionDateNum],
               Date(TempDate) as [PJT.1st Submission Date],
               week(TempDate) as [PJT.1st Submission Week],  
               Year(TempDate) as [PJT.1st Submission Year],
               'Q' & ceil(num(Month(TempDate))/3) as [PJT.1st Submission Quarter],
               Month(TempDate) As [PJT.1st Submission Month],  
               Day(TempDate) as [PJT.1st Submission Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [PJT.1st Submission MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [PJT.1st Submission WeekYear],  
               WeekDay(TempDate) as [PJT.1st Submission WeekDay],
               TempDate-'$(vToday)' as [PJT.1st Submission Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [PJT.1st Submission Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [PJT.1st Submission Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [PJT.1st Submission Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar; 

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
*/
///$tab PROJECT_CALENDAR_FIRST_LAUNCH
/*
LET vStartTime = now();

Temp:  
Load  
               min([PJT.1stLaunchDateNum]) as minDate,
               max([PJT.1stLaunchDateNum]) as maxDate
               //floor(Now()) as maxDate  
Resident PROJECT;  
  
Let varMinDate = If(Num(Peek('minDate', 0, 'Temp'))>0, Num(Peek('minDate', 0, 'Temp')), MakeDate(2018));  
Let varMaxDate = If(Num(Peek('maxDate', 0, 'Temp'))>0, Num(Peek('maxDate', 0, 'Temp')), MakeDate(2019));
  
DROP Table Temp;  
  
TempCalendar:  
LOAD  
               $(varMinDate) + Iterno()-1 as Num,  
               Date($(varMinDate) + IterNo() - 1) as TempDate  
               AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate);  
  
PJT_Calendar_First_Launch:  
Load  
               TempDate as [PJT.1stLaunchDateNum],
               Date(TempDate) as [PJT.1st Launch Date],
               week(TempDate) as [PJT.1st Launch Week],  
               Year(TempDate) as [PJT.1st Launch Year],
               'Q' & ceil(num(Month(TempDate))/3) as [PJT.1st Launch Quarter],
               Month(TempDate) As [PJT.1st Launch Month],  
               Day(TempDate) as [PJT.1st Launch Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [PJT.1st Launch MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [PJT.1st Launch WeekYear],  
               WeekDay(TempDate) as [PJT.1st Launch WeekDay],
               TempDate-'$(vToday)' as [PJT.1st Launch Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [PJT.1st Launch Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [PJT.1st Launch Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [PJT.1st Launch Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar;  

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
*/
///$tab PROJECT_CALENDAR_SELECTION
/*
LET vStartTime = now();

Temp:  
Load  
               min([PJT.SelectionDateNum]) as minDate,
               max([PJT.SelectionDateNum]) as maxDate
               //floor(Now()) as maxDate  
Resident PROJECT;  
  
Let varMinDate = If(Num(Peek('minDate', 0, 'Temp'))>0, Num(Peek('minDate', 0, 'Temp')), MakeDate(2018));  
Let varMaxDate = If(Num(Peek('maxDate', 0, 'Temp'))>0, Num(Peek('maxDate', 0, 'Temp')), MakeDate(2019));
 
DROP Table Temp;  
  
TempCalendar:  
LOAD  
               $(varMinDate) + Iterno()-1 as Num,  
               Date($(varMinDate) + IterNo() - 1) as TempDate  
               AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate);  
  
PJT_Calendar_Selection:  
Load  
               TempDate as [PJT.SelectionDateNum],
               Date(TempDate) as [PJT.Selection Date],
               week(TempDate) as [PJT.Selection Week],  
               Year(TempDate) as [PJT.Selection Year],
               'Q' & ceil(num(Month(TempDate))/3) as [PJT.Selection Quarter],
               Month(TempDate) As [PJT.Selection Month],  
               Day(TempDate) as [PJT.Selection Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [PJT.Selection MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [PJT.Selection WeekYear],  
               WeekDay(TempDate) as [PJT.Selection WeekDay],
               TempDate-'$(vToday)' as [PJT.Selection Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [PJT.Selection Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [PJT.Selection Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [PJT.Selection Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar;  

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
*/
///$tab PROJECT_CALENDAR_ENDORSEMENT
/*
LET vStartTime = now();

Temp:  
Load  
               min([PJT.EndorsementDateNum]) as minDate,
               max([PJT.EndorsementDateNum]) as maxDate
               //floor(Now()) as maxDate  
Resident PROJECT;  
  
Let varMinDate = If(Num(Peek('minDate', 0, 'Temp'))>0, Num(Peek('minDate', 0, 'Temp')), MakeDate(2018));  
Let varMaxDate = If(Num(Peek('maxDate', 0, 'Temp'))>0, Num(Peek('maxDate', 0, 'Temp')), MakeDate(2019));

DROP Table Temp;  
  
TempCalendar:  
LOAD  
               $(varMinDate) + Iterno()-1 as Num,  
               Date($(varMinDate) + IterNo() - 1) as TempDate  
               AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate);  
  
PJT_Calendar_Endorsement:  
Load  
               TempDate as [PJT.EndorsementDateNum],
               Date(TempDate) as [PJT.Endorsement Date2],
               week(TempDate) as [PJT.Endorsement Week],  
               Year(TempDate) as [PJT.Endorsement Year],
               'Q' & ceil(num(Month(TempDate))/3) as [PJT.Endorsement Quarter],
               Month(TempDate) As [PJT.Endorsement Month],  
               Day(TempDate) as [PJT.Endorsement Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [PJT.Endorsement MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [PJT.Endorsement WeekYear],  
               WeekDay(TempDate) as [PJT.Endorsement WeekDay],
               TempDate-'$(vToday)' as [PJT.Endorsement Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [PJT.Endorsement Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [PJT.Endorsement Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [PJT.Endorsement Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar;  

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
*/
///$tab SKU
LET vStartTime = now();

SKU:
LOAD
	SKU_KEY		 								AS [_SKU.KEY],								
	PRODUCT_CODE 								AS [SKU.aaaProduct_Code],
	PRODUCT_CK 									AS [SKU.Product CK],
	TD_PRODUCT_CODE 							AS [SKU.TD Product Code],
	DESCRIPTION 								AS [SKU.Description],
	SHORT_DESCRIPTION 							AS [SKU.Short Description],
	GAIN 										AS [SKU.Gain],
	DOSAGE_FORM 								AS [SKU.Dosage Form],
	GLOBAL_PRODUCT_TECHNOLOGY 					AS [SKU.Global Product Technology],
	STRENGTH 									AS [SKU.Strength],
	STRENGTH_QTY 								AS [SKU.Strength Qty],
	STRENGTH_UNIT 								AS [SKU.Strength_Unit],
	UNIT_OF_MEASURE 							AS [SKU.Unit of Measure],
	INVENTORY_TYPE 								AS [SKU.Inventory Type],
	PACKAGE_SIZE 								AS [SKU.Package Size],
	QUANTITY_PER_UNIT 							AS [SKU.Quantity Per Unit],
	PRODUCT_SOURCE 								AS [SKU.Product Source],
	PRODUCT_LINE 								AS [SKU.Product Line],
	PRODUCT_PACKAGER 							AS [SKU.Product Packager],
	PRODUCT_LAUNCH_DATE 						AS [SKU.Product Launch Date],
	COUNTRY 									AS [SKU.Country],
	BUSINESS_GL_CLASS 							AS [SKU.Busines GL Class],
	PRODUCT_GROUP 								AS [SKU.Product Group],
	STORAGE_CONDITION 							AS [SKU.Storage Condition],
	TARGET_MARKET 								AS [SKU.Target Market],
	RECORD_STATUS 								AS [SKU.Record Status],
	MANUFACTURER_ITEM_CODE 						AS [SKU.Manufacturer Item Code],
	SOURCE_SYSTEM 								AS [SKU.Source System],
	PRODUCT_LINE_NAME 							AS [SKU.Product Line Name],
	PRODUCT_LINE_GEO_KEY 						AS [_SKU.Product Line Geo Key],
	PACKAGER_NAME								AS [SKU.Packager Name],
	PACKAGER_GEO_KEY 							AS [_SKU.Packager Geo Key],
	PRODUCT_BRAND_CODE 							AS [SKU.Product Brand Code],
	PRODUCT_BRAND_NAME 							AS [SKU.Product Brand Name],
	PRODUCT_DEVICE_CODE 						AS [SKU.Product Device Code],
	PRODUCT_DEVICE_NAME 						AS [SKU.Product Device Name],
	GOPS_SEGMENT_CODE 							AS [SKU.Gops Segment Code],
	SUPPLIER_NAME 								AS [SKU.Supplier Name],
	MANUFACTURING_TD_SITE 						AS [SKU.Manufacturing TD Site],
	CLUSTER_CODE								AS [SKU.Cluster Code],
	TD_GAIN 									AS [SKU.TD Gain],
	PACKAGING_TD_SITE 							AS [SKU.Packaging TD Site],
	MANUFACTURING_OPS_CODE 						AS [SKU.Manufacturing OPS Code],
	PACKAGING_OPS_CODE 							AS [SKU.Packaging OPS Code],
	SUPPLIER_CODE 								AS [SKU.Supplier Code],
	PACKAGING_ITEM_CODE 						AS [SKU.Packaging Item Code],
	HYPERION_GAIN 								AS [SKU.Hyperion Gain],
	HYPERION_GAIN_MEMBER 						AS [SKU.Hyperion Gain_Member],
	MARKETING_TD_SITE 							AS [SKU.Marketing TD Site],
	LOCAL_BRAND_NAME 							AS [SKU.Local Brand Name],
	SKU_INDICATION 								AS [SKU.SKU Indication],
	IMS_ATC4_CODE 								AS [SKU.IMS STC4 Code],
	IMS_ATC4_NAME 								AS [SKU.IMS STC4 Name],
	DIAMOND_SEG_ASIA 							AS [SKU.Diamond Seg ASIA],
	NEW_LAUNCH_ASIA 							AS [SKU.New Launch Asia],
	NEW_LAUNCH_DATE_ASIA 						AS [SKU.New Launch Date Asia],
	PH_CODE 									AS [SKU.PH Code],
	PH_L1 										AS [SKU.PH_L1],
	PH_L2 										AS [SKU.PH_L2],
	PH_L3 										AS [SKU.PH_L3],
	PH_L4 										AS [SKU.PH_L4],
	MDG_L1 										AS [SKU.MDG_L1],
	MDG_L2 										AS [SKU.MDG_L2],
	MDG_L3 										AS [SKU.MDG_L3],
	MDG_L4 										AS [SKU.MDG_L4],
	GM_BRAND 									AS [SKU.GM Brand],
	GM_SUB_BRAND 								AS [SKU.GM Sub Brand],
	EARLIEST_PRAM_CODE 							AS [SKU.Earliest Pram Code],
	MATERIAL_NUMBER 							AS [SKU.Material Number],
	MATERIAL_GLOBAL_DESC 					    AS [SKU.Material Global Desc],
	DESTINATION_COUNTRY 						AS [SKU.Destination Country],
	DESTINATION_MARKET 							AS [SKU.Destination Mark],
	SKU_TYPE 									AS [SKU.SKU_type],
	GEN_PACK_MBI_PRODUCT_KEY 					AS [_SKU.GEN_PACK_MBI_PRODUCT_KEY],
	GEN_PACK_MATERIAL_NUMBER 					AS [SKU.GEN_PACK_MATERIAL_NUMBER], 
	GEN_PACK_PACK_CODE 							AS [SKU.GEN_PACK_PACK_CODE], 
	GEN_PACK_PROJECT_KEY 	 					AS [_SKU.PROJECT_KEY], 
	GEN_PACK_PLM_PRODUCT_KEY 					AS [_SKU.PRODUCT_KEY], 
	GEN_PACK_REGION_COUNTRY_KEY 				AS [_SKU.REGION_COUNTRY_KEY], 
	GEN_PACK_WP_KEY          					AS [_SKU.WP_KEY],
	GEN_PACK_PACK_KEY 							AS [_SKU.PACK_KEY]
//	GEN_PACK_PACK_KEY 							AS [_SKU.SKU_PACK_KEY]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_SKU.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);

///$tab PACK
LET vStartTime = now();

[PACK]:
LOAD 
PACK_KEY 										AS [_PACK.KEY],
PROJECT_KEY 									AS [_PACK.PROJECT_KEY], 
PRODUCT_KEY 									AS [_PACK.PRODUCT_KEY],
REGION_COUNTRY_KEY                              AS [_PACK.REGION_COUNTRY_KEY],
WP_KEY 											AS [_PACK.WP_KEY],
ACTIVITY                                        AS [PACK.Linked activity],//indicates which pack related to which CL WP
//Date(APPROVAL_DATE, 'DD-MMM-YYYY')            AS [PACK.Approval date], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
//LAST_PROJECT_STATUS_DATE                      AS [PACK.Project modification date],
//Date(LAUNCH_DATE, 'DD-MMM-YYYY')              AS [PACK.Launch date],
//LINKED_ACTIVITY_PTLD                          AS [PACK.PTLD],
// NAME                                            AS [PACK.Name],
ONB                                             AS [PACK.Internal number],
Date( PACK_CREATE_DATE , 'DD-MMM-YYYY')         AS [PACK.Pack create date],
Date(PACK_MOD_DATE, 'DD-MMM-YYYY')              AS [PACK.Pack modification date],
//PRJ_STATUS_ACTIVE                             AS [PACK.Project create date],
STRENGTH_FILL_VOLUME                            AS [PACK.Strength-Fill volume],
//SUBMISSION_DATE                               AS [PACK.Submission date],
//TEV_NF_D_PACK_DATE_OF_DAY                     AS [PACK.Date of the day],
PACKAGE_SIZE                                    AS [PACK.Pack size],
//LAUNCH_A_P                                    AS [PACK.Actual launch date],
//SUBMISSION_A_P                                AS [PACK.Actual submission],
// APPROVAL_A_P                                 AS [PACK.Approval A/P], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
PROJECT_ID                                      AS [PACK.Project ID],
//PROJECT_PROGRESS                              AS [PACK.Project progress],
//PROJECT_NAME                                  AS [PACK.Project name],
//GLOBAL_PRODUCT_ID                             AS [PACK.Global Product ID],
//GLOBAL_PRODUCT_GAIN                           AS [PACK.GAIN],
//ACT_PDT_INNOV_BRAND_NAME                      AS [PACK.Innovator Brand name],
//GLOBAL_PDT_ROUTE_ADMIN                        AS [PACK.Route of administration],
//MASTER_DOSAGE_FORM                            AS [PACK.Master dosage form],
//GLOBAL_PDT_TECHNOLOGY                         AS [PACK.Product technology],
//AOP_PACK_FORM                                 AS [PACK.Packaging form],
//PROJECT_TECHNOLOGY                            AS [PACK.Project technology],
//PROJECT_RATIONALE                             AS [PACK.Project Rationale],
LINKED_ACTIVITY_ONB                             AS [PACK.Country launch WP code],
//PROJECT_FILING_STRAT                          AS [PACK.Filing strategy],
PLM_CODE                                        AS [PACK.PLM Code],
PACK_ORIGIN                                     AS [PACK.Pack origin],
COMPUTED_PACK_STATUS                            AS [PACK.Computed pack status],
COUNTRY                                         AS [PACK.Country code],
STRENGTH_UOM                                    AS [PACK.Strength UOM],
LIVERY                                          AS [PACK.Livery],
PRIMARY_PACKAGING                               AS [PACK.Primary package],
PRESENTATION                                    AS [PACK.Presentation],
PACK_FV_UOM                                     AS [PACK.Fill volumes UOM],
//PROJECT_MFG_SITE                              AS [PACK.Country MFG site],
//PRJ_PACK_SITES                                AS [PACK.Country packaging site],
//PACK_REGION                                   AS [PACK.Region],
//SEGMENT_FROM_PRJ                              AS [PACK.Segment],
//BUSINESS                                      AS [PACK.Business],
//PRODUCT_SALES_CHANNEL                         AS [PACK.Sales channel],
//PROJECT_MANAGERS                              AS [PACK.Project manager],
//PRJ_IP_OWNER                                  AS [PACK.IP owner],
PACK_STATUS                                     AS [PACK.Pack status],
PACK_STRENGTH                                   AS [PACK.Strength],
PACK_FV                                         AS [PACK.FV],
//PROJECT_STATUS                                AS [PACK.Project status],
//GLOBAL_PDT_RATIONALE                          AS [PACK.Product rationale],
//WP_NAME                                       AS [PACK.Country launch WP description],
//FILL_VOLUME_STRENGTH_TAIL                     AS [PACK.Strength tail],
//PROJECT_BD_SUPPLIER                           AS [PACK.3rd party supplier name (FG)],
//PROJECT_LICENSEE								AS [PACK.Licensee], //V1, 07/06/2018, LMIZRAHITO - 21/06/2018 commented
//PROJECT_TYPE                                  AS [PACK.Project type],
//PROJECT_TEST_SITES                            AS [PACK.Country test site],
//PROJECT_RELEASE_SITES                         AS [PACK.Country release site],
//PACK_MDF                                      AS [PACK.Master dosage form 2],
//LIST_NUMBER                                     AS [PACK.List no.],
NOTE_PAD                                        AS [PACK.Note pad],
//MA_NUMBER                                     AS [PACK.MA no],
//PROJECT_MULTI_LICENSEE                        AS [PACK.Multi licensee],
//STRENGTH_FV_COMMON_STR                        AS [PACK.Common strength],
//STRENGTH_FILL_VOLUME_COMMON_FV                AS [PACK.Common FV],
//PROJECT_DEV_SITE                              AS [PACK.Development site],
OPERATIONAL_PLAN_PACK							AS [PACK.Operational Plan Pack],
NDC_NUMBER										AS [PACK.NDC No.],
NDC_STATUS										AS [PACK.NDC status]
 FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_PACK.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab WORKPACKAGE
LET vStartTime = now();

[WORKPACKAGE]:
LOAD
	WP_KEY									AS [_WP.KEY],
	PROJECT_KEY 							AS [_WP.PROJECT_KEY],
	REGION_COUNTRY_KEY 						AS [_WP.REGION_COUNTRY_KEY],
	DESCRIPTION                             AS [WP.Description],
//ACTUAL_FINISH                             AS [WP.Actual Finish], //V1, 07/06/2018, LMIZRAHITO - added field, commented 23/07/2018 (Talya)
//ACTUAL_FINISH_DAT_KEY						AS [_WP.ACTUAL_FINISH_DAT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
//ACTUAL_START                              AS [WP.Actual start], //V1, 07/06/2018, LMIZRAHITO - added field, commented 23/07/2018 (Talya)
//ACTUAL_START_DAT_KEY						AS [_WP.ACTUAL_START_DAT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	PLM_ID                                  AS [WP.plm_id],
//MODIFY_VERSION                            AS [WP.Object version number],
//NAME                                      AS [WP.Name],
	NETWORK                                 AS [WP.network],
//PROJECT                                  	AS [WP.Project],//vf: 12-04-2018
	PLANNED_FINISH                          AS [WP.Planned Finish], //V1, 07/06/2018, LMIZRAHITO - added field, commented 23/07/2018 (Talya)
//PLANNED_FINISH_DAT_KEY					AS [_WP.PLANNED_FINISH_DAT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	PLANNED_START                           AS [WP.Planned Start], //V1, 07/06/2018, LMIZRAHITO - added field, commented 23/07/2018 (Talya)
//PLANNED_START_DAT_KEY						AS [_WP.PLANNED_START_DAT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
//IS_PRELIM_ANALYSIS                        AS [WP.Preliminary allocation],
//INDICATION_IN_FILES                       AS [WP.Indications in file],
	REASON_DELAY_COMMENTS                   AS [WP.Reason for delay comments],
//PRJ_TEV_RA_PRJ_GAIN                       AS [WP.GAIN],
//PTLD_APPROVAL                             AS [WP.PTLD Approval (obsolete)],
//TLD_APPROVAL                              AS [WP.TLD Approval (obsolete)],
//PTLD                                      AS [WP.PTLD  (to change?)],
//TLD                                       AS [WP.TLD  (to change?)],
//TLD_DAT_KEY								AS [_WP.PLANNED_START_DAT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	ACT_ONB                                 AS [WP.ONB AS String],
	PLM_ONB                                 AS [WP.plm_onb],
	CMS_COUNTRIES                           AS [WP.CMS Countries],
	COUNTRY_DESC                            AS [WP.Country Full Name],
//DEV_TYPE                                  AS [WP.Dev. type WP],
	GRD_PROJECT_NAME                        AS [WP.GR&D Project Name],
//LAUNCHING_SITE_FROM_CL_WP                 AS [WP.Launching Site],
//PACKAGING_SITE                            AS [WP.Packaging site],
	STRENGTH_FILL_VOLUME_UOM                AS [WP.Strength-fill Volume UOM],
//RND_PROJECT_CONTACT                       AS [WP.R&D Project Contact Person],
//THIRD_FG_SUPPLIER                         AS [WP.3rd party supplier name (FG)],
	PROGRESS                                AS [WP.Progress],
	FTM 									AS [WP.FTM],
	LAUNCH_PROBABILITY						AS [WP.Launch Probability],
	LIVERY						 			AS [WP.Livery],   
	ON_TIME_LAUNCH							AS [WP.On time launch],
//TEV_RA_PRIORITY                           AS [WP.Priority],
//SENDING_SITE                              AS [WP.Sending site],
	STATUS                                  AS [WP.Status],
	FILLING_STRATEGY                        AS [WP.Filing strategy],
//WP_STATUS_ALLOC                           AS [WP.Allocation status],
	COUNTRIES                               AS [WP.Countries],
	ACT_STRENGTHS_FV                        AS [WP.Strengths-Fill volumes],
//LAUNCH_DATE_EARLIEST                      AS [WP.1st Launch date],
	ACTIVITY_TYPE                           AS [WP.Activity type],
	LAUNCH_DATE							    AS [WP.Launch date],
//LAUNCH_DAT_KEY                            AS [WP.launch_dat_key],
//PACKAGING_SITE_NPIS                       AS [WP.Packaging site (NPIS)],
	WP_NAME                                 AS [WP.WP Name],
	SUBMISSION_PROBABILITY                  AS [WP.Submission probability],
	D_APPROVAL_EOP                          AS [WP.Approval (EOP)],
	D_APPROVAL_EOP_DATE_KEY                 AS [_WP.d_approval_eop_date_key],
	FTM_COMMENTS                            AS [WP.FTM comments],
	IN_CONSO_BRANCH                         AS [WP.Is consolidated],
	RA_CL_WP_PGT_MKT_COMP                   AS [WP.Marketing Company],
	REVIEWING_COUNTRIES                     AS [WP.Reviewing coutry],
	S_APPROVAL_EOP_A_OR_P                   AS [WP.Approval (EOP) A/P],
	B_NOT_COUNTED4LAUNCH                    AS [WP.Not counted for launch],
    NOT_COUNTED4NEWLAUNCH                   as [WP.Not counted for new launch],
   
	S_REASON_FOR_DELAY					 	AS [WP.Reason for delay],
	S_COUNTRY_LIVERY_PROGRESS               AS [WP.Country livery progress],
	D_SUBMISSION_D_FOR_LIVERY               AS [WP.Submission date for livery],
//D_SUBMISION_D_FOR_LIVRY_KEY				AS [_WP.D_SUBMISION_D_FOR_LIVRY_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_SUBMISSION_AP_FOR_LIVERY              AS [WP.Submission A/P for livery],
	D_APPROVAL_D_FOR_LIVERY 				AS [WP.Approval date for livery],
	D_FOR_LIVERY_DATE_KEY                   AS [_WP.d_for_livery_date_key],
	S_APPROVAL_AP_FOR_LIVERY                AS [WP.Approval A/P for livery],
//S_API_SUPPLIER_DEV                        AS [WP.API Supplier DEV ],
//S_API_SUPPLIER_LAUNCH                     AS [WP.Launching API supplier],
	D_DRAFT_PTLD_FROM_MS                    AS [WP.Draft PTLD],
//D_DRAFT_PTLD_FROM_MS_DATE_KEY				AS [_WP.D_DRAFT_PTLD_FROM_MS_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	B_PTLD_APPROVAL_FROM_MS                 AS [WP.PTLD Approval],
	D_GET_COUNTRY_LIVERY_PTLD_D             AS [WP.PTLD for livery],
//D_GET_COUNTRY_LIVERY_PTLD_KEY				AS [_WP.D_GET_COUNTRY_LIVERY_PTLD_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	COUNTRY_LIVERY_PTLD_A_P                 AS [WP.PTLD A/P for livery],
	D_DRAFT_TLD_FROM_MS                     AS [WP.Draft TLD ],
	D_DRAFT_TLD_FROM_MS_D_KEY               AS [_WP.d_draft_tld_from_ms_d_key],
	B_TLD_APPROVAL_FROM_MS					AS [WP.TLD Approval],
	D_GET_COUNTRY_LIVERY_TLD_D              AS [WP.TLD for livery],
//D_GET_COUNTRY_LIVERY_TLD_KEY				AS [_WP.D_GET_COUNTRY_LIVERY_TLD_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_COUNTRY_LIVERY_TLD_A_P                AS [WP.TLD date A/P],
//S_PROJECT_PLFD_EARLY                      AS [WP.PLFD date ],
	S_PLFD_DESC_FOR_LIVERY                  AS [WP.PLFD desc for livery],
	S_PROJECT_PLFD_MAIN                     AS [WP.PLFD main ],
	COUNTRY_LIVERY_SUB_F_SENT_D             AS [WP.Submission file sent to submitter for livery],
//COUNTRY_LIVRY_SUB_F_SENT_KEY				AS [_WP.COUNTRY_LIVRY_SUB_F_SENT_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	COUNTRY_LIVERY_SUB_F_SENT_AP            AS [WP.Submission file sent to submitter A/P for livery],
	D_LIVERY_DAY_0_DATE                     AS [WP.Day 0 for livery],
// D_LIVERY_DAY_0_DATE_KEY					AS [_WP.D_LIVERY_DAY_0_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_LIVERY_DAY_0_A_P                      AS [WP.Day 0 A/P for livery],
	D_LIVERY_DAY_105_DATE                   AS [WP.Day 105 for liver],
// D_LIVERY_DAY_105_DATE_KEY				AS [_WP.D_LIVERY_DAY_105_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_LIVERY_DAY_105_A_P                    AS [WP.Day 105 A/P for livery],
	D_LIVERY_DAY_106_DATE                   AS [WP.Day 106 for livery],
// D_LIVERY_DAY_106_DATE_KEY				AS [_WP.D_LIVERY_DAY_106_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_LIVERY_DAY_106_A_P                    AS [WP.Day 106 A/P for livery],
	D_LIVERY_APPROVAL_EOP_DATE              AS [WP.Approval (EOP) date],
// D_LIVERY_APPROVAL_EOP_DATE_KEY			AS [_WP.D_LIVERY_APPROVAL_EOP_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	LIVERY_APPROVAL_EOP_A_P                 AS [WP.Approval (EOP) date A/P],
	S_MA_NO_FOR_LIVERY                      AS [WP.MA number for Livery], //V1, 07/06/2018, LMIZRAHITO - renamed field 21/06/2018
	S_COUNTRY_MFG_SITE   					AS [WP.Country manufacturing site],                                
	S_COUNTRY_PACK_SITE						AS [WP.Country Packaging site],
	S_QUALITY_MOD_3P                        AS [WP.Quality of module 3.P at submission],
	S_QUALITY_MOD_3S                        AS [WP.Quality of module 3.S at submission],
	S_QUALITY_MOD_5                         AS [WP.Quality of module 5 at submission],
	S_FILE_QUALITY                          AS [WP.Current File Quality],
	S_TENTATIVE_APPROVAL_AP                 AS [WP.Tentative approval date A/P],
	D_TENTATIVE_APPROVAL                    AS [WP.Tentative approval date],
// D_TENTATIVE_APPROVAL_KEY					AS [_WP.D_TENTATIVE_APPROVAL_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	D_APPROVAL                              AS [WP.Approval Date],
// D_APPROVAL_DATE_KEY						AS [_WP.D_APPROVAL_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_APPROVAL_AP                           AS [WP.Approval A/P],
	D_SUBMISSION                            AS [WP.Submission Date],
// D_SUBMISSION_DATE_KEY					AS [_WP.D_SUBMISSION_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_SUBMISSION_AP                         AS [WP.Submission A/P],
	D_DAY0                                  AS [WP.Day 0],
// D_DAY0_DATE_KEY							AS [_WP.D_DAY0_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_DAY0_AP                               AS [WP.Day 0 A/P],
	S_LAUNCH_A_OR_P							AS [WP.Launch A/P],
//New fields added by LMIZRAHITO 07/06/2018
	RA_REM									AS [WP.RA remarks], //V1, 07/06/2018, LMIZRAHITO - added field
//	RA_SUB_FILE_STRAT						AS [WP.RA Filling strategy], //V1, 07/06/2018, LMIZRAHITO - added field
//  2020-04-06 DISAIEV changed the name from RA File Quality  to  File quality at submission
    RA_FILE_QUALITY							AS [WP.File quality at submission], // 2019-05-10 -- RSYSIUK
    IMS_CMAT_DATE							AS [WP.MAT Date], //V1, 07/06/2018, LMIZRAHITO - added field
// IMS_CMAT_DATE_KEY						AS [_WP.IMS_CMAT_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_RA_COUNTRY_REM						AS [WP.Country remarks], //V1, 07/06/2018, LMIZRAHITO - added field
	S_CL_WP_NAME							AS [WP.Country Launch Name], //V1, 07/06/2018, LMIZRAHITO - added field
	S_IN_FULL								AS [WP.In full], //V1, 07/06/2018, LMIZRAHITO - added field
	S_IN_FULL_COMM							AS [WP.In full comments], //V1, 07/06/2018, LMIZRAHITO - added field
	S_ACT_QTY_DELIVERED						AS [WP.Actual quantity delivered], //V1, 07/06/2018, LMIZRAHITO - added field
	S_REASON_RED_EX_Q						AS [WP.Reason for reduced/exceeding quantities], //V1, 07/06/2018, LMIZRAHITO - added field
	S_COMMERCIAL_SUCCESS					AS [WP.Commercial success], //V1, 07/06/2018, LMIZRAHITO - added field
	S_COMMERCIAL_SUCCESS_COMM				AS [WP.Commercial success comments], //V1, 07/06/2018, LMIZRAHITO - added field
//S_REVIEWING_COUNTRIES						AS [WP.Reviewing coutry 2], //V1, 07/06/2018, LMIZRAHITO - added field //17/06/2018 - Remarked 24/06/2018, its the same as REVIEWING_COUNTRIES
	RA_MA_NUMBER							AS [WP.MA number for RA], //V1, 07/06/2018, LMIZRAHITO - added field //17/06/2018
	D_BASELINE_DATE							AS [WP.Baseline date], //V1, 07/06/2018, LMIZRAHITO - added field
// D_BASELINE_DATE_KEY						AS [_WP.D_BASELINE_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_SITE_BASELINE_COM						AS [WP.Site baseline comments], //V1, 07/06/2018, LMIZRAHITO - added field
	S_BASELINE_COMMENTS						AS [WP.Baseline comments], //V1, 07/06/2018, LMIZRAHITO - added field
	D_DAY_70								AS [WP.DAY 70], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
// D_DAY_70_DATE_KEY						AS [_WP.D_DAY_70_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_DAY_70_AP								AS [WP.DAY 70 AP], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
	D_DAY_105								AS [WP.DAY 105], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
// D_DAY_105_DATE_KEY						AS [_WP.D_DAY_105_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_DAY_105_AP							AS [WP.DAY 105 AP], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
	D_DAY_180								AS [WP.DAY 180], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
// D_DAY_180_DATE_KEY						AS [_WP.D_DAY_180_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_DAY_180_AP							AS [WP.DAY 180 AP], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
	D_DAY_210								AS [WP.DAY 210], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
// D_DAY_210_DATE_KEY						AS [_WP.D_DAY_210_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
	S_DAY_210_AP							AS [WP.DAY 210 AP], //V1, 07/06/2018, LMIZRAHITO - added field, renamed 19/06/2018
	COUNTRY_LAUNCH_NAME						AS [WP.COUNTRY_LAUNCH_NAME], //V1, 07/06/2018, LMIZRAHITO - added field
	SALES_KDOL								AS [WP.SALES_KDOL], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_SALE_KDOL							AS [WP.PMAT_SALE_KDOL], //V1, 07/06/2018, LMIZRAHITO - added field
	SALES_KEUR								AS [WP.SALES_KEUR], //V1, 07/06/2018, LMIZRAHITO - added field
	SALES_KLC								AS [WP.SALES_KLC], //V1, 07/06/2018, LMIZRAHITO - added field
	EXT_UNITS								AS [WP.EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_EXT_UNITS							AS [WP.PMAT_EXT_UNITS], //V1, 07/06/2018, LMIZRAHITO - added field
	CMAT_EACHES								AS [WP.CMAT_EACHES], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_EACHES								AS [WP.PMAT_EACHES], //V1, 07/06/2018, LMIZRAHITO - added field
	CMAT_CU									AS [WP.CMAT_CU], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_CU									AS [WP.PMAT_CU], //V1, 07/06/2018, LMIZRAHITO - added field
	STD_UN									AS [WP.STD_UN], //V1, 07/06/2018, LMIZRAHITO - added field
	IMS_KG									AS [WP.IMS_KG], //V1, 07/06/2018, LMIZRAHITO - added field
	CMAT_K_UN								AS [WP.CMAT_K_UN], //V1, 07/06/2018, LMIZRAHITO - added field
	PMAT_K_UN								AS [WP.PMAT_K_UN], //V1, 07/06/2018, LMIZRAHITO - added field

//STATUS_RANK								AS [WP.Status Rank],
//Flags added by VFerman on 21-3-2018 for data accuracy reports
	FTM_MISSING_FLAG						AS [WP.Missing FTM Flag],
	MISSING_FTM_COMMENTS_FLAG				AS [WP.Missing FTM Comments Flag],
	MISSING_ON_TIME_LAUNCH_FLAG				AS [WP.Missing On-Time Launch Flag],
	MISSING_REASON4DELAY_FLAG				AS [WP.Missing Reason for Delay Flag],
	MISSINGREAS4DELAYCOMMENTS_FLAG			AS [WP.Missing Reason for Delay Comments Flag],
	MISSING_LAUNCH_PROBAB_FLAG				AS [WP.Missing Launch Probability Flag],
	MISSING_LAUNCH_DATE_FLAG				AS [WP.Mising Launch Date Flag],
	EXPIRED_LAUNCH_DATE_FLAG				AS [WP.Missing Launch Date Flag],
	MISSING_LIVERY_FLAG						AS [WP.Missing Livery Flag],
	MISSING_PACKAGING_SITE_FLAG				AS [WP.Missing Packaging Site Flag],
	MISSING_MFG_SITE_FLAG					AS [WP.Missing MFG Site Flag],
	MISSING_DAY_0_FLAG						AS [WP.Missing Day0 Flag],
	MISSING_LIVERY_DAY_106_FLAG				AS [WP.Missing Livery Day 106 Flag],
	MISSING_APPROVAL_EOP_DATE_FLAG			AS [WP.Missing Approval EOP date Flag],
	MISSING_APPROVAL_FLAG					AS [WP.Missing Approval Flag],
	MISSING_SUBMISSION_DATE_FLAG			AS [WP.Missing Submission Date Flag],
	SUBMISSION_DATE_PASSED_FLAG				AS [WP.Submission Date Passed Flag],
	DAY0_PASSED_FLAG						AS [WP.Day0 Passed Flag],
	DAY106_LIVERY_PASSED_FLAG				AS [WP.Day106 Livery Passed Flag],
	APPROVAL_EOP_PASSED_FLAG				AS [WP.Approval EOP Date Passed Flag],
	APPROVAL_DATE_PASSED_FLAG				AS [WP.Approval Date Passed Flag],
	DAY70_PASSED_FLAG						AS [WP.Day 70 Passed Flag],
	DAY105_PASSED_FLAG						AS [WP.Day 105 Passed Flag],
	DAY180_PASSED_FLAG						AS [WP.Day 180 Passed Flag],
	DAY210_PASSED_FLAG						AS [WP.Day 210 Passed Flag],
//Below added by M.Jacobs 2018-Sep-18
	MISSING_IN_FULL_FLAG					AS [WP.Missing In Full Flag],
	MISSING_IN_FULL_COMMENTS_FLAG			AS [WP.Missing In Full Comments Flag],
	MISSING_CONS_RAWPS_FLAG					AS [WP.MISSING_CONS_RAWPS_FLAG], 
	MISSING_CONS_CLWPS_FLAG					AS [WP.MISSING_CONS_CLWPS_FLAG],
    CHG_PRJ_TO_ACTIVE_FLAG					AS [WP.CHG_PRJ_TO_ACTIVE_FLAG],
    CHG_PRJ_TO_COMPLETED_FLAG				AS [WP.CHG_PRJ_TO_COMPLETED_FLAG],
    CHG_PRJ_TO_COMPLETED_MINUS_1			AS [WP.CHG_PRJ_TO_COMPLETED_MINUS_1],
    CHG_PRJ_TO_COMPLETED_MINUS_2			AS [WP.CHG_PRJ_TO_COMPLETED_MINUS_2],
//Above added by M.Jacobs 2018-Sep-18ff

// ims measures from REG_PDT
//SALES_IN_KEUR                             AS [WP.SALES_IN_KEUR], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//SALES_IN_KUSD                             AS [WP.SALES_IN_KUSD], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//COUNTING_UNITS                            AS [WP.COUNTING_UNITS], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//KG                                        AS [WP.KG], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//SU                                        AS [WP.SU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
	IMS_SALES_K_USD                         AS [WP.IMS_SALES_K_USD],
	IMS_SALES_K_EUR                         AS [WP.IMS_SALES_K_EUR],
	IMS_EXT_UNITS                           AS [WP.IMS_EXT_UNITS],
	IMS_EACHES                              AS [WP.IMS_EACHES],
	IMS_UNITS                               AS [WP.IMS_UNITS],
	IMS_PREV_SALES_K_USD                    AS [WP.IMS_PREV_SALES_K_USD],
	IMS_SALES_K_LC                          AS [WP.IMS_SALES_K_LC],
//IMS_CU									AS [WP.IMS_CU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
	IMS_PREV_CU                             AS [WP.IMS_PREV_CU],
//IMS_SU									AS [WP.IMS_SU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
	IMS_PREV_UNITS                          AS [WP.IMS_PREV_UNITS],
	IMS_PREV_EACHES                         AS [WP.IMS_PREV_EACHES],
	IMS_PMAT_EXT_UNITS                      AS [WP.IMS_PMAT_EXT_UNITS],
	SP_ARMS									AS [WP.Arms],
	CLINICAL_STUDY_PHASE					AS [WP.Clinical Study Phase],
	ESTIMATED_NUMBER_OF_SITES				AS [WP.Estimated Number Of Sites],
	PROTOCOL_NUMBER							AS [WP.Protocol Number],
	SP_REGIONS								AS [WP.Regions],
	SP_SAMPLE_SIZE							AS [WP.Sample Size],
	STUDY_DESCRIPTION						AS [WP.Study Description],
	STUDY_TYPE								AS [WP.Study Type],
	SPECIALTY_WBS_TYPE						AS [WP.Specialty Activity Type],
	TEMPLATE_UID							AS [WP.Template UID],
	LABEL_FOR_MAP							AS [WP.Label For Map Reports],
	ACT_NAME								AS [WP.Activity Name],
	CLINICAL_FLAG							AS [WP.Clinical_Flag],
	CLINICAL_SEPARATOR						AS [_TASK_WP.Clinical_Separator],
	INTERNAL_NUMBER							AS [WP.Internal Number],
    LEGAL_LMD								AS [WP.Legal IP Latest],
    FILE_APPROVABILITY                      AS [WP.File Approvability],  
    RA_WP_NOTEPAD                           AS [WP.notepad],
    PROC_NUMBER_FOR_WP                      AS [WP.Procedure Number for WP],
    // Added on 2021-04-18 on neta request
    STUDY_HYPERION_CODE	                    AS [WP.Study Hyperion Code],
    //2021-07-15 Olga Voloshchuk                  added new column LINE_IDENTIFIER
    LINE_IDENTIFIER         as [WP.Line Identifier],
    LIV_OF_CL_RELATED	,

LAR_COMMENT as [WP.Lar Comment]	,
LAR_CANDIDATE as [WP.Lar Candidate]	,
PLP_SEND_TEST_SITE	as [WP.PLP Sending Test Site],
PLP_SEND_STAB_TEST_SITE	as [WP.PLP Sending Stability Test Site],
PLP_SEND_SEC_PKG_SITE as [WP.PLP Sending Secondary Packaging Site]	,
PLP_SEND_RELEASE_SITE as [WP.PLP Sending Release Site]		,
PLP_SEND_PRIM_PKG_SITE	as [WP.PLP Sending Primary Packaging Site],
PLP_SEND_BULK_MFG_SITE	as [WP.PLP Sending Bulk Mfg Site],
PLP_REC_TEST_SITE as	[WP.PLP Receiving Test Site],
PLP_REC_STAB_TEST_SITE	as [WP.PLP Receiving Stability Test Site],
PLP_RECEI_SEC_PKG_SITE as [WP.PLP Receiving Secondary Packaging Site]	,
PLP_REV_RELEASE_SITE as [WP.PLP Receiving Release Site]	,
PLP_RECEI_PRIM_PKG_SITE as [WP.PLP Receiving Primary Packaging Site]	,
PLP_RECEI_BULK_MFG_SITE as [WP.PLP receiving Bulk Mfg Site]	,
ACT_COUNTRIES	 as [WP.PLP Act Countries],
DISPLAY_IN_REPORTS as [WP.Display in reports] 

FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_WORKPACKAGE.QVD](qvd);

Left Join(WORKPACKAGE)
Load [WP.Protocol Number], 1 as flag_duplicates
Where flag > 1;
Load [WP.Protocol Number], count(distinct [_WP.KEY]) as flag
Resident WORKPACKAGE
Group By [WP.Protocol Number]
;

Left Join(WORKPACKAGE)
Load [_WP.KEY], 1 as [_WP.Sub.Flag]
Resident WORKPACKAGE
Where flag_duplicates = 1 and not [WP.Clinical_Flag]=1;
drop Field flag_duplicates;

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////

LEFT JOIN(PROJECT)
LOAD [_WP.PROJECT_KEY] as [_PJT.KEY],
min([WP.MISSING_CONS_RAWPS_FLAG]) as [T_PJT.MISSING_CONS_RAWPS_FLAG],
min([WP.MISSING_CONS_CLWPS_FLAG]) as [T_PJT.MISSING_CONS_CLWPS_FLAG],
max([WP.CHG_PRJ_TO_ACTIVE_FLAG]) as [T_PJT.CHG_PRJ_TO_ACTIVE_FLAG],
max([WP.CHG_PRJ_TO_COMPLETED_FLAG]) as [T_PJT.CHG_PRJ_TO_COMPLETED_FLAG],
max([WP.CHG_PRJ_TO_COMPLETED_MINUS_1]) as [T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_1],
max([WP.CHG_PRJ_TO_COMPLETED_MINUS_2]) as [T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_2]
Resident WORKPACKAGE
Group By [_WP.PROJECT_KEY];
Drop Fields [WP.MISSING_CONS_RAWPS_FLAG],[WP.MISSING_CONS_CLWPS_FLAG]
,[WP.CHG_PRJ_TO_ACTIVE_FLAG],[WP.CHG_PRJ_TO_COMPLETED_FLAG],[WP.CHG_PRJ_TO_COMPLETED_MINUS_1],[WP.CHG_PRJ_TO_COMPLETED_MINUS_2];

LEFT JOIN(PROJECT)
LOAD [_PJT.KEY],
Alt([T_PJT.MISSING_CONS_RAWPS_FLAG],1) as [PJT.MISSING_CONS_RAWPS_FLAG],
Alt([T_PJT.MISSING_CONS_CLWPS_FLAG],1) as [PJT.MISSING_CONS_CLWPS_FLAG],
if([PJT.Status] = 'Completed' and [T_PJT.CHG_PRJ_TO_ACTIVE_FLAG] = 1, 1) as [PJT.CHG_PRJ_TO_ACTIVE_FLAG],
if( [PJT.Status] = 'Active' and
	Alt([T_PJT.CHG_PRJ_TO_COMPLETED_FLAG],0)-Alt([T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_1],0)-Alt([T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_2],0)=1
    ,1,0) as [PJT.CHG_PRJ_TO_COMPLETED_FLAG]
Resident PROJECT;
Drop Fields [T_PJT.MISSING_CONS_RAWPS_FLAG],[T_PJT.MISSING_CONS_CLWPS_FLAG]
,[T_PJT.CHG_PRJ_TO_ACTIVE_FLAG],[T_PJT.CHG_PRJ_TO_COMPLETED_FLAG],[T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_1],[T_PJT.CHG_PRJ_TO_COMPLETED_MINUS_2];


LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab TASK_WP
LET vStartTime = now();

TASK_WP: // 2018-09-11 RSYSIUK	add tasks
LOAD
	TASK_WP_KEY				as [_TASK_WP.KEY],
	WP_KEY					as [_TASK_WP.WP_KEY_1],
	PROJECT_KEY				as [_TASK_WP.PROJECT_KEY],
	REGION_COUNTRY_KEY		as [_TASK_WP.REGION_COUNTRY_KEY],
	PROJECT					as [TASK_WP.Project],
	NAME					as [TASK_WP.Name],
	NETWORK					as [TASK_WP.WBS Element],
	ONB						as [TASK_WP.Internal Number],
	ACTIVITY_TYPE			as [TASK_WP.Activity Type],
	ACTIVITY_NAME			as [TASK_WP.Activity Name],
	ACTUAL_START			as [TASK_WP.Actual Start],
	ACTUAL_FINISH			as [TASK_WP.Actual Finish],
	START_NO_LATER_THAN		as [TASK_WP.Start No Later Than],
	FINISH_NO_LATER_THAN	as [TASK_WP.Finish No Later Than],
	PLANNED_START			as [TASK_WP.Planned Start],
	PLANNED_FINISH			as [TASK_WP.Planned Finish],
	FIXED_START				as [TASK_WP.Fixed Start Date],
	D_DRAFT_PTLD			as [TASK_WP.Draft PTLD],
	LMD_DATE				as [TASK_WP.IP Latest Date],
    //rename  on Talya req. 01122021
	LMD_DESC				as [TASK_WP.IP Latest comments],
	IS_AN_INDICATION		as [TASK_WP.Is An Indication],
    IS_A_OR_P				as [TASK_WP.Activity A/P],
	TEMPLATE_UID			as [TASK_WP.Template UID],
	LABEL_FOR_MAP			as [TASK_WP.Label For Map Reports],
	IDENTIFIER_OBJ			as [TASK_WP.Identifier],
    CLINICAL_WP_ONB			AS [TASK_WP.Clinical PLM_ONB],
    TASK_DESC				as [TASK_WP.Description],
    
    FLAG_CRITICAL_MILESTONE	as [_Task_WP.flag.Critical Milestone],
    FLAG_GNG				as [_Task_WP.flag.GNG],
    US_SUBMISSIONS_DATE		as [_Task_WP.flag.US Submissions],
	US_TARGET_APPROVAL_DATE	as [_Task_WP.flag.US Target Approval],
	EU_SUBMISSIONS_DATE		as [_Task_WP.flag.EU Submissions],
	EU_TARGET_APPROVAL_DATE	as [_Task_WP.flag.EU Target Approval],
	CHINA_SUBMISSIONS_DATE	as [_Task_WP.flag.China Submissions],
	CHINA_TARGET_APPROVAL_DATE	as [_Task_WP.flag.China Target Approval],
    STUDY_STATUS_NULL		as [_Task_WP.Study Status.null],
	DATE_RANGE				as [_Task_WP.Date Range],
    FLAG_PHASE_1_DATE		as [_Task_WP.flag.Phase 1 Date],
	FLAG_PHASE_2_DATE		as [_Task_WP.flag.Phase 2 Date],
	FLAG_PHASE_3_DATE		as [_Task_WP.flag.Phase 3 Date],
    FLAG_PSO				as [_Task_WP.flag.Protocol Approval (PSO)],
	FLAG_FPI				as [_Task_WP.flag.First Patient In (Enrolled - FPI)],
	FLAG_LPI				as [_Task_WP.flag.Last Patient In (Enrolled - LPI)],
	FLAG_LPLV				as [_Task_WP.flag.Last Patient Last Visit (LPLV)],
	FLAG_DBLOCK				as [_Task_WP.flag.Database Lock (DBLock)],
    FLAG_FPS				as [_Task_WP.flag.First Patient Screened (FPS)],
    FLAG_FDR				as [_Task_WP.flag.Start Data Retreival],
    FLAG_CSR				as [_Task_WP.flag.CSR Approval & Delivered (CSR)],
    FLAG_HF_SRD				as [_Task_WP.flag.Human Factor Summary Report Development],
    FLAG_OPS_R				as [_Task_WP.flag.Ops Readiness],
    FLAG_PRE_VAL			as [_Task_WP.flag.Pre-Validation Start],
    FLAG_LB					as [_Task_WP.flag.Launch Build Start],
    FLAG_TV					as [_Task_WP.flag.Target validation Start],
    
    FLAG_NON_AUDITED_DRAFT_REPORT	as [_Task_WP.flag.Non audited draft report],
    FLAG_AUDITED_DRAFT_REPORT	as [_Task_WP.flag.Audited draft report],
	FLAG_IND_OR_CTA_SUBMISSION	as [_Task_WP.flag.IND/CTA Submission],
	FLAG_TOP_LINE_RESULTS_AVLBL	as [_Task_WP.flag.Top Line Results Available],
	FLAG_SUBMISSIONS		as [_Task_WP.flag.Submissions],    
    
    FLAG_API_V_L			as [_Task_WP.flag.API for Validation and Launch Build],
    FLAG_ACTIVITY_TYPE_NULL	as [TASK_WP.Activity Type (Empty/Not Empty)],
	MILESTONE_CATEGORY		as [TASK_WP.Milestone Category],
    D_MS_START_CRL			as [TASK_WP.CRL Start Date],
    D_MS_FINISH_CRL			as [TASK_WP.CRL Finish Date],
    D_MS_DRM_PRI2DOSING		as [TASK_WP.Design Review Meeting (Prior to Dosing) Date],
    D_MS_DRM_PRI2MANUFACTURE	as [TASK_WP.Design Review Meeting (Prior to Manufacture) Date],
    D_MS_DRM_PRI2SUBMISSION	as [TASK_WP.Design Review Meeting (Prior to Submission) Date],
    D_1ST_SUBM_BATCH_MANUF	as [TASK_WP.1st Manufacture Submission Batches Date],
    D_HANDOVER				as [TASK_WP.Handover Date],
    D_HIH_INIT				as [TASK_WP.HiH Initiation Date],
    D_PRE_VALIDATION		as [TASK_WP.Pre-validation Date],
    D_PROC_DESIGN_VALID_MANUF	as [TASK_WP.Process Design Manufacture Date],
    D_VALID_R4E				as [TASK_WP.Validation Readiness for Execution Date],
    D_TGT_VALID_MANUF		as [TASK_WP.Target Validation Manufacture Date],
    NOT_CONSOLIDATE			as [TASK_WP.Not Consolidate],
    SP_ACTIVITY_TYPE		as [TASK_WP.Specialty Activity Type],
    FLAG_SP_ACTIVITY_TYPE_NULL as [TASK_WP.Specialty Activity Type (Empty/Not Empty)],
 //2021-07-15 Olga Voloshchuk                  added new columns LINE_IDENTIFIER,TARGET_START_DATE Task_WP Section
    LINE_IDENTIFIER         as [TASK_WP.Line Identifier],
    TARGET_START_DATE       as [TASK_WP.Target Start Date]
    //170120222 added new fields 
    ,PREDECESSORS as [TASK_WP.Predecessors]
,SUCCESSORS as  [TASK_WP.Successors]
,IP_EARLIEST_ASAP as [TASK_WP.IP Earliest ASAP]
,IP_EARLIEST as  [TASK_WP.IP Earliest]

,IP_EARLIEST_COMMENTS as [TASK_WP.IP Earliest comments]
,MATTER_NAME as  [TASK_WP.Matter Name]
,MATTER_ID as [TASK_WP.Matter Id]
,if (IP_BASE<>'ASAP',IP_BASE) as  [TASK_WP.IP Base]
,if (IP_BASE='ASAP',IP_BASE) as  [TASK_WP.IP Base ASAP]
,IP_BASE_COMMENT  as [TASK_WP.IP Base comment]
//,STABILITY_ZONE as   [TASK_WP.Stability Zone] - removed as not related to Gantt
,PLP_WP_COMMIT_CURRENT as [TASK_WP.PLP WP Commitment date - Current Year]
,PLP_WP_COMMIT_NEXT    as [TASK_WP.PLP WP Commitment date - Next Year]
,GATE_OUTCOME          as [TASK_WP.Gate Outcome]	
,ORIGINAL_PLANNED_START_DATE  as [TASK_WP.PLP Original Planned Start Date]
,ORIGINAL_PLANNED_FINISH_DATE as [TASK_WP.PLP Original Planned Finish Date]
,CURRENT_DATES         as [TASK_WP.PLP Current Dates]
,CURRENT_START_DATE    as [TASK_WP.PLP Current Start Date]
,PUBLICATION_PLANNED_DATE as [TASK_WP.Publication Planned Date]
,PUBLICATION_ACTUAL_DATE  as [TASK_WP.Publication Actual Date]
,MILESTONE_STATUS         as [TASK_WP.Milestone Status]
,DISPLAY_IN_SG            as [TASK_WP.Display in Stage]
,VERSION_BASELINE_CREATE_DATE   as [TASK_WP.Creation date: Latest approved version]
,APPROVED_BASELINE_CREATE_DATE  as [TASK_WP.Creation date: Initial GPC approved]
,APPROVED_VER_BASELINE_PF       as [TASK_WP.End Date: Latest approved version]
,APPROVED_VER_BASELINE_PS       as [TASK_WP.Start Date: Latest approved version]
,GPC_APPROVED_BASELINE_PF       as [TASK_WP.End Date: Initial GPC approved]
,GPC_APPROVED_BASELINE_PS       as [TASK_WP.Start Date: Initial GPC approved]



FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_TASK_OF_WP.QVD](qvd);

// add parent wp key to subwp tasks
Left Join(TASK_WP)
Load Distinct
	[WP.plm_onb]			as [TASK_WP.Clinical PLM_ONB],
	[_WP.KEY]				as [_TASK_WP.WP_KEY_2]
Resident WORKPACKAGE
;

// use only parent wp keys
Left Join(TASK_WP)
LOAD [_TASK_WP.KEY],
if([_TASK_WP.WP_KEY_2]>0, [_TASK_WP.WP_KEY_2], [_TASK_WP.WP_KEY_1]) as [_WP.KEY]
Resident TASK_WP;
Drop Fields [_TASK_WP.WP_KEY_1],[_TASK_WP.WP_KEY_2];

left join(PROJECT)
Load 
	[_TASK_WP.PROJECT_KEY]													as [_PJT.KEY],
//	[_TASK_WP.REGION_COUNTRY_KEY]											as [_PJT.REGION_COUNTRY_KEY],
    date(max([TASK_WP.CRL Start Date]))										as [PJT.CRL Start Date],
    date(max([TASK_WP.CRL Finish Date]))									as [PJT.CRL Finish Date],
    date(min([TASK_WP.Design Review Meeting (Prior to Dosing) Date]))		as [PJT.Design Review Meeting (Prior to Dosing) Date],
    date(min([TASK_WP.Design Review Meeting (Prior to Manufacture) Date]))	as [PJT.Design Review Meeting (Prior to Manufacture) Date],
    date(min([TASK_WP.Design Review Meeting (Prior to Submission) Date]))	as [PJT.Design Review Meeting (Prior to Submission) Date]
Resident TASK_WP
Group by [_TASK_WP.PROJECT_KEY]//,[_TASK_WP.REGION_COUNTRY_KEY]
;
Drop Fields [TASK_WP.CRL Start Date], [TASK_WP.CRL Finish Date],
    [TASK_WP.Design Review Meeting (Prior to Dosing) Date],
    [TASK_WP.Design Review Meeting (Prior to Manufacture) Date],
    [TASK_WP.Design Review Meeting (Prior to Submission) Date]
;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab Country Milestone
COUNTRY_MILESTONE:
Load 
  MILESTONE_C_NAME
, MILESTONE_C_TYPE 
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_COUNTRY_MILESTONE.QVD](qvd);


left join (TASK_WP)
Load
MILESTONE_C_NAME as [TASK_WP.Activity Name],
MILESTONE_C_NAME as [TASK_WP.Country Activity Name],
MILESTONE_C_TYPE as [TASK_WP.Country Activity Type]
RESIDENT COUNTRY_MILESTONE;


///$tab For HiH
////////Launch
FOR_HIH_LAUNCH:
Load 
[_TASK_WP.PROJECT_KEY],
alt([TASK_WP.Actual Start],[TASK_WP.Planned Start]) as [HIH.LAUNCH_DATE],
[TASK_WP.Country Activity Type],
[TASK_WP.Country Activity Name]
Resident TASK_WP
where [TASK_WP.Country Activity Type]='Country Launch'
;

FOR_HIH_LAUNCH_MIN_DATE:
Load 
[_TASK_WP.PROJECT_KEY],
min([HIH.LAUNCH_DATE]) as [HIH.MIN_LAUNCH_DATE]
Resident FOR_HIH_LAUNCH
group by [_TASK_WP.PROJECT_KEY]
;


left join (FOR_HIH_LAUNCH)
Load
[_TASK_WP.PROJECT_KEY],
[HIH.MIN_LAUNCH_DATE]
Resident FOR_HIH_LAUNCH_MIN_DATE
;

FOR_HIH_LAUNCH_FINAL:
Load
[_TASK_WP.PROJECT_KEY],
[HIH.MIN_LAUNCH_DATE],
MinString([TASK_WP.Country Activity Type]) as [HIH.Country Launch Type],
MinString([TASK_WP.Country Activity Name]) as [HIH.Country Launch Name],
Replace(MinString([TASK_WP.Country Activity Name]), ' Launch', '') as [HIH.CNTR_LAUNCH_NAME_SHORT]
Resident FOR_HIH_LAUNCH
where [HIH.LAUNCH_DATE]=[HIH.MIN_LAUNCH_DATE]
group by
[_TASK_WP.PROJECT_KEY],
[HIH.MIN_LAUNCH_DATE]
;

drop Tables
FOR_HIH_LAUNCH,
FOR_HIH_LAUNCH_MIN_DATE
;


//////////submission
FOR_HIH_SUBMISSION:
Load 
[_TASK_WP.PROJECT_KEY],
alt([TASK_WP.Actual Start],[TASK_WP.Planned Start]) as [HIH.SUBMISSION_DATE],
[TASK_WP.Country Activity Type],
[TASK_WP.Country Activity Name]
Resident TASK_WP
where [TASK_WP.Country Activity Type]='Country Submission'
;

left join (FOR_HIH_SUBMISSION)
Load 
[_TASK_WP.PROJECT_KEY],
[HIH.CNTR_LAUNCH_NAME_SHORT]
Resident FOR_HIH_LAUNCH_FINAL
;

FOR_HIH_SUBMISSION_1:
Load 
[_TASK_WP.PROJECT_KEY],
[HIH.SUBMISSION_DATE],
[TASK_WP.Country Activity Type],
[TASK_WP.Country Activity Name]
Resident FOR_HIH_SUBMISSION
where [TASK_WP.Country Activity Name]=[HIH.CNTR_LAUNCH_NAME_SHORT]& ' Submission'
;

FOR_HIH_SUBMISSION_FINAL:
Load
[_TASK_WP.PROJECT_KEY],
min([HIH.SUBMISSION_DATE]) as [HIH.MIN_SUBMISSION_DATE],
MinString([TASK_WP.Country Activity Type]) as [HIH.Country Submission Type],
MinString([TASK_WP.Country Activity Name]) as [HIH.Country Submission Name]
Resident FOR_HIH_SUBMISSION_1
group by
[_TASK_WP.PROJECT_KEY]
;

drop Tables
FOR_HIH_SUBMISSION,
FOR_HIH_SUBMISSION_1
;

//////////Target Approval
FOR_HIH_APPROVAL:
Load 
[_TASK_WP.PROJECT_KEY],
alt([TASK_WP.Actual Start],[TASK_WP.Planned Start]) as [HIH.TARGET_APPROVAL_DATE],
[TASK_WP.Country Activity Type],
[TASK_WP.Country Activity Name]
Resident TASK_WP
where [TASK_WP.Country Activity Type]='Country Target Approval'
;

left join (FOR_HIH_APPROVAL)
Load 
[_TASK_WP.PROJECT_KEY],
[HIH.CNTR_LAUNCH_NAME_SHORT]
Resident FOR_HIH_LAUNCH_FINAL
;

FOR_HIH_APPROVAL_1:
Load 
[_TASK_WP.PROJECT_KEY],
[HIH.TARGET_APPROVAL_DATE],
[TASK_WP.Country Activity Type],
[TASK_WP.Country Activity Name]
Resident FOR_HIH_APPROVAL
where [TASK_WP.Country Activity Name]=[HIH.CNTR_LAUNCH_NAME_SHORT]& ' Target Approval'
;

FOR_HIH_APPROVAL_FINAL:
Load
[_TASK_WP.PROJECT_KEY],
min([HIH.TARGET_APPROVAL_DATE]) as [HIH.MIN_APPROVAL_DATE],
MinString([TASK_WP.Country Activity Type]) as [HIH.Country Target Approval Type],
MinString([TASK_WP.Country Activity Name]) as [HIH.Country Target Approval Name]
Resident FOR_HIH_APPROVAL_1
group by
[_TASK_WP.PROJECT_KEY]
;

drop Tables
FOR_HIH_APPROVAL,
FOR_HIH_APPROVAL_1
;




///$tab TASK_IND
LET vStartTime = now();

[TASK_IND]:
LOAD
	TASK_IND_KEY			as [_TASK_IND.KEY],
	INDICATION_KEY			as [_IND.KEY],
	PRODUCT_KEY				as [_TASK_IND.PRODUCT_KEY],
	REGION_COUNTRY_KEY		as [_TASK_IND.REGION_COUNTRY_KEY],
	ACTIVITY_NAME			as [TASK_IND.Activity Name],
	ACTIVITY_TYPE			as [TASK_IND.Activity Type],
	ACTUAL_FINISH			as [TASK_IND.Actual Finish],
	ACTUAL_START			as [TASK_IND.Actual Start],
	D_DRAFT_PTLD			as [TASK_IND.Draft PTLD],
	FIXED_START				as [TASK_IND.Fixed Start],
	IS_AN_INDICATION		as [TASK_IND.Is An Indication],
	NAME					as [TASK_IND.Name],
	NETWORK					as [TASK_IND.WBS Network],
	ONB						as [TASK_IND.Internal Number],
	PLANNED_FINISH			as [TASK_IND.Planned Finish],
	PLANNED_START			as [TASK_IND.Planned Start],
	PRODUCT					as [TASK_IND.Product]
//	FINISH_NO_LATER_THAN	as [TASK_IND.Finish No Later Than //RS 06-03-2019-Fields are always empty according to PLM team
//	START_NO_LATER_THAN		as [TASK_IND.Start No Later Than] //RS 06-03-2019-Fields are always empty according to PLM team
FROM [lib://PLM_QVD (tevail_iayalon)\DIM_TASK_OF_IND.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab MILESTONES
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Calculate all unique activity dates per project
//v1 - deprecated
/*
[PJT/MILESTONES]:
Load AutoNumberHash128([_TASK_WP.PROJECT_KEY],[TASK_WP.Activity Type],[TASK_WP.Activity A/P])	as [_PJT/MST.KEY]
	,[_TASK_WP.PROJECT_KEY]																as [_PROJECT_KEY]
    ,[TASK_WP.Activity Type]															as [PJT/MST.Type]
    ,[TASK_WP.Activity A/P]																as [PJT/MST.Activity Type]
    ,date(min([TASK_WP.Planned Start]))													as [PJT/MST.First Start Date]
    ,date(max([TASK_WP.Planned Start]))													as [PJT/MST.Last Start Date]
    ,date(min([TASK_WP.Planned Finish]))												as [PJT/MST.First Finish Date]
    ,date(max([TASK_WP.Planned Finish]))												as [PJT/MST.Last Finish Date]
Resident TASK_WP
Group By [_TASK_WP.PROJECT_KEY],[TASK_WP.Activity A/P],[TASK_WP.Activity Type];
*/
// v2 - ToDo: to replese v1 to v2 and drop v1
// *Milestone is Actual if 'Actual Date' is not null, otherwise - it is Planned
[MILESTONES]:
LOAD [_TASK_WP.PROJECT_KEY]				as [_PROJECT_KEY]
    ,[TASK_WP.Activity Type]			as [MLSTN.Name]
    ,date(min([TASK_WP.Planned Start]))	as [MLSTN.First Planned Date]
    ,date(min([TASK_WP.Actual Start]))	as [MLSTN.First Actual Date]
    ,date(max([TASK_WP.Planned Start]))	as [MLSTN.Last Planned Date]
    ,date(max([TASK_WP.Actual Start]))	as [MLSTN.Last Actual Date]
Resident TASK_WP
Group By [_TASK_WP.PROJECT_KEY],[TASK_WP.Activity Type];
///$tab RISK
[RISK]:
load 
if(MITIGATED=1,'YES','NO') as [RISK.Mitigated],
RISK_KEY	 as 	[_RISK.RISK_KEY],
//PROJECT_KEY	 as 	[RISK.PROJECT_KEY],
PROJECT_KEY as      [_PROJECT_KEY],
CREATION_DATE	 as 	[RISK.Creation date],
ACTIVITY	 as 	[RISK.Activity],
PLM_ONB	 as 	[_RISK.PLM_ONB],
PLM_ONB	 as 	[RISK.Risk Unique number],
PROJECT	 as 	[_RISK.PROJECT],
if (DISPLAY_IN_REPORT=1, 'YES','NO')	 as 	[RISK.Display in reports],
OCCURENCE_PROBA	 as 	[RISK.Occurance probability],
RISK_NAME	 as 	[RISK.Risk Name],
RISK_TYPE	 as 	[RISK.Risk type],
MITIGATION	 as 	[RISK.Mitigation],
IMPACT	 as 	[RISK.Impact],
AUTHOR	 as 	[RISK.Author],
DESCRIPTION	 as 	[RISK.Description],
RISK_HIGH_COMMENTS as [RISK.Risk Comments],
PROBABILITY_SP	as [Risk.Probability-SP],
IMPACT_SP as [Risk.Impact-SP],
SCORE as [Risk.Overall Score]	,
OWNER as [Risk.Owner]	,
//Clarified the correct naming with Devendra
EXTENDED_DESCRIPTION as [Risk.Risk Event]	,
COMMENTS             as [Risk.Comments],
CONTINGENCY              as [Risk.Contingency],
RISK_OPEN_CLOSED         as [Risk.Risk Open\Closed],
RISK_CLOSED_DATE         as [Risk.Risk Closed Date]	,
RISK_REALIZED	         as [Risk.Risk Realized?],
//IMPACT_GX as [Risk.Impact-GX],
OVERALL_SCORE_GX         as [Risk.Overall Score - GX],
IMPACT_GX_AS_A_NUMBER    as [Risk.Impact-GX],
RISK_RESULTS             as [Risk.Risk Result]	,
RISK_DESCRIPTION         as [Risk.Risk Description],
MITIGATION_PLAN          as [Risk.Mitigation Plan],
IMPACT_GX_FOR_CHART      as [_Risk.IMPACT_GX_FOR_CHART],
PROBABILITY_SP_FOR_CHART as [_Risk.PROBABILITY_SP_FOR_CHART],
IMPACT_SP_FOR_CHART      as [_Risk.IMPACT_SP_FOR_CHART],
ONE_SLIDER_GX            as [Risk.Display in One Slider GX],
DISPLAY_IN_DASHBOARD     as [Risk.Display in dashboard], 
date(TARGET_DATE)        as [Risk.Target Date],
RISK_AFFECT              as [Risk.Risk Affect]



FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_RISK.QVD](qvd);


///$tab Action Items
[ACTION ITEMS]:
Load

ACTION_ITEMS_KEY	 as	[_ACT_IT.ACTION_ITEMS_KEY],
PROJECT_KEY	 as	[_ACT_IT.PROJECT_KEY],
PROJECT_KEY		as  [_PROJECT_KEY],
ONB	 as	[_ACT_IT.ONB],
PROJECT	 as	[_ACT_IT.Project],
if(DISPLAY=1,'YES','NO')	 as	[ACT_IT.Display in reports],
ACCOUNTABLE	 as	[ACT_IT.Accountable],
AUTHOR	 as	[ACT_IT.Author],
date(date#(CREATION_DATE, 'DD-MMM-YYYY')) as	[ACT_IT.Creation Date],
CRITICAL_TASK_DECISION	 as	[ACT_IT.Critical task and decision],
RISK	 as	[ACT_IT.Risk],
if(RISK_IS_MITIGATED,'YES','NO')	 as	[ACT_IT.Risk is mitigated?],
COMMENTS	 as	[ACT_IT.Comments],
STATUS	 as	[ACT_IT.Status],
Date(COMPLETE_DATE)	 as	[ACT_IT.Complete Date],
OWNER	 as	[ACT_IT.Owner],
DUE	 as	[ACT_IT.Due],
RISK_NAME	 as	[ACT_IT.Risk Name]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_ACTION_ITEMS.QVD](qvd);

///$tab Trail Activity &WP Deleting
[Trail Act&WP deletion]:

LOAD
    ITEM as [AWPD.Item],
    ONB as [AWPD.ONB],
    PROJECT as [AWPD.Project Code],
    PROJECT_KEY as      [_PROJECT_KEY],
    ACTIVITY_NAME as [AWPD.Activity\WP Name],
    ACTIVITY_TYPE as [AWPD.Activity\WP Type] ,
    NETWORK as [AWPD.Network] ,
    IDENTIFIER_OBJ,
    PROTOCOL_NUMBER as [AWPD.Protocol Number] ,

    Date(DELETE_DATE) as [AWPD.deleted date]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_ACT_WP_TRAIL_DEL.QVD]
(qvd);





///$tab Batch MNF Gantt
[RD Batch MNF Gantt]:
Load
PROJECT		        as	[_RD Batch Mnf.PROJECT],
PROJECT_KEY		    as  [_PROJECT_KEY],
ACT_NAME		    as	[RD Batch Mnf.Activity name],
ABBRIVIATION		as	[RD Batch Mnf.Abbriviation],
ML_TASK		        as	[RD Batch Mnf.Milestone or Task],
PLANNED_START		as	[RD Batch Mnf.Planned start date],
PLANNED_FINISH		as	[RD Batch Mnf.Planned finish date],
DURATION            as	[RD Batch Mnf.Duration],
DS_MFG_SITE         as	[RD Batch Mnf.DS Mfg Site],
DS_BATCH_SCALE      as	[RD Batch Mnf.DS Batch Scale],
COLOR               as  [_RD Batch Mnf.Task color],
SYMBOL              as  [_RD Batch Mnf.Milestone Symbol],
SYMBOL_COLOR        as  [_RD Batch Mnf.Milestone Symbol Color],
EVENT_TYPE          as	[RD Batch Mnf.Event type], 
if(PLANNED_START>=today(),'Yes','No') as [RD Batch Mnf.Future]

FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\DIM_PLM_RD_SPECIALTY_BATCH_MNF.QVD](qvd);
///$tab API TCJ
[API TCJ]:
LOAD
PRODUCT_KEY     	                AS [_PDT.KEY],
 
    PRODUCT as [API TCJ.Product],
    date(TCJ_DATE) as [API TCJ.Date],
    TCJ_STATUS as [API TCJ.TCJ Status],
    TCJ_REGION as [API TCJ.TCJ Region]

FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_API_TCJ.QVD]
(qvd);


///$tab API NPC
[API NPC]:
LOAD
PRODUCT_KEY			        As	[_PDT.KEY],
GLOBAL_PRODUCT_CODE			As	[NPC.Global Product Code],
API			                As	[NPC.Api],
date(MEETING_DATE)			As	[NPC.Meeting Date],
DECISION_TYPE			    As	[NPC.Decision Type],
DECISION			        As	[NPC.Decision],
PORTFOLIO_SCORE			    As	[NPC.Portfolio Score],
RND_SCORE		            As	[NPC.Rnd Score],
"PEAK_SALES_M$"			    As	[NPC."Peak Sales M$"],
PHARMA_RISK			        As	[NPC.Pharma Risk],
API_COMPLEXITY		     	As	[NPC.Api Complexity],
date (WATCH_DATE)       	As	[NPC.Watch Date],
DECISION_COMMENTS			As	[NPC.Decision Comments],
INNOVATOR_DISCONTINUED		As	[NPC.Innovator Discontinued],
TABLE_SOURCE			    As	[_NPC.Table Source]

FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_PLM_TEVA_API_NPC.QVD]
(qvd);


///$tab Lesson Learned
[Lesson Learned]:
Load


PROJECT		        as		[_LL.Project],
CREATION_DATE		as		[LL.Creation date],
AUTHOR		        as		[LL.Author],
ISSUE_IMPACT		as		[LL.Impact],
FOCUS_AREA		    as		[LL.Focus Area],
SUCCESSES		    as		[LL.Successes],
SHORTCOMINGS		as		[LL.Shortcommings],
RECOMMENDATIONS		as		[LL.Post Project Recommendations],
PROJECT_KEY		    as		[_PROJECT_KEY]




FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_PLM_Lesson_Learned.QVD]


(qvd);







///$tab Members
[Team Members]:
Load


PROJECT	 as [MEMB.Project],
PROJECT	 as [PJT.Project Code],
ROLE	 as [MEMB.Role],
MEMBER	 as [MEMB.Team Member],
COMMENTS	 as [MEMB.Comments],
PARENTTEAM	 as [MEMB.Parent Team]


FROM [lib://PLM (tevacorp_admqlik)/1.Extract/QVD/DIM_PLM_MEMBERS.QVD]


(qvd);
///$tab FACT_REG_PDT
LET vStartTime = now();

[FACT_REG_PDT]:
LOAD 
PRODUCT_KEY&'-'&REGION_COUNTRY_KEY   			AS [_REG_PDT.KEY],
PRODUCT_KEY&'-'&COUNTRY_REG_FOR_REP				AS [_REG_PDT.MISTAKE.KEY],
PRODUCT_KEY										AS [_Reg_PDT.PRODUCT_KEY],
REGION_COUNTRY_KEY 							    AS [_Reg_PDT.REGION_COUNTRY_KEY],
ORGANIZATION_KEY								AS [_Reg_PDT.ORGANIZATION_KEY],
BRAND_NCE_DATE                                  AS [Reg_PDT.Brand NCE-1 Date (US)],
//BRAND_NCE_DATE_KEY                            AS [Reg_PDT.brand_nce_date_key]
CNTRY_PRD_WATCH_EXPIRY_DAT                      AS [Reg_PDT.cntry_prd_watch_expiry_dat],
//CNTRY_PRD_WATCH_EXPIRY_DAT_KEY                AS [Reg_PDT.cntry_prd_watch_expiry_dat_key]
STRENGTH_WATCH_EXPIRY_DAT                       AS [Reg_PDT.strength_watch_expiry_dat],
//STRENGTH_WATCH_EXPIRY_DAT_KEY					AS [Reg_PDT.strength_watch_expiry_dat_key]
//ORIG_PDT_STATUS_DATE							AS [Reg_PDT.ORIG_PDT_STATUS_DATE], //V1, 07/06/2018, LMIZRAHITO - added field; 
																				//09/13/2018, RSYSIUK - commented due to Talyas email from 09/06/2018;
// ORIG_PDT_STATUS_DATE_KEY						AS [_Reg_PDT.ORIG_PDT_STATUS_DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
PDT_STATUS_DATE                                 AS [Reg_PDT.Date of last product status change],
//PDT_STATUS_DATE_KEY                           AS [Reg_PDT.pdt_status_date_key]
//PRODUCT                                       AS [Reg_PDT.Global product ID],VF: removed on12/4/18- To be inherited in reports from global product level
COUNTRY_REG_FOR_REP                             AS [Reg_PDT.Region/Country for BI],//showing country only in case og GM Region 
REGION_COUNTRY                                  AS [Reg_PDT.Region/country],
BRAND_OVERVIEW                                  AS [Reg_PDT.Brand overview],
//ORIG_BUSINESS									AS [Reg_PDT.ORIG_BUSINESS], //V1, 07/06/2018, LMIZRAHITO - added field
BUSINESS                                        AS [Reg_PDT.BU (EU only)],
//PROJ_LEVEL_BUSINESS                             AS [Reg_PDT.BU PRJ. Level],
DESCRIPTION                                     AS [Reg_PDT.Description],
//ORIG_FILL_VOLUMES_AND_UOM                       AS [Reg_PDT.ORIG_FILL_VOLUMES_AND_UOM], //V1, 07/06/2018, LMIZRAHITO - added field
FILL_VOLUMES_AND_UOM                            AS [Reg_PDT.Fill volumes + UOM],
INNOVATOR_BRAND_NAME                            AS [Reg_PDT.Innovator brand name],
INNOVATOR_COMPANY                               AS [Reg_PDT.Innovator Company],
INNOVATOR_PARTNERS                              AS [Reg_PDT.Innovator partners],
IS_NCE_EXCLUSIVITY                              AS [Reg_PDT.NCE Exclusivity?],
LICENSE                                         AS [Reg_PDT.License],
// ORIG_MAJOR_ATC4									AS [Reg_PDT.ORIG_MAJOR_ATC4], //V1, 07/06/2018, LMIZRAHITO - added field
MAJOR_ATC4                                      AS [Reg_PDT.Major ATC4],
NON_NCE_NME                                     AS [Reg_PDT.Non-NCE/NME],
PLM_ONB                                         AS [Reg_PDT.plm_onb],
PDT_REGIONAL_STRATEGY_COMMENTS                  AS [Reg_PDT.Product Regional Strategy comments],
REGIONAL_PDT_CHARACTERISTICS                    AS [Reg_PDT.Regional Product Characteristics],
//ORIG_SALES_CHANNEL								AS [Reg_PDT.ORIG_SALES_CHANNEL], //V1, 07/06/2018, LMIZRAHITO - added field
SALES_CHANNEL                                   AS [Reg_PDT.Sales channel],
//ORIG_STATUS                                   AS [Reg_PDT.Orig. Strength Status],--VF: See if required in any report and reply to Talya
STATUS                                          AS [Reg_PDT.Strength status],
//ORIG_STRENGTHS_AND_UOM                          AS [Reg_PDT.ORIG_STRENGTHS_AND_UOM], //V1, 07/06/2018, LMIZRAHITO - added field
STRENGTHS_AND_UOM                               AS [Reg_PDT.Strengths + UOM],
STRENGTH                                        AS [Reg_PDT.Strength],
//NAME                                          	AS [Reg_PDT.Name],
//GAIN                                          AS [Reg_PDT.Global Product| GAIN], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//UNIT                                          AS [Reg_PDT.Global Product| UOM], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//DOSAGE                                        AS [Reg_PDT.Global Product| Form],
//GLOBAL_DOSAGE                                 AS [Reg_PDT.Dosage form],--To replace in reports with pdt.dosage form
//DOSE_REMAIN                                   AS [Reg_PDT.Dose Regimen],
//PRODUCT_INNOVATOR_CODE                        AS [Reg_PDT.Innovator Code],
//RATIONALE                                     AS [Reg_PDT.Rationale],
PLM_PRD_STR_ID                                  AS [_Reg_PDT.IMS key (impex)],
PRODUCT_LABEL                                   AS [Reg_PDT.Product Name],
PRODUCT_PARENT                                  AS [Reg_PDT.Product-Country],
REGION_COUNTRY_STRENGTH_FV                      AS [Reg_PDT.Region/Country - Strength - FV],
//IS_A_FILL_VOLUME                              AS [Reg_PDT.Fill volume?],
LMD_DATE										AS [Reg_PDT.IP Latest Date], //V1, 07/06/2018, LMIZRAHITO - added field //19/06/2018 - remarked 26/06/2018
PLMD_DATE										AS [Reg_PDT.IP Earliest Date], //V1, 07/06/2018, LMIZRAHITO - added field //26/07/2018 
//renamed on Talya req 01122021
PLMD_EARLY										AS [Reg_PDT.IP Earliest - early],
PLFD_EARLY										AS [Reg_PDT.PLFD Early],
//SALES_IN_KUSD                                 AS [Reg_PDT.Sales in k$], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//if(isnull([SALES_IN_KEUR])=0,SALES_IN_KEUR,0) AS [Reg_PDT.Sales in k€], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//COUNTING_UNITS                                AS [Reg_PDT.Counting units], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//KG											AS [Reg_PDT.kg], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//SU                                          	AS [Reg_PDT.SU], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
IMS_MAT_DATE                                    AS [Reg_PDT.IMS_MAT_DATE],
// IMS_MAT_DATE_KEY                             AS [Reg_PDT.IMS_MAT_DATE_KEY],//V1, 07/06/2018, LMIZRAHITO - added field, commented
IMS_PMAT_DATE                                   AS [Reg_PDT.IMS_PMAT_DATE],
// IMS_PMAT_DATE_KEY                            AS [Reg_PDT.IMS_PMAT_DATE_KEY],//V1, 07/06/2018, LMIZRAHITO - added field, commented
IMS_SALES_K_USD                                 AS [Reg_PDT.IMS_SALES_K_USD],
IMS_SALES_K_EUR                                 AS [Reg_PDT.IMS_SALES_K_EUR],
IMS_EXT_UNITS                                   AS [Reg_PDT.IMS_EXT_UNITS],
IMS_EACHES                                      AS [Reg_PDT.IMS_EACHES],
IMS_UNITS                                       AS [Reg_PDT.IMS_UNITS],
IMS_PREV_SALES_K_USD                            AS [Reg_PDT.IMS_PREV_SALES_K_USD],
IMS_SALES_K_LC                                  AS [Reg_PDT.IMS_SALES_K_LC],
IMS_CU                                          AS [Reg_PDT.IMS_CU],
IMS_PREV_CU                                     AS [Reg_PDT.IMS_PREV_CU],
IMS_SU                                          AS [Reg_PDT.IMS_SU],
IMS_PREV_UNITS                                  AS [Reg_PDT.IMS_PREV_UNITS],
IMS_PREV_EACHES                                 AS [Reg_PDT.IMS_PREV_EACHES],
IMS_PMAT_EXT_UNITS								AS [Reg_PDT.IMS_PMAT_EXT_UNITS],//V1, 07/06/2018, LMIZRAHITO - added field //25/06/2018
IMS_KG											AS [Reg_PDT.IMS kg], //V1, 07/06/2018, LMIZRAHITO - added field //17/06/2018
//PERC_CHANGE_COUNTING_UNITS                    AS [Reg_PDT.% change counting units], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//PERC_CHANGE_SALES                             AS [Reg_PDT.% change Sales], //V1, 07/06/2018, LMIZRAHITO - removed 24/06/2018
//ORIG_MOST_PROGRESS                              AS [Reg_PDT.ORIG_MOST_PROGRESS], //V1, 07/06/2018, LMIZRAHITO - added field
MOST_PROGRESS                                   AS [Reg_PDT.Most advanced project progress],
//ORIG_LEAST_PROGRESS                             AS [Reg_PDT.ORIG_LEAST_PROGRESS], //V1, 07/06/2018, LMIZRAHITO - added field
LEAST_PROGRESS                                  AS [Reg_PDT.Least advanced project progress],
//ORIG_REG_PDT_ACT_DEV_SITE                       AS [Reg_PDT.ORIG_REG_PDT_ACT_DEV_SITE], //V1, 07/06/2018, LMIZRAHITO - added field
REG_PDT_ACT_DEV_SITE                            AS [Reg_PDT.Active Dev. site],                              
//ORIG_ACTIVE_PJT_MFG_SITES                       AS [Reg_PDT.ORIG_ACTIVE_PJT_MFG_SITES],
ACTIVE_PJT_MFG_SITES                            AS [Reg_PDT.Active Mfg Sites (with duplication)],
S_TRACE_PDT_STATUS_INFO_PAD                     AS [Reg_PDT.Comment of last regional/ country product status change],
TRACE_IND_COMMENTS								AS [REG_PDT.Last Progress Comment],
TRACE_IND_CREATION_D							AS [REG_PDT.Last progress date],
SELECTION_METHOD                                AS [Reg_PDT.Selection Method],
S_TENDER                                        AS [Reg_PDT.Tender],
S_PRICING_REGULATION                            AS [Reg_PDT.Pricing Regulation],
S_GM_THERAPEUTIC_AREA                           AS [Reg_PDT.GM Therapeutic Area],
ORPHAN_STATUS									AS [REG_PDT.Orphan Status],

If(wildmatch(S_GM_THERAPEUTIC_AREA,'respi*'), 'Respiratory',
	If(wildmatch(S_GM_THERAPEUTIC_AREA,'onco*'), 'Onco',
    	If(wildmatch(S_GM_THERAPEUTIC_AREA,'CNS*'), 'CNS',
        	If(wildmatch(S_GM_THERAPEUTIC_AREA,'CVM*'), 'CVM',
            	If(wildmatch(S_GM_THERAPEUTIC_AREA,'FMH*'), 'FMH',
                	If(wildmatch(S_GM_THERAPEUTIC_AREA,'GI*'), 'Gastrointestinal',
                    	If(wildmatch(S_GM_THERAPEUTIC_AREA,'topical*'), 'Dermatology',
                        	If(wildmatch(S_GM_THERAPEUTIC_AREA,'AI*'), 'Anti-infective',
                            	If(wildmatch(S_GM_THERAPEUTIC_AREA,'other*'), 'Other',
                                	If(IsNull(S_GM_THERAPEUTIC_AREA), 'TBD', S_GM_THERAPEUTIC_AREA
   ))))))))))									AS [Reg_PDT.GM Regional Therapeutic Area],
GM_REVISED_THERAPEUTIC_AREA						AS [Reg_PDT.GM Revised Therapeutic Area],
SELECTION_SUB_METHOD							AS [Reg_PDT.Selection Sub Method],
LEGAL_PLMD_DATE									AS [Reg_PDT.Legal IP Earliest Date], // RS 2018-12-06
LEGAL_PLMD_DESCRIPTION							AS [Reg_PDT.Legal IP Earliest comments], // RS 2018-12-06
MISSING_PLMD_NO_VLS								AS [REG_PDT.Missing IP Earliest (No value)], // RS 2018-12-06
MISSING_PLMD_UPLD_TBL_VL						AS [REG_PDT.Missing IP Earliest (Upload table value)], // RS 2018-12-06
MISALIGNED_PLMD_NO_TBL_VL						AS [REG_PDT.Misaligned IP Earliest (PLM value/No table value)], // RS 2018-12-06
IF(Date#(PLMD_DATE,'DD-MMM-YY')<TODAY(),0,
	MISALIGNED_PLMD_UPLD_TBL_VL)				AS [REG_PDT.Misaligned IP Earliest (Upload table value)], // RS 2018-12-06
//below added 2018-May-14 M.Jacobs
/* 2019-03-14 RSYSIUK change calculation logic - not missing if there is at least one value per PDT-REG4BI
REVIEW_AFP_FLAG									AS [Reg_PDT.Review AFP Status Flag],
MISSING_PRODUCT_STATUS_FLAG							AS [Reg_PDT.Missing Product Status Flag],
MISSING_EXPIRED_WE_FLAG							AS [Reg_PDT.Missing/Expired Watch Expiry Date Flag],
MISSING_NON_NCE_NME_FLAG						AS [Reg_PDT.Missing Non-NCE/NME Flag],
//above added 2018-May 14 M.Jacobs
//ADDED LMIZRAHITO 17/06/2018
//MISSING_MAIN_INDICATION_US					AS [Reg_PDT.MISSING_MAIN_INDICATION_US], //V1, 07/06/2018, LMIZRAHITO - added field
//MISSING_MAIN_INDICATION_EU					AS [Reg_PDT.MISSING_MAIN_INDICATION_EU], //V1, 07/06/2018, LMIZRAHITO - added field
MISSING_BU_EU_ONLY				 				AS [REG_PDT.Missing BU (EU Only) Flag], // RS 2019-02-15
MISSING_INNOVATOR_COMPANY 						AS [REG_PDT.Missing Innovator Company Flag], // RS 2019-02-15
MISSING_INNOVATOR_BRAND_NAME					AS [REG_PDT.Missing Innovator Brand Name Flag] // RS 2019-02-15
*/
REVIEW_AFP_FLAG,
MISSING_PRODUCT_STATUS_FLAG,
MISSING_EXPIRED_WE_FLAG,
MISSING_NON_NCE_NME_FLAG,
MISSING_BU_EU_ONLY,
MISSING_INNOVATOR_COMPANY,
MISSING_INNOVATOR_BRAND_NAME,
MISSING_MAIN_INDICATION_FLAG            

,ApplyMap('MapReg_PDT_Strength_Status',STATUS,1) as [Reg_PDT.SS_FLAG]
//17012022 Olga added legal fields on Reg product level
, PLMD_ASAP as [REG_PDT.IP Earliest ASAP]
,PLMD_DESC as [REG_PDT.IP Earliest comments]
,LMD_DESC as [REG_PDT.IP Latest comments]


FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\FACT_PLM_REG_PDT.QVD](qvd);

Left Join([FACT_REG_PDT])
Load Distinct
	[_PJT.PRODUCT_KEY]									AS [_Reg_PDT.PRODUCT_KEY],
//	[_PJT.REGION_COUNTRY_KEY]							AS [_Reg_PDT.REGION_COUNTRY_KEY],
    Max(ApplyMap('MapReg_PJT_Status',[PJT.Status],1))	AS [_Reg_PDT.NOT_MISSING_FLAG]
Resident [PROJECT]
Group By [_PJT.PRODUCT_KEY]//,[_PJT.REGION_COUNTRY_KEY]
;

REG_PDT_MISTAKES:
Load [_REG_PDT.MISTAKE.KEY],
min(REVIEW_AFP_FLAG)				AS [REG_PDT.Review AFP Status],
min(MISSING_PRODUCT_STATUS_FLAG)	AS [REG_PDT.Missing Product Status],
min(MISSING_EXPIRED_WE_FLAG)		AS [REG_PDT.Missing/Expired Watch Expiry Date],
min(MISSING_NON_NCE_NME_FLAG)		AS [REG_PDT.Missing Non-NCE/NME],
min(MISSING_BU_EU_ONLY)				AS [REG_PDT.Missing BU (EU Only)],
min(MISSING_INNOVATOR_COMPANY)		AS [REG_PDT.Missing Innovator Company],
min(MISSING_INNOVATOR_BRAND_NAME)	AS [REG_PDT.Missing Innovator Brand Name],
min(MISSING_MAIN_INDICATION_FLAG)	AS [REG_PDT.Missing Main Indication]
Resident [FACT_REG_PDT]
Where Alt([_Reg_PDT.NOT_MISSING_FLAG],1) = 1
And [Reg_PDT.SS_FLAG] = 1
Group By [_REG_PDT.MISTAKE.KEY]
;

DROP Fields
REVIEW_AFP_FLAG,
MISSING_PRODUCT_STATUS_FLAG,
MISSING_EXPIRED_WE_FLAG,
MISSING_NON_NCE_NME_FLAG,
MISSING_BU_EU_ONLY,
MISSING_INNOVATOR_COMPANY,
MISSING_INNOVATOR_BRAND_NAME,
MISSING_MAIN_INDICATION_FLAG,
[_Reg_PDT.NOT_MISSING_FLAG],
[Reg_PDT.SS_FLAG]
;

Left Join(PRODUCT)	// 2018-11-05	RSYSIUK	General Reports - Product Screening Report
Load Distinct 
[_Reg_PDT.PRODUCT_KEY] as [_PDT.KEY], 
[Reg_PDT.Non-NCE/NME] as [PDT.Non-NCE/NME US]
Resident FACT_REG_PDT
Where [Reg_PDT.Region/Country for BI]='US'
And Len([Reg_PDT.Non-NCE/NME]) > 0
;

Left Join(PRODUCT)	// 2018-11-05	RSYSIUK	General Reports - Product Screening Report
Load Distinct [_Reg_PDT.PRODUCT_KEY] as [_PDT.KEY], [Reg_PDT.Non-NCE/NME] as [PDT.Non-NCE/NME EU]
Resident FACT_REG_PDT
Where [Reg_PDT.Region/Country for BI]='Europe'
And Len([Reg_PDT.Non-NCE/NME]) > 0
;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab FACT_LBE
LET vStartTime = now();

FACT_LBE:
LOAD
LBE_MBI_KEY						AS [_LBE_MBI.KEY],  //V1, 07/06/2018, LMIZRAHITO - added key field // V2 - 2019-02-06 - replace calculation to view //t."PRODUCT_KEY" || '_' || t."ORGANIZATION_KEY"
SKU_KEY							AS [_LBE.SKU.KEY],
//BUSINESS_LINE_KEY				AS [LBE.BUSINESS_LINE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
ORGANIZATION_KEY 				AS [_LBE.ORGANIZATION_KEY],
//CURRENCY_KEY					AS [LBE.CURRENCY_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
BUSINESS_LINE_GARP_DESC 		AS [LBE.BUSINESS_LINE_GARP_DESC],
CURRENCY_CODE 					AS [LBE.Currency Code],
CURRENCY_NAME 					AS [LBE.Currency Name],
DATEVAL							AS [LBE.LBE Date],
//DATE_KEY						AS [_LBE.DATE_KEY], //V1, 07/06/2018, LMIZRAHITO - added field, commented
month(DATEVAL)					AS [LBE.LBE Month],
year(DATEVAL)					AS [LBE.LBE Year],
GROUPED_MARKET_DESC				AS [LBE.Grouped MArket Desc],
QUANTITY                        AS [LBE.Quantity],
NET_SALES_REPORTING_USD 		AS [LBE.Net Sales Reporting USD],
NET_SALES_REPORTING_LC			AS [LBE.Net Sales Reporting],
COGS_REPORTING_USD				AS [LBE.COGS Reporting USD],
COGS_REPORTING_LC				AS [LBE.COGS Reporting LC],
GROSS_PROFIT_LBE_LC				AS [LBE.Gross Profit LBE LC],
GROSS_PROFIT_LBE_USD			AS [LBE.Gross Profit LBE USD],
LBE_AOP_NFX_CY					AS [LBE.LBE AOP NFX CY],
LBE_ACT_NFX_PY					AS [LBE.LBE ACT NFX PY]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\FACT_LBE.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab FACT_MBI_MEASURES
LET vStartTime = now();

FACT_MBI_MEASURES:
LOAD
LBE_MBI_KEY				AS [_LBE_MBI.KEY],  //V1, 07/06/2018, LMIZRAHITO - added key field //pr.product_key || '_' || org.organization_key
ORGANIZATION_KEY 		AS [_MBI.ORGANIZATION_KEY],
SKU_KEY					AS [_MBI.SKU.KEY],
ITEM_CODE				AS [FIN.ITEM_CODE], //V1, 07/06/2018, LMIZRAHITO - added field
TIME_KEY 				AS [FIN.Sales Date],
PRODUCT_CK				AS [FIN.PRODUCT_CK], //V1, 07/06/2018, LMIZRAHITO - added field
QUANTITY_SALES_A 		AS [FIN.Qty.(Actual)],
NET_SALES_CALC_USD_A 	AS [FIN.Net Sales USD (Actual)],
NET_SALES_CALC_EUR_A 	AS [FIN.Net Sales EUR (Actual)],
NET_SALES_USD_FX_LQ_A 	AS [FIN.Net Sales FX LQ (Actual)],
NET_SALES_USD_FX_PQ_A 	AS [FIN.Net Sales FX PQ (Actual)],
COGS_USD_A 				AS [FIN.COGS USD (Actual)],
COGS_EUR_A 				AS [FIN.COGS EUR (Actual)],
QUANTITY_SALES_F 		AS [FIN.Qty.(Forecast)],
NET_SALES_CALC_USD_F 	AS [FIN.Net Sales USD (WP)],
NET_SALES_CALC_EUR_F 	AS [FIN.Net Sales EUR (WP)],
NET_SALES_USD_FX_LQ_F 	AS [FIN.Net Sales FX LQ USD (WP)],
NET_SALES_USD_FX_PQ_F 	AS [FIN.Net Sales FX PQ USD (WP)],
COGS_USD_F 				AS [FIN.COGS USD (WP)],
COGS_EUR_F 				AS [FIN.COGS EUR (WP)]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\FACT_MBI_MEASURES.QVD](qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab FACT_GM_TARGET
LET vStartTime = now();

FACT_GM_PROJECT_TARGET:
LOAD		
K_PROJECT 			     	AS [_PROJECT_KEY],
YEAR_AOP_LBE			     	AS [Target.Year AOP LBE],
SUBMISSIONS_AOP 		     	AS [Target.Submission AOP],
SUBMISSIONS_LBE 		     	AS [Target.Submission LBE],
SUBMISSION_AOP_DATE 	     	AS [Target.Submission AOP Date],
SUBMISSION_AOP_POS		     	AS [Target.Submission AOP POS],
num(SUBMISSION_AOP_POS_CALC) 	AS [Target.Submission AOP POS CALC],
SUBMISSION_LBE_POS		     	AS [Target.Submission LBE POS],
num(SUBMISSION_LBE_POS_CALC) 	AS [Target.Submission LBE POS CALC],
LAUNCHES_AOP			     	AS [Target.Launches AOP],
LAUNCHES_LBE   			     	AS [Target.Launches LBE],
LAUNCH_AOP_DATE			     	AS [Target.Launch AOP Date],
num(month(Floor(LAUNCH_AOP_DATE)) ,'#,##0') 
								AS [Target.Launch AOP MonthNum],
PEAK_SALES                   	AS [Target.Peak Sales],
SUBM_AOP_COMMITMENT_PEAK_SALES 	AS [Target.Submission AOP Commitment Peak Sales]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\FACT_PLM_GM_PRJ_TARGET.QVD]
(qvd);


FACT_GM_LBE_COMMITMENT_temp1:
Load [_PJT.KEY] as [_PROJECT_KEY],
    Year([PJT.1st Submission Date]) AS  [LBE.Year],
    1 AS  [LBE.Projects Count temp]
    Resident PROJECT
    Where [PJT.SUBMISSIONS_ACTUALS_FLAG] = 1;
Outer Join 
Load [_PROJECT_KEY],
    [Target.Year AOP LBE] AS  [LBE.Year],
    [Target.Submission LBE POS CALC] AS  [LBE.Submission LBE POS CAL temp],
    [Target.Peak Sales] AS  [LBE.Peak Sales]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission LBE]='Y';

FACT_GM_LBE_COMMITMENT_temp2:
NoConcatenate
Load distinct [_PROJECT_KEY],
	 [LBE.Year],
     [LBE.Peak Sales],
     If(Isnull([LBE.Projects Count temp]),0,[LBE.Projects Count temp]) AS  [LBE.Projects Count temp],
     If(Isnull([LBE.Submission LBE POS CAL temp]),0,[LBE.Submission LBE POS CAL temp]) AS  [LBE.Submission LBE POS CAL temp]
Resident FACT_GM_LBE_COMMITMENT_temp1;

Drop Table FACT_GM_LBE_COMMITMENT_temp1;

FACT_GM_LBE_COMMITMENT:
NoConcatenate
Load distinct [_PROJECT_KEY],
	 [LBE.Year],
     If(Num([LBE.Projects Count temp]) > Num([LBE.Submission LBE POS CAL temp]),
     	Num([LBE.Projects Count temp]), Num([LBE.Submission LBE POS CAL temp])) AS  [LBE.Commitment Count],
	If(Num([LBE.Projects Count temp]) > Num([LBE.Submission LBE POS CAL temp]),
     	Num([LBE.Projects Count temp])*[LBE.Peak Sales], Num([LBE.Submission LBE POS CAL temp])*[LBE.Peak Sales]) AS  [LBE.Commitment Peak Sales]
Resident FACT_GM_LBE_COMMITMENT_temp2;

Drop Table FACT_GM_LBE_COMMITMENT_temp2;
Drop field [Target.Peak Sales] from FACT_GM_PROJECT_TARGET;

FACT_GM_CNTRY_TARGET:
LOAD
    COUNTRY_KEY 					AS [_REGION_COUNTRY_KEY],
    "YEAR" 							AS [Target.YEAR],
    SELECTION_MIN_AOP_TARGET		AS [Target.Selection Min AOP Target],
    SELECTION_MAX_AOP_TARGET    	AS [Target.Selection Max AOP Target],
    SELECTION_MIN_AOP_BGX_TGT       AS [Target.Selection Min AOP BGx Target],
    SELECTION_MAX_AOP_BGX_TGT       AS [Target.Selection Max AOP BGx Target],
    SELECTION_MIN_AOP_NON_BGX_TGT   AS [Target.Selection Min AOP Non BGx Target],
    SELECTION_MAX_AOP_NON_BGX_TGT   AS [Target.Selection Max AOP Non BGx Target],
    SELECTION_MIN_NTE_AOP_TARGET	AS [Target.Selection Min NTE AOP Target],
    SELECTION_MAX_NTE_AOP_TARGET    AS [Target.Selection Max NTE AOP Target],
    SELECTION_MIN_LBE_AOP_TARGET	AS [Target.Selection Min LBE AOP Target],
    SELECTION_MAX_LBE_AOP_TARGET	AS [Target.Selection Max LBE AOP Target],
    SELECT_MIN_NTE_LBE_AOP_TARGET   AS [Target.Select Min NTE LBE AOP Target],
    SELECT_MAX_NTE_LBE_AOP_TARGET   AS [Target.Select Max NTE LBE AOP Target]
FROM [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\FACT_PLM_GM_CNTRY_TARGET.QVD]
(qvd);

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab TARGET_CALENDAR_SUBMISSION_AOP 
LET vStartTime = now();

Temp:  
Load  
               min([Target.Submission AOP Date]) as minDate,
               max([Target.Submission AOP Date]) as maxDate
               //floor(Now()) as maxDate  
Resident FACT_GM_PROJECT_TARGET;  
  
Let varMinDate = Alt(Num(Peek('minDate', 0, 'Temp')), 0);  
Let varMaxDate = Alt(Num(Peek('maxDate', 0, 'Temp')), 0);  
DROP Table Temp;  
  
TempCalendar:  
LOAD  
	$(varMinDate) + Iterno()-1 as Num,  
	Date($(varMinDate) + IterNo() - 1) as TempDate  
AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate)
;  
  
Target_Calendar_Subm_AOP:  
Load  
               TempDate as [Target.SubmAOPDateNum],
               Date(TempDate) as [Target.Submission AOP Date],
               week(TempDate) as [Target.Submission AOP Week],  
               Year(TempDate) as [Target.Submission AOP Year],
               'Q' & ceil(num(Month(TempDate))/3) as [Target.Submission AOP Quarter],
               Month(TempDate) As [Target.Submission AOP Month],  
               Day(TempDate) as [Target.Submission AOP Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [Target.Submission AOP MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [Target.Submission AOP WeekYear],  
               WeekDay(TempDate) as [Target.Submission AOP WeekDay],
               TempDate-'$(vToday)' as [Target.Submission AOP Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [Target.Submission AOP Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [Target.Submission AOP Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [Target.Submission AOP Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar;  

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab TARGET_CALENDAR_LAUNCH_AOP
LET vStartTime = now();

Temp:  
Load  
               min([Target.Launch AOP Date]) as minDate,
               max([Target.Launch AOP Date]) as maxDate
               //floor(Now()) as maxDate  
Resident FACT_GM_PROJECT_TARGET;  
  
Let varMinDate = Alt(Num(Peek('minDate', 0, 'Temp')),0);  
Let varMaxDate = Alt(Num(Peek('maxDate', 0, 'Temp')),0);  
DROP Table Temp;  
  
TempCalendar:  
LOAD  
               $(varMinDate) + Iterno()-1 as Num,  
               Date($(varMinDate) + IterNo() - 1) as TempDate  
               AutoGenerate 1 While $(varMinDate) + IterNo() -1 <= $(varMaxDate);  
  
Target_Calendar_Launch_AOP:  
Load  
               TempDate as [Target.LaunchAOPDateNum],
               Date(TempDate) as [Target.Launch AOP Date],
               week(TempDate) as [Target.Launch AOP Week],  
               Year(TempDate) as [Target.Launch AOP Year],
               'Q' & ceil(num(Month(TempDate))/3) as [Target.Launch AOP Quarter],
               Month(TempDate) As [Target.Launch AOP Month],  
               Day(TempDate) as [Target.Launch AOP Day],  
               //YeartoDate(TempDate)*-1 as CurYTDFlag,  
               //YeartoDate(TempDate,-1)*-1 as LastYTDFlag,  
               //inyear(TempDate, Monthstart($(varMaxDate)),-1) as RC12,  
               date(monthstart(TempDate), 'MMM-YYYY') as [Target.Launch AOP MonthYear],  
               Week(weekstart(TempDate)) & '-' & WeekYear(TempDate) as [Target.Launch AOP WeekYear],  
               WeekDay(TempDate) as [Target.Launch AOP WeekDay],
               TempDate-'$(vToday)' as [Target.Launch AOP Date Diff],
              ((Year(TempDate)-Year('$(vToday)'))*12)+(Month(TempDate)-Month('$(vToday)')) as [Target.Launch AOP Month Diff],
              ((Year(TempDate)-Year('$(vToday)'))*4)+(ceil(num(Month(TempDate))/3)-ceil(num(Month('$(vToday)'))/3)) as [Target.Launch AOP Qtr Diff],
              Year(TempDate)-Year('$(vToday)') as [Target.Launch AOP Year Diff]
Resident TempCalendar  
Order By TempDate;

Drop Table TempCalendar;  

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab FACT_GM_SUBMISSIONS_LAUNCHES
LET vStartTime = now();

LBE_Pool_Temp:
LOAD Distinct		
    [_PJT.KEY]		           as [_PROJECT_KEY],
    Year([PJT.1st Submission Date])   as [LBE_Pool_Temp.Year],
    1                                  as [LBE_Pool_Temp.MeasureValueSubmissions]
Resident PROJECT
Where [PJT.SUBMISSIONS_ACTUALS_FLAG] = 1;
Concatenate
LOAD		
    [_PROJECT_KEY]			           as [_PROJECT_KEY],
    [Target.Year AOP LBE]		       as [LBE_Pool_Temp.Year],
     1                                 as [LBE_Pool_Temp.MeasureValueSubmissions]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission LBE] = 'Y';

/////////

NoConcatenate
LBE_Commitment_Temp1:
LOAD		
    [_PJT.KEY]		           as [_PROJECT_KEY],
    Year([PJT.1st Submission Date])   as [LBE_Commitment_Temp.Year],
    1                                  as [LBE_Commitment_Temp.MeasureValueSubmissions]
Resident PROJECT
Where [PJT.SUBMISSIONS_ACTUALS_FLAG] = 1;
Concatenate
LOAD		
    [_PROJECT_KEY] 			           as [_PROJECT_KEY],
    [Target.Year AOP LBE]		       as [LBE_Commitment_Temp.Year],
    [Target.Submission LBE POS CALC]   as [LBE_Commitment_Temp.MeasureValueSubmissions]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission LBE] = 'Y';

NoConcatenate
LBE_Commitment_Temp2:
LOAD
	[_PROJECT_KEY],
	[LBE_Commitment_Temp.Year],
	Max([LBE_Commitment_Temp.MeasureValueSubmissions]) as [LBE_Commitment_Temp.MeasureValueSubmissions]
Resident LBE_Commitment_Temp1
Group By
	[_PROJECT_KEY],
	[LBE_Commitment_Temp.Year]; 

Drop Table LBE_Commitment_Temp1;

///////////

NoConcatenate
LBE_Temp:
LOAD Distinct		
    [_PJT.KEY]		           as [_PROJECT_KEY],
    Year([PJT.1st Launch Date])       as [LBE_Temp.Year],
    1                                  as [LBE_Temp.MeasureValueLaunches]
Resident PROJECT
Where [PJT.LAUNCHES_ACTUALS_FLAG] = 1;
Concatenate
LOAD		
    _PROJECT_KEY			           as [_PROJECT_KEY],
    [Target.Year AOP LBE]		       as [LBE_Temp.Year],
     1                                 as [LBE_Temp.MeasureValueLaunches]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Launches LBE] = 'Y';


/////////////// SUBMISSIONS

NoConcatenate
FACT_GM_SUBMISSIONS_LAUNCHES:
LOAD		
    [_PROJECT_KEY]			                as [_PROJECT_KEY],
    [Target.Year AOP LBE]		            as [SubmLaun.Year],
    'AOP Pool'                              as [SubmLaun.MeasureTypeSubmissions],
    1                                       as [SubmLaun.MeasureValueSubmissions],
    1                                       as [SubmLaun.Sort1],
    1                                       as [SubmLaun.Sort2]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission AOP] = 'Y';

Concatenate
LOAD		
    [_PROJECT_KEY] 			                as [_PROJECT_KEY],
    [Target.Year AOP LBE]		            as [SubmLaun.Year],
    'AOP Commitment'                        as [SubmLaun.MeasureTypeSubmissions],
    [Target.Submission AOP POS CALC]        as [SubmLaun.MeasureValueSubmissions],
    2                                       as [SubmLaun.Sort1],
    3                                       as [SubmLaun.Sort2]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission AOP] = 'Y';

Concatenate
LOAD		
    [_PROJECT_KEY]			                as [_PROJECT_KEY],
    [LBE_Pool_Temp.Year]		            as [SubmLaun.Year],
    'LBE Pool'                              as [SubmLaun.MeasureTypeSubmissions],
    [LBE_Pool_Temp.MeasureValueSubmissions] as [SubmLaun.MeasureValueSubmissions],
    3                                       as [SubmLaun.Sort1],
    2                                       as [SubmLaun.Sort2]
Resident LBE_Pool_Temp;

Concatenate
LOAD		
    [_PROJECT_KEY]			                      as [_PROJECT_KEY],
    [LBE_Commitment_Temp.Year]		              as [SubmLaun.Year],
    'LBE Commitment'                              as [SubmLaun.MeasureTypeSubmissions],
    [LBE_Commitment_Temp.MeasureValueSubmissions] as [SubmLaun.MeasureValueSubmissions],
    4                                             as [SubmLaun.Sort1],
    4                                             as [SubmLaun.Sort2]
Resident LBE_Commitment_Temp2;

Concatenate
LOAD		
    [_PROJECT_KEY] 			                as [_PROJECT_KEY],
    Year([Target.Submission AOP Date])		as [SubmLaun.Year],
    'AOP Commitment YTD'                    as [SubmLaun.MeasureTypeSubmissions],
    [Target.Submission AOP POS CALC]        as [SubmLaun.MeasureValueSubmissions],
    5                                       as [SubmLaun.Sort1],
    5                                       as [SubmLaun.Sort2]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Submission AOP] = 'Y'
And [Target.Submission AOP Date] < '$(vCurrentMonthStart)';

Concatenate
LOAD		
    [_PJT.KEY]		                as [_PROJECT_KEY],
    Year([PJT.1st Submission Date])        as [SubmLaun.Year],
    'Actuals YTD'                           as [SubmLaun.MeasureTypeSubmissions],
    1                                       as [SubmLaun.MeasureValueSubmissions],
    6                                       as [SubmLaun.Sort1],
    6                                       as [SubmLaun.Sort2]
Resident PROJECT
Where [PJT.SUBMISSIONS_ACTUALS_FLAG] = 1
And [PJT.1st Submission Date] < '$(vCurrentMonthStartNum)';

////////////////////////////
///      LAUNCHES        ///
////////////////////////////

Concatenate
LOAD		
    [_PROJECT_KEY]			                as [_PROJECT_KEY],
    [Target.Year AOP LBE]		            as [SubmLaun.Year],
    'AOP'                                   as [SubmLaun.MeasureTypeLaunches],
    1                                       as [SubmLaun.MeasureValueLaunches]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Launches AOP] = 'Y';

Concatenate
LOAD		
    [_PROJECT_KEY]			                as [_PROJECT_KEY],
    [LBE_Temp.Year]		                    as [SubmLaun.Year],
    'LBE'                                   as [SubmLaun.MeasureTypeLaunches],
    [LBE_Temp.MeasureValueLaunches]         as [SubmLaun.MeasureValueLaunches]
Resident LBE_Temp;

Concatenate
LOAD		
    [_PROJECT_KEY]			                as [_PROJECT_KEY],
    Year([Target.Launch AOP Date])		    as [SubmLaun.Year],
    'AOP YTD'                               as [SubmLaun.MeasureTypeLaunches],
    1                                       as [SubmLaun.MeasureValueLaunches]
Resident FACT_GM_PROJECT_TARGET
Where [Target.Launches AOP] = 'Y'
And [Target.Launch AOP Date] < '$(vCurrentMonthStart)';

Concatenate
LOAD		
    [_PJT.KEY]		                as [_PROJECT_KEY],
    Year([PJT.1st Launch Date])            as [SubmLaun.Year],
    'Actuals YTD'                           as [SubmLaun.MeasureTypeLaunches],
    1                                       as [SubmLaun.MeasureValueLaunches]
Resident PROJECT
Where [PJT.LAUNCHES_ACTUALS_FLAG] = 1
And [PJT.1st Launch Date] < '$(vCurrentMonthStartNum)';


Drop Table LBE_Pool_Temp;
Drop Table LBE_Commitment_Temp2;
Drop Table LBE_Temp;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab SKU_LYNC
//2019-02-06 - RSYSIUK - ToDo: investigate schema
LET vStartTime = now();

SKU_Lync:
Load distinct [_SKU.KEY],
[_SKU.PACK_KEY]				as [_SKU_Lync.PACK_KEY]
resident SKU;

join (SKU_Lync)
Load distinct [_PACK.KEY],
[_PACK.KEY]					as [_SKU_Lync.PACK_KEY],
[_PACK.WP_KEY]				as [_SKU_Lync.WP_KEY]
resident  PACK;

join (SKU_Lync)
Load distinct [_WP.KEY],
[_WP.KEY]					as [_SKU_Lync.WP_KEY],
[_WP.PROJECT_KEY]			as [_SKU_Lync.PROJECT_KEY],
[_WP.REGION_COUNTRY_KEY]	as [_SKU_Lync.REGION_COUNTRY_KEY] ////added for reg_pdt and wp connection for europe
resident WORKPACKAGE;

store SKU_Lync into [lib://PLM (tevacorp_admqlik)/1.Extract\QVD\SKU_Lync.QVD];

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab Key Table
LET vStartTime = now();

NullAsValue [_SA_PJT_GROUP],[_SA_DEV_SITE],[_SA_MFG_SITE],[_Region_Country],[_Region], [_SA_PLP_SITE];
NullValue='<ANY>';

//////////////////////////////////////////////////////////////////////////////////////////////////////////

KeyTableTemp:
Load Distinct 
[_SKU.KEY],
[_PACK.KEY],
[_WP.KEY],
[_SKU_Lync.PROJECT_KEY]			as [_PROJECT_KEY],
[_SKU_Lync.REGION_COUNTRY_KEY]	as [_REGION_COUNTRY_KEY] //added for reg_pdt and wp connection for europe
resident SKU_Lync;
// Guy 20_11_2017
drop table SKU_Lync;
//////////////////////////////////////////////////////////////////////////////////////////////////////////

Temp:
load Distinct
[_PROJECT_KEY],
[_PJT.PRODUCT_KEY]				as [_PRODUCT_KEY],
[_PJT.REGION_COUNTRY_KEY]		as [T_REGION_COUNTRY_KEY]
//[_PJT.REGION_COUNTRY_KEY]		as [_REGION_COUNTRY_KEY]
RESIDENT PROJECT;

//////////////////////////////////////////////////////////////////
t0:
Load Distinct [_PROJECT_KEY]

	,'Combination Projects' as [_SA_PJT_GROUP]
Resident PROJECT 
Where 
wildmatch([PJT.Project Rationale], '*Combination product*') >0;

//[PJT.Project Rationale] = 'Combination Products';
Concatenate
Load Distinct [_PROJECT_KEY]
	,'BD Projects' as [_SA_PJT_GROUP]
Resident PROJECT 
Where Match([PJT.Project type],'In-Licensing','In-Licensing with Local Bio/ CDP / Zone IV stability by Teva');
Concatenate
Load Distinct [_PROJECT_KEY]
	,'TAPI Projects' as [_SA_PJT_GROUP]
Resident PROJECT 
Where [PJT.TAPI Y/N] = 'Y';
//Amend on Talya request by Olga Voloshchuk on March 2021
Concatenate
Load Distinct [_PROJECT_KEY]
	,'Make VS Buy  projects' as [_SA_PJT_GROUP]
Resident PROJECT 
where
[PJT.Operations allocation status]='Make Vs Buy'

;
//Amend by Olga Voloshchuk - dditional sites which currently are not in the IDM menu: Release +testing+ packaging on Talya req for Superna
Concatenate
Load Distinct [_PROJECT_KEY]
	,'CMO & external sites (Non DEV/MNF)' as [_SA_PJT_GROUP]
Resident [PJT_SITES (Non DEV/MNF)]
where
wildmatch([PJT.Site.Value (Non DEV/MNF)], 'x *') >0


or 
wildmatch([PJT.Site.Value (Non DEV/MNF)], 'Contract Manufacturing') >0


;
// End Amend by Olga Voloshchuk - dditional sites which currently are not in the IDM menu: Release +testing+ packaging on Talya req for Superna

t:
Load 
	Distinct [_PROJECT_KEY] 
    Resident PROJECT; 
Left Join Load [_PROJECT_KEY],[_SA_PJT_GROUP] 
Resident t0; Drop Table t0;
Left Join(Temp) Load [_PROJECT_KEY],UPPER([_SA_PJT_GROUP]) as [_SA_PJT_GROUP] Resident t; Drop Table t;

//////////////////////////////////////////////////////////////////
t:
Load Distinct
1278							as [T_REGION_COUNTRY_KEY],
[_CNTRY.REGION_COUNTRY_KEY]		as [_REGION_COUNTRY_KEY]
Resident COUNTRY_REGION
Where [CNTRY.Region Name] = 'Europe';
Concatenate(t)
Load Distinct
[_CNTRY.REGION_COUNTRY_KEY]		as [T_REGION_COUNTRY_KEY],
[_CNTRY.REGION_COUNTRY_KEY]		as [_REGION_COUNTRY_KEY]
Resident COUNTRY_REGION
Where [_CNTRY.REGION_COUNTRY_KEY] <> 1278;

Left Join(Temp)
Load [T_REGION_COUNTRY_KEY], [_REGION_COUNTRY_KEY]
Resident t; Drop Table t;

//////////////////////////////////////////////////////////////////
Left Join(Temp)
Load [_PROJECT_KEY],
	//[PJT.Manufacturing Site (single value)] as [_SA_MFG_SITE] - 20210226 - QC10322 - Dmytro Isaiev:
    //Updated on 01/01/2023 for Tamar request to combine x- sites with Contract manufacturing
	if(wildmatch([PJT.Manufacturing Site (single value)], 'x *') >0 or [PJT.Manufacturing Site (single value)]='Contract Manufacturing' , 'All external manuf sites/contract manufacturing', [PJT.Manufacturing Site (single value)] ) as [_SA_MFG_SITE]
Resident [PJT/Manufacturing Sites]
Where LEN([PJT.Manufacturing Site (single value)])>0;

Left Join(Temp)
Load [_PROJECT_KEY],
	//[PJT.Development Site (single value)] as [_SA_DEV_SITE] - 20210226 - QC10322 - Dmytro Isaiev:
	if(wildmatch([PJT.Development Site (single value)], 'x *') >0, 'all external DEV sites', [PJT.Development Site (single value)]) as [_SA_DEV_SITE]
Resident [PJT/Development Sites]
Where LEN([PJT.Development Site (single value)])>0;



//////////////////////////////////////////////////////////////////
join(KeyTableTemp)
Load [_PROJECT_KEY]
	,[_PRODUCT_KEY] as [_PRODUCT_KEY_TEMP]
    ,[_REGION_COUNTRY_KEY]
    ,[_SA_PJT_GROUP]
    ,[_SA_DEV_SITE]
    ,[_SA_MFG_SITE]
    
Resident Temp; Drop Table Temp;

//adding PLP Projects
Left Join(KeyTableTemp)
Load [_PROJECT_KEY],
   Upper([PJT.PLP Project Y/N]) as [_SA_PLP_PROJECT_TEMP] 
	Resident PROJECT;
//Adding product keys for PLP IM projects
left join (KeyTableTemp)
load Distinct
[_PROJECT_KEY],
[_PJT.PRODUCT_KEY]				as [_PRODUCT_KEY_TEMP1]

RESIDENT PROJECT
where Upper([PJT.PLP Project Y/N])='Y'
;
NoConcatenate
KeyTableTemp1:
Load

*
,
if (IsNull([_PRODUCT_KEY_TEMP]),[_PRODUCT_KEY_TEMP1],[_PRODUCT_KEY_TEMP]) as [_PRODUCT_KEY]
Resident KeyTableTemp;
Drop Fields [_PRODUCT_KEY_TEMP1], [_PRODUCT_KEY_TEMP];
Drop Table KeyTableTemp;
Rename Table KeyTableTemp1 to KeyTableTemp;
//Adding product keys for PLP IM projects
//Section Access for PLP Sites
Left Join(KeyTableTemp)
Load [_PROJECT_KEY],
	
	if(wildmatch([PJT.PLP Site single value], 'x *') >0  or [PJT.PLP Site single value]='Contract Manufacturing', 'All external manuf sites/contract manufacturing', [PJT.PLP Site single value] ) as [_SA_PLP_SITE]
Resident [PJT/PLP Site]
Where LEN([PJT.PLP Site single value])>0;


//Section Access for PLP Sites


//////////////////////////////////////////////////////////////////////////////////////////////////////////

Join(KeyTableTemp)
load Distinct [_REG_PDT.KEY], 
[_Reg_PDT.PRODUCT_KEY]			as [_PRODUCT_KEY],
[_Reg_PDT.REGION_COUNTRY_KEY]	as [_REGION_COUNTRY_KEY]
Resident FACT_REG_PDT;

Join(KeyTableTemp)
load Distinct [_IND.KEY],
[_IND.KEY]					as [_INDICATION_KEY],
[_IND.PRODUCT_KEY]			as [_PRODUCT_KEY],
[_IND.REGION_COUNTRY_KEY]	as [_REGION_COUNTRY_KEY]
Resident INDICATION;

/*Join(KeyTableTemp)
load Distinct [_API.KEY], 
[_API.PROJECT_KEY]			as [_PROJECT_KEY]
Resident API_SUPPLIER_N_N_BI;*/

//////////////////////////////////////////////////////////////////////////////////////////////////////////

Join(KeyTableTemp)
Load Distinct [_PDT.KEY],
[_PDT.KEY]						as [_PRODUCT_KEY]
Resident PRODUCT;

/*/////////////////////////////////////////////////////////////////////////////////////////////////////////

JOIN(KeyTableTemp)
LOAD Distinct [_LBE_MBI.KEY],
[_LBE.SKU.KEY]					as [_SKU.KEY], 
[_LBE.ORGANIZATION_KEY]			as [_ORGANIZATION_KEY]
RESIDENT FACT_LBE;

JOIN(KeyTableTemp)
LOAD Distinct [_LBE_MBI.KEY],
[_MBI.SKU.KEY]					as [_SKU.KEY], 
[_MBI.ORGANIZATION_KEY]			as [_ORGANIZATION_KEY]
RESIDENT FACT_MBI_MEASURES;

*//////////////////////////////////////////////////////////////////////////////////////////////////////////

Left Join(KeyTableTemp)
Load Distinct
[_CNTRY.REGION_COUNTRY_KEY],
[_CNTRY.REGION_COUNTRY_KEY]		as [_REGION_COUNTRY_KEY], 
[CNTRY.Country Code]			as [_Region_Country], 
Upper([CNTRY.Region Name BI])	as [_Region]
Resident COUNTRY_REGION;

Left Join(KeyTableTemp)
Load Distinct
	[_ORG.ORGANIZATION_KEY],
    [_ORG.ORGANIZATION_KEY]		as [_ORGANIZATION_KEY],
    [_ORG.REGION_COUNTRY_KEY]	as [_REGION_COUNTRY_KEY]
Resident ORGANIZATION;

//////////////////////////////////////////////////////////////////////////////////////////////////////////

KeyTable1:
Load *
     ,if(len([_SA_PLP_PROJECT_TEMP])<1 or IsNull([_SA_PLP_PROJECT_TEMP]),'N',[_SA_PLP_PROJECT_TEMP]) as [_SA_PLP_PROJECT]
  
Resident KeyTableTemp;

DROP TABLE KeyTableTemp;
Drop Field _SA_PLP_PROJECT_TEMP;
NoConcatenate
KeyTableTemp:
Load *
, if ([_SA_PLP_PROJECT]='N' and [_Region]='SPECIALTY' ,'Specialty Global development projects',[_SA_PJT_GROUP]) as [_SA_PJT_GROUP1]

,if ([_SA_PLP_PROJECT]='Y',[_SA_PLP_SITE],[_SA_MFG_SITE]) as [_SA_MFG_SITE1]

Resident KeyTable1;
Drop table KeyTable1;

Drop Fields [_SA_MFG_SITE], [_SA_PLP_SITE],[_SA_PJT_GROUP];
Rename Field [_SA_MFG_SITE1] to [_SA_MFG_SITE];
Rename Field [_SA_PJT_GROUP1] to [_SA_PJT_GROUP];


Concatenate (KeyTableTemp)
Load Distinct

[_CNTRY.REGION_COUNTRY_KEY],
[_IND.KEY],
[_INDICATION_KEY],
[_ORG.ORGANIZATION_KEY],
[_ORGANIZATION_KEY],
[_PACK.KEY],
[_PDT.KEY],
[_PRODUCT_KEY],
[_PROJECT_KEY],
[_REG_PDT.KEY],
[_Region],
[_Region_Country],
[_REGION_COUNTRY_KEY],
[_SA_DEV_SITE],
[_SA_MFG_SITE],

[_SA_PLP_PROJECT],
[_SKU.KEY],
[_WP.KEY],
'Pipeline projects (PJT)' as [_SA_PJT_GROUP]

Resident KeyTableTemp
where 
[_Region]<>'SPECIALTY' and [_SA_PLP_PROJECT]<>'Y'
;

Concatenate (KeyTableTemp)
Load Distinct

[_CNTRY.REGION_COUNTRY_KEY],
[_IND.KEY],
[_INDICATION_KEY],
[_ORG.ORGANIZATION_KEY],
[_ORGANIZATION_KEY],
[_PACK.KEY],
[_PDT.KEY],
[_PRODUCT_KEY],
[_PROJECT_KEY],
[_REG_PDT.KEY],
[_Region],
[_Region_Country],
[_REGION_COUNTRY_KEY],
[_SA_DEV_SITE],
[_SA_MFG_SITE],

[_SA_PLP_PROJECT],
[_SKU.KEY],
[_WP.KEY],
'Pipeline (PJT) and Post launch (PLP)' as [_SA_PJT_GROUP]

Resident KeyTableTemp
where 
[_Region]<>'SPECIALTY' 
;





KeyTable:
Load *
    
	,[_PRODUCT_KEY] &'_'&[_ORGANIZATION_KEY] as [_LBE_MBI.KEY]
	,UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region]&'|'&[_SA_PLP_PROJECT]) AS _AuthID //2018-12-18, RSYSIUK
Resident KeyTableTemp;
Drop table KeyTableTemp;

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);



///$tab Process Report
LIB CONNECT TO 'GLBIPRD_OLE_DB (tevacorp_admqlik)';

SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_CONTROL_REPORTS_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_CONTROL_REPORTS_PLM'

);

SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_GENERAL_REPORTS_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_GENERAL_REPORTS_PLM'

);


SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_HAND_IN_HAND_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_HAND_IN_HAND_PLM'

);

SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_RD_GENERICS_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_RD_GENERICS_PLM'

);

SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_RD_SPECIALITY_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_RD_SPECIALITY_PLM'

);

// 09-11-2020 - Dmytro Isaiev - new report
SQL UPDATE MBIDW_MNG.PROCESS_REPORT T 
SET 
STG=1,
SHD=1,
STG_DATE=SYSDATE,
SHD_DATE=SYSDATE
WHERE PROCESS_NAME='MBI_QS_TGO_PLM'
AND T.STARTING_DATE=
(   
    SELECT MAX(STARTING_DATE)
    FROM MBIDW_MNG.PROCESS_REPORT
    WHERE PROCESS_NAME='MBI_QS_TGO_PLM'

);


SQL COMMIT;

///$tab Exit when Developer
//Exit Script When '$(vServer)' = 'ILQSAPP01D';
Exit Script When OSUser()='UserDirectory=TEVACORP; UserId=rsysiuk';
Exit Script When OSUser()='UserDirectory=TEVAIL; UserId=nberman01';
Exit Script When OSUser()='UserDirectory=TEVACORP; UserId=disaiev';
Exit Script When OSUser()='UserDirectory=TEVACORP; UserId=sgaikwad04';
Exit Script When OSUser()='UserDirectory=TEVACORP; UserId=slakshmina01';

///$tab Section Access
Star is *;
section access;
LOAD [ACCESS]
	,[USERID]
    ,[GROUP]
	,UPPER([SA.PJT_GROUP] &'|'& [SA.DEV_SITE] &'|'& [SA.MFG_SITE] &'|'& [SA.CNTRY] &'|'& [SA.REGION]&'|'&[SA.PLP_PROJECT]) as [AUTHP]
	,[OMIT]
    
FROM [lib://PLM (tevacorp_admqlik)\Extract\QVD\GLB_PLM_USERS.QVD](qvd);

Concatenate //load SA_SCHEDULER to run tasks
LOAD * Inline [ACCESS,USERID,GROUP,AUTHP,OMIT
ADMIN,TEVACORP\SGLYANKO,*,<ANY>|<ANY>|<ANY>|<ANY>|<ANY>|<ANY>,''
ADMIN,INTERNAL\SA_SCHEDULER,*,<ANY>|<ANY>|<ANY>|<ANY>|<ANY>|<ANY>,''
ADMIN,INTERNAL\SA_SCHEDULER,*,<ANY>|<ANY>|<ANY>|<ANY>|SPECIALTY|<ANY>,''

];
section application;
//USER,TEVACORP\OVOLOSHAKE,*,<ANY>|<ANY>|<ANY>|<ANY>|<ANY>|Y,|<ANY>|''
///$tab Bridge
LET vStartTime = now();

bridge_table:

/* - P_D_M_*_* - */  Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - P_D_*_C_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_MFG_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - P_D_*_*_R - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - P_*_M_C_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - P_*_M_*_R - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - P_*_*_C_R - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY';
/* - *_D_M_C_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_Region] <> 'ANY';
/* - *_D_M_*_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - *_D_*_C_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY';
/* - *_*_M_C_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY';

/* - P_D_*_*_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - P_*_M_*_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - P_*_*_C_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - P_*_*_*_R - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - *_D_M_*_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - *_D_*_C_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - *_D_*_*_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - *_*_M_C_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - *_*_M_*_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';
/* - *_*_*_C_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY';

/* - P_*_*_*_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - *_D_*_*_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - *_*_M_*_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
/* - *_*_*_C_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region] <> 'ANY';
/* - *_*_*_*_R - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>'&'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY';

/* - *_*_*_*_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';

/* - *_*_*_*_* - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>') as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY' And [_SA_DEV_SITE] <> 'ANY' And [_SA_MFG_SITE] <> 'ANY' And [_Region_Country] <> 'ANY' And [_Region] <> 'ANY';
//Adding PLP Site 

/* - *_*_*_*_*_S - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]) as AUTHP Resident KeyTable		;



_bridge: Load _AuthID, AUTHP as _AUTHP resident bridge_table;


USER:
LOAD UPPER([SA.PJT_GROUP] &'|'& [SA.DEV_SITE] &'|'& [SA.MFG_SITE] &'|'& [SA.CNTRY] &'|'& [SA.REGION]&'|'&[SA.PLP_PROJECT]) as _AUTHP
	,SubField([User.Name],' ',1) as [SA.UserFirstName]
    ,[User.Name] as [SA.UserName]
    ,[User.Login] as [SA.Login]
    ,[USERID] as [SA.USERID]
	,[SA.PJT_GROUP]
	,[SA.DEV_SITE]
	,[SA.MFG_SITE]
	,[SA.CNTRY]
	,[SA.REGION]
	,[SA.PLP_PROJECT]
    //,[SA.PLP_SITE]
FROM [lib://PLM (tevacorp_admqlik)\Extract\QVD\GLB_PLM_USERS.QVD](qvd);

Drop Fields [_SA_PJT_GROUP],[_SA_DEV_SITE],[_SA_MFG_SITE],[_Region_Country],[_Region];

LET vLoadTime = floor((now()-vStartTime)*24*60*60);
trace loading time: $(vLoadTime);
///$tab Exit
Let vNow=now();
Exit Script;
///$tab Section 2
/* - P_D_M_C_R_S - */ Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable;
/* - P_D_M_C_R_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_SA_PLP_SITE] <> 'ANY';
/* - P_D_M_C_*_S - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& '<ANY>' &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_Region] <> 'ANY';
/* - P_D_M_*_R_S - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& '<ANY>' &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_Region_Country] <> 'ANY';
/* - P_D_*_C_R_S - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& '<ANY>' &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_SA_MFG_SITE] <> 'ANY';
/* - P_*_M_C_R_S - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& '<ANY>' &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_SA_DEV_SITE] <> 'ANY';
/* - *_D_M_C_R_S - */ Concatenate Load Distinct _AuthID, UPPER('<ANY>' &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_SA_PJT_GROUP] <> 'ANY';
/* - P_D_M_C_R_* - */ Concatenate Load Distinct _AuthID, UPPER([_SA_PJT_GROUP] &'|'& [_SA_DEV_SITE] &'|'& [_SA_MFG_SITE] &'|'& [_Region_Country] &'|'& [_Region] &'|'& [_SA_PLP_PROJECT]&'|'& [_SA_PLP_SITE]) as AUTHP Resident KeyTable		Where [_SA_PLP_SITE] <> 'ANY';
